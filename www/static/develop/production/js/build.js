//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2014 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

// MarionetteJS (Backbone.Marionette)
// ----------------------------------
// v2.3.2
//
// Copyright (c)2015 Derick Bailey, Muted Solutions, LLC.
// Distributed under MIT license
//
// http://marionettejs.com

/*!
 * Includes BabySitter
 * https://github.com/marionettejs/backbone.babysitter/
 *
 * Includes Wreqr
 * https://github.com/marionettejs/backbone.wreqr/
 */

// Copyright (c)2014 Derick Bailey, Muted Solutions, LLC.

// Distributed under MIT license

/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */

/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*
	Masked Input plugin for jQuery
	Copyright (c) 2007-2013 Josh Bush (digitalbush.com)
	Licensed under the MIT license (http://digitalbush.com/projects/masked-input-plugin/#license)
	Version: 1.3.1
*/

/*
 * jQuery Iframe Transport Plugin 1.8.3
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/*! jQuery UI - v1.11.1+CommonJS - 2014-09-17
* http://jqueryui.com
* Includes: widget.js
* Copyright 2014 jQuery Foundation and other contributors; Licensed MIT */

/*!
 * jQuery UI Widget 1.11.1
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/jQuery.widget/
 */

/*
 * jQuery File Upload Plugin 5.42.3
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

/* NicEdit - Micro Inline WYSIWYG
 * Copyright 2007-2008 Brian Kirchoff
 *
 * NicEdit is distributed under the terms of the MIT license
 * For more information visit http://nicedit.com/
 * Do not remove this copyright message
 */

function bkClass(){}function $BK(e){return typeof e=="string"&&(e=document.getElementById(e)),e&&!e.appendTo?bkExtend(e,bkElement.prototype):e}function __(e){return e}(function(){function x(e){function t(t,n,r,i,s,o){for(;s>=0&&s<o;s+=e){var u=i?i[s]:s;r=n(r,t[u],u,t)}return r}return function(n,r,i,s){r=v(r,s,4);var o=!S(n)&&d.keys(n),u=(o||n).length,a=e>0?0:u-1;return arguments.length<3&&(i=n[o?o[a]:a],a+=e),t(n,r,i,o,a,u)}}function C(e){return function(t,n,r){n=m(n,r);var i=E(t),s=e>0?0:i-1;for(;s>=0&&s<i;s+=e)if(n(t[s],s,t))return s;return-1}}function k(e,t,n){return function(r,i,s){var u=0,a=E(r);if(typeof s=="number")e>0?u=s>=0?s:Math.max(s+a,u):a=s>=0?Math.min(s+1,a):s+a+1;else if(n&&s&&a)return s=n(r,i),r[s]===i?s:-1;if(i!==i)return s=t(o.call(r,u,a),d.isNaN),s>=0?s+u:-1;for(s=e>0?u:a-1;s>=0&&s<a;s+=e)if(r[s]===i)return s;return-1}}function M(e,t){var n=O.length,i=e.constructor,s=d.isFunction(i)&&i.prototype||r,o="constructor";d.has(e,o)&&!d.contains(t,o)&&t.push(o);while(n--)o=O[n],o in e&&e[o]!==s[o]&&!d.contains(t,o)&&t.push(o)}var e=this,t=e._,n=Array.prototype,r=Object.prototype,i=Function.prototype,s=n.push,o=n.slice,u=r.toString,a=r.hasOwnProperty,f=Array.isArray,l=Object.keys,c=i.bind,h=Object.create,p=function(){},d=function(e){if(e instanceof d)return e;if(!(this instanceof d))return new d(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=d),exports._=d):e._=d,d.VERSION="1.8.3";var v=function(e,t,n){if(t===void 0)return e;switch(n==null?3:n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,s){return e.call(t,n,r,i,s)}}return function(){return e.apply(t,arguments)}},m=function(e,t,n){return e==null?d.identity:d.isFunction(e)?v(e,t,n):d.isObject(e)?d.matcher(e):d.property(e)};d.iteratee=function(e,t){return m(e,t,Infinity)};var g=function(e,t){return function(n){var r=arguments.length;if(r<2||n==null)return n;for(var i=1;i<r;i++){var s=arguments[i],o=e(s),u=o.length;for(var a=0;a<u;a++){var f=o[a];if(!t||n[f]===void 0)n[f]=s[f]}}return n}},y=function(e){if(!d.isObject(e))return{};if(h)return h(e);p.prototype=e;var t=new p;return p.prototype=null,t},b=function(e){return function(t){return t==null?void 0:t[e]}},w=Math.pow(2,53)-1,E=b("length"),S=function(e){var t=E(e);return typeof t=="number"&&t>=0&&t<=w};d.each=d.forEach=function(e,t,n){t=v(t,n);var r,i;if(S(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var s=d.keys(e);for(r=0,i=s.length;r<i;r++)t(e[s[r]],s[r],e)}return e},d.map=d.collect=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length,s=Array(i);for(var o=0;o<i;o++){var u=r?r[o]:o;s[o]=t(e[u],u,e)}return s},d.reduce=d.foldl=d.inject=x(1),d.reduceRight=d.foldr=x(-1),d.find=d.detect=function(e,t,n){var r;S(e)?r=d.findIndex(e,t,n):r=d.findKey(e,t,n);if(r!==void 0&&r!==-1)return e[r]},d.filter=d.select=function(e,t,n){var r=[];return t=m(t,n),d.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},d.reject=function(e,t,n){return d.filter(e,d.negate(m(t)),n)},d.every=d.all=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(!t(e[o],o,e))return!1}return!0},d.some=d.any=function(e,t,n){t=m(t,n);var r=!S(e)&&d.keys(e),i=(r||e).length;for(var s=0;s<i;s++){var o=r?r[s]:s;if(t(e[o],o,e))return!0}return!1},d.contains=d.includes=d.include=function(e,t,n,r){S(e)||(e=d.values(e));if(typeof n!="number"||r)n=0;return d.indexOf(e,t,n)>=0},d.invoke=function(e,t){var n=o.call(arguments,2),r=d.isFunction(t);return d.map(e,function(e){var i=r?t:e[t];return i==null?i:i.apply(e,n)})},d.pluck=function(e,t){return d.map(e,d.property(t))},d.where=function(e,t){return d.filter(e,d.matcher(t))},d.findWhere=function(e,t){return d.find(e,d.matcher(t))},d.max=function(e,t,n){var r=-Infinity,i=-Infinity,s,o;if(t==null&&e!=null){e=S(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s>r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o>i||o===-Infinity&&r===-Infinity)r=e,i=o});return r},d.min=function(e,t,n){var r=Infinity,i=Infinity,s,o;if(t==null&&e!=null){e=S(e)?e:d.values(e);for(var u=0,a=e.length;u<a;u++)s=e[u],s<r&&(r=s)}else t=m(t,n),d.each(e,function(e,n,s){o=t(e,n,s);if(o<i||o===Infinity&&r===Infinity)r=e,i=o});return r},d.shuffle=function(e){var t=S(e)?e:d.values(e),n=t.length,r=Array(n);for(var i=0,s;i<n;i++)s=d.random(0,i),s!==i&&(r[i]=r[s]),r[s]=t[i];return r},d.sample=function(e,t,n){return t==null||n?(S(e)||(e=d.values(e)),e[d.random(e.length-1)]):d.shuffle(e).slice(0,Math.max(0,t))},d.sortBy=function(e,t,n){return t=m(t,n),d.pluck(d.map(e,function(e,n,r){return{value:e,index:n,criteria:t(e,n,r)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index-t.index}),"value")};var T=function(e){return function(t,n,r){var i={};return n=m(n,r),d.each(t,function(r,s){var o=n(r,s,t);e(i,r,o)}),i}};d.groupBy=T(function(e,t,n){d.has(e,n)?e[n].push(t):e[n]=[t]}),d.indexBy=T(function(e,t,n){e[n]=t}),d.countBy=T(function(e,t,n){d.has(e,n)?e[n]++:e[n]=1}),d.toArray=function(e){return e?d.isArray(e)?o.call(e):S(e)?d.map(e,d.identity):d.values(e):[]},d.size=function(e){return e==null?0:S(e)?e.length:d.keys(e).length},d.partition=function(e,t,n){t=m(t,n);var r=[],i=[];return d.each(e,function(e,n,s){(t(e,n,s)?r:i).push(e)}),[r,i]},d.first=d.head=d.take=function(e,t,n){return e==null?void 0:t==null||n?e[0]:d.initial(e,e.length-t)},d.initial=function(e,t,n){return o.call(e,0,Math.max(0,e.length-(t==null||n?1:t)))},d.last=function(e,t,n){return e==null?void 0:t==null||n?e[e.length-1]:d.rest(e,Math.max(0,e.length-t))},d.rest=d.tail=d.drop=function(e,t,n){return o.call(e,t==null||n?1:t)},d.compact=function(e){return d.filter(e,d.identity)};var N=function(e,t,n,r){var i=[],s=0;for(var o=r||0,u=E(e);o<u;o++){var a=e[o];if(S(a)&&(d.isArray(a)||d.isArguments(a))){t||(a=N(a,t,n));var f=0,l=a.length;i.length+=l;while(f<l)i[s++]=a[f++]}else n||(i[s++]=a)}return i};d.flatten=function(e,t){return N(e,t,!1)},d.without=function(e){return d.difference(e,o.call(arguments,1))},d.uniq=d.unique=function(e,t,n,r){d.isBoolean(t)||(r=n,n=t,t=!1),n!=null&&(n=m(n,r));var i=[],s=[];for(var o=0,u=E(e);o<u;o++){var a=e[o],f=n?n(a,o,e):a;t?((!o||s!==f)&&i.push(a),s=f):n?d.contains(s,f)||(s.push(f),i.push(a)):d.contains(i,a)||i.push(a)}return i},d.union=function(){return d.uniq(N(arguments,!0,!0))},d.intersection=function(e){var t=[],n=arguments.length;for(var r=0,i=E(e);r<i;r++){var s=e[r];if(d.contains(t,s))continue;for(var o=1;o<n;o++)if(!d.contains(arguments[o],s))break;o===n&&t.push(s)}return t},d.difference=function(e){var t=N(arguments,!0,!0,1);return d.filter(e,function(e){return!d.contains(t,e)})},d.zip=function(){return d.unzip(arguments)},d.unzip=function(e){var t=e&&d.max(e,E).length||0,n=Array(t);for(var r=0;r<t;r++)n[r]=d.pluck(e,r);return n},d.object=function(e,t){var n={};for(var r=0,i=E(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},d.findIndex=C(1),d.findLastIndex=C(-1),d.sortedIndex=function(e,t,n,r){n=m(n,r,1);var i=n(t),s=0,o=E(e);while(s<o){var u=Math.floor((s+o)/2);n(e[u])<i?s=u+1:o=u}return s},d.indexOf=k(1,d.findIndex,d.sortedIndex),d.lastIndexOf=k(-1,d.findLastIndex),d.range=function(e,t,n){t==null&&(t=e||0,e=0),n=n||1;var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r);for(var s=0;s<r;s++,e+=n)i[s]=e;return i};var L=function(e,t,n,r,i){if(r instanceof t){var s=y(e.prototype),o=e.apply(s,i);return d.isObject(o)?o:s}return e.apply(n,i)};d.bind=function(e,t){if(c&&e.bind===c)return c.apply(e,o.call(arguments,1));if(!d.isFunction(e))throw new TypeError("Bind must be called on a function");var n=o.call(arguments,2),r=function(){return L(e,r,t,this,n.concat(o.call(arguments)))};return r},d.partial=function(e){var t=o.call(arguments,1),n=function(){var r=0,i=t.length,s=Array(i);for(var o=0;o<i;o++)s[o]=t[o]===d?arguments[r++]:t[o];while(r<arguments.length)s.push(arguments[r++]);return L(e,n,this,this,s)};return n},d.bindAll=function(e){var t,n=arguments.length,r;if(n<=1)throw new Error("bindAll must be passed function names");for(t=1;t<n;t++)r=arguments[t],e[r]=d.bind(e[r],e);return e},d.memoize=function(e,t){var n=function(r){var i=n.cache,s=""+(t?t.apply(this,arguments):r);return d.has(i,s)||(i[s]=e.apply(this,arguments)),i[s]};return n.cache={},n},d.delay=function(e,t){var n=o.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},d.defer=d.partial(d.delay,d,1),d.throttle=function(e,t,n){var r,i,s,o=null,u=0;n||(n={});var a=function(){u=n.leading===!1?0:d.now(),o=null,s=e.apply(r,i),o||(r=i=null)};return function(){var f=d.now();!u&&n.leading===!1&&(u=f);var l=t-(f-u);return r=this,i=arguments,l<=0||l>t?(o&&(clearTimeout(o),o=null),u=f,s=e.apply(r,i),o||(r=i=null)):!o&&n.trailing!==!1&&(o=setTimeout(a,l)),s}},d.debounce=function(e,t,n){var r,i,s,o,u,a=function(){var f=d.now()-o;f<t&&f>=0?r=setTimeout(a,t-f):(r=null,n||(u=e.apply(s,i),r||(s=i=null)))};return function(){s=this,i=arguments,o=d.now();var f=n&&!r;return r||(r=setTimeout(a,t)),f&&(u=e.apply(s,i),s=i=null),u}},d.wrap=function(e,t){return d.partial(t,e)},d.negate=function(e){return function(){return!e.apply(this,arguments)}},d.compose=function(){var e=arguments,t=e.length-1;return function(){var n=t,r=e[t].apply(this,arguments);while(n--)r=e[n].call(this,r);return r}},d.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},d.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},d.once=d.partial(d.before,2);var A=!{toString:null}.propertyIsEnumerable("toString"),O=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];d.keys=function(e){if(!d.isObject(e))return[];if(l)return l(e);var t=[];for(var n in e)d.has(e,n)&&t.push(n);return A&&M(e,t),t},d.allKeys=function(e){if(!d.isObject(e))return[];var t=[];for(var n in e)t.push(n);return A&&M(e,t),t},d.values=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=e[t[i]];return r},d.mapObject=function(e,t,n){t=m(t,n);var r=d.keys(e),i=r.length,s={},o;for(var u=0;u<i;u++)o=r[u],s[o]=t(e[o],o,e);return s},d.pairs=function(e){var t=d.keys(e),n=t.length,r=Array(n);for(var i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},d.invert=function(e){var t={},n=d.keys(e);for(var r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},d.functions=d.methods=function(e){var t=[];for(var n in e)d.isFunction(e[n])&&t.push(n);return t.sort()},d.extend=g(d.allKeys),d.extendOwn=d.assign=g(d.keys),d.findKey=function(e,t,n){t=m(t,n);var r=d.keys(e),i;for(var s=0,o=r.length;s<o;s++){i=r[s];if(t(e[i],i,e))return i}},d.pick=function(e,t,n){var r={},i=e,s,o;if(i==null)return r;d.isFunction(t)?(o=d.allKeys(i),s=v(t,n)):(o=N(arguments,!1,!1,1),s=function(e,t,n){return t in n},i=Object(i));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=i[f];s(l,f,i)&&(r[f]=l)}return r},d.omit=function(e,t,n){if(d.isFunction(t))t=d.negate(t);else{var r=d.map(N(arguments,!1,!1,1),String);t=function(e,t){return!d.contains(r,t)}}return d.pick(e,t,n)},d.defaults=g(d.allKeys,!0),d.create=function(e,t){var n=y(e);return t&&d.extendOwn(n,t),n},d.clone=function(e){return d.isObject(e)?d.isArray(e)?e.slice():d.extend({},e):e},d.tap=function(e,t){return t(e),e},d.isMatch=function(e,t){var n=d.keys(t),r=n.length;if(e==null)return!r;var i=Object(e);for(var s=0;s<r;s++){var o=n[s];if(t[o]!==i[o]||!(o in i))return!1}return!0};var _=function(e,t,n,r){if(e===t)return e!==0||1/e===1/t;if(e==null||t==null)return e===t;e instanceof d&&(e=e._wrapped),t instanceof d&&(t=t._wrapped);var i=u.call(e);if(i!==u.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":if(+e!==+e)return+t!==+t;return+e===0?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t}var s=i==="[object Array]";if(!s){if(typeof e!="object"||typeof t!="object")return!1;var o=e.constructor,a=t.constructor;if(o!==a&&!(d.isFunction(o)&&o instanceof o&&d.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}n=n||[],r=r||[];var f=n.length;while(f--)if(n[f]===e)return r[f]===t;n.push(e),r.push(t);if(s){f=e.length;if(f!==t.length)return!1;while(f--)if(!_(e[f],t[f],n,r))return!1}else{var l=d.keys(e),c;f=l.length;if(d.keys(t).length!==f)return!1;while(f--){c=l[f];if(!d.has(t,c)||!_(e[c],t[c],n,r))return!1}}return n.pop(),r.pop(),!0};d.isEqual=function(e,t){return _(e,t)},d.isEmpty=function(e){return e==null?!0:S(e)&&(d.isArray(e)||d.isString(e)||d.isArguments(e))?e.length===0:d.keys(e).length===0},d.isElement=function(e){return!!e&&e.nodeType===1},d.isArray=f||function(e){return u.call(e)==="[object Array]"},d.isObject=function(e){var t=typeof e;return t==="function"||t==="object"&&!!e},d.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(e){d["is"+e]=function(t){return u.call(t)==="[object "+e+"]"}}),d.isArguments(arguments)||(d.isArguments=function(e){return d.has(e,"callee")}),typeof /./!="function"&&typeof Int8Array!="object"&&(d.isFunction=function(e){return typeof e=="function"||!1}),d.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},d.isNaN=function(e){return d.isNumber(e)&&e!==+e},d.isBoolean=function(e){return e===!0||e===!1||u.call(e)==="[object Boolean]"},d.isNull=function(e){return e===null},d.isUndefined=function(e){return e===void 0},d.has=function(e,t){return e!=null&&a.call(e,t)},d.noConflict=function(){return e._=t,this},d.identity=function(e){return e},d.constant=function(e){return function(){return e}},d.noop=function(){},d.property=b,d.propertyOf=function(e){return e==null?function(){}:function(t){return e[t]}},d.matcher=d.matches=function(e){return e=d.extendOwn({},e),function(t){return d.isMatch(t,e)}},d.times=function(e,t,n){var r=Array(Math.max(0,e));t=v(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},d.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},d.now=Date.now||function(){return(new Date).getTime()};var D={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},P=d.invert(D),H=function(e){var t=function(t){return e[t]},n="(?:"+d.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=e==null?"":""+e,r.test(e)?e.replace(i,t):e}};d.escape=H(D),d.unescape=H(P),d.result=function(e,t,n){var r=e==null?void 0:e[t];return r===void 0&&(r=n),d.isFunction(r)?r.call(e):r};var B=0;d.uniqueId=function(e){var t=++B+"";return e?e+t:t},d.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var j=/(.)^/,F={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\u2028|\u2029/g,q=function(e){return"\\"+F[e]};d.template=function(e,t,n){!t&&n&&(t=n),t=d.defaults({},t,d.templateSettings);var r=RegExp([(t.escape||j).source,(t.interpolate||j).source,(t.evaluate||j).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(I,q),i=u+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(s+="';\n"+o+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return o.call(this,e,d)},f=t.variable||"obj";return a.source="function("+f+"){\n"+s+"}",a},d.chain=function(e){var t=d(e);return t._chain=!0,t};var R=function(e,t){return e._chain?d(t).chain():t};d.mixin=function(e){d.each(d.functions(e),function(t){var n=d[t]=e[t];d.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),R(this,n.apply(d,e))}})},d.mixin(d),d.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];d.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e==="shift"||e==="splice")&&n.length===0&&delete n[0],R(this,n)}}),d.each(["concat","join","slice"],function(e){var t=n[e];d.prototype[e]=function(){return R(this,t.apply(this._wrapped,arguments))}}),d.prototype.value=function(){return this._wrapped},d.prototype.valueOf=d.prototype.toJSON=d.prototype.value,d.prototype.toString=function(){return""+this._wrapped},typeof define=="function"&&define.amd&&define("underscore",[],function(){return d})}).call(this),function(e,t){if(typeof define=="function"&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)});else if(typeof exports!="undefined"){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.1.2",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events=void 0,this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,r){var i=this._listeningTo;if(!i)return this;var s=!t&&!r;!r&&typeof t=="object"&&(r=this),e&&((i={})[e._listenId]=e);for(var o in i)e=i[o],e.off(t,r,this),(s||n.isEmpty(e._events))&&delete this._listeningTo[o];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t);return}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeningTo||(this._listeningTo={}),o=t._listenId||(t._listenId=n.uniqueId("l"));return s[o]=t,!i&&typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(r=this.parse(r,t)||{}),r=n.defaults({},r,n.result(this,"defaults")),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=r);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)r=this._pending,this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},I(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t,r=n.extend({validate:!0},r);if(i&&!r.wait){if(!this.set(i,r))return!1}else if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},I(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;I(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||F();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t,{validationError:r})),!1):!0}});var v=["keys","values","pairs","invert","pick","omit"];n.each(v,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var m=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},y={add:!0,remove:!1};n.extend(m.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,y))},remove:function(e,t){var r=!n.isArray(e);e=r?[e]:n.clone(e),t||(t={});var i,s,o,u;for(i=0,s=e.length;i<s;i++){u=e[i]=this.get(e[i]);if(!u)continue;delete this._byId[u.id],delete this._byId[u.cid],o=this.indexOf(u),this.models.splice(o,1),this.length--,t.silent||(t.index=o,u.trigger("remove",u,this,t)),this._removeReference(u,t)}return r?e[0]:e},set:function(e,t){t=n.defaults({},t,g),t.parse&&(e=this.parse(e,t));var r=!n.isArray(e);e=r?e?[e]:[]:n.clone(e);var i,s,o,u,a,f,l,c=t.at,h=this.model,p=this.comparator&&c==null&&t.sort!==!1,v=n.isString(this.comparator)?this.comparator:null,m=[],y=[],b={},w=t.add,E=t.merge,S=t.remove,x=!p&&w&&S?[]:!1;for(i=0,s=e.length;i<s;i++){a=e[i]||{},a instanceof d?o=u=a:o=a[h.prototype.idAttribute||"id"];if(f=this.get(o))S&&(b[f.cid]=!0),E&&(a=a===u?u.attributes:a,t.parse&&(a=f.parse(a,t)),f.set(a,t),p&&!l&&f.hasChanged(v)&&(l=!0)),e[i]=f;else if(w){u=e[i]=this._prepareModel(a,t);if(!u)continue;m.push(u),this._addReference(u,t)}u=f||u,x&&(u.isNew()||!b[u.id])&&x.push(u),b[u.id]=!0}if(S){for(i=0,s=this.length;i<s;++i)b[(u=this.models[i]).cid]||y.push(u);y.length&&this.remove(y,t)}if(m.length||x&&x.length){p&&(l=!0),this.length+=m.length;if(c!=null)for(i=0,s=m.length;i<s;i++)this.models.splice(c+i,0,m[i]);else{x&&(this.models.length=0);var T=x||m;for(i=0,s=T.length;i<s;i++)this.models.push(T[i])}}l&&this.sort({silent:!0});if(!t.silent){for(i=0,s=m.length;i<s;i++)(u=m[i]).trigger("add",u,this,t);(l||x&&x.length)&&this.trigger("sort",this,t)}return r?e[0]:e},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return u.apply(this.models,arguments)},get:function(e){return e==null?void 0:this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},I(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(e,n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e;t=t?n.clone(t):{},t.collection=this;var r=new this.model(e,t);return r.validationError?(this.trigger("invalid",this,r.validationError,t),!1):r},_addReference:function(e,t){this._byId[e.cid]=e,e.id!=null&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){m.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var w=["groupBy","countBy","sortBy","indexBy"];n.each(w,function(e){m.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var E=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,x)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},S=/^(\S+)\s*(.*)$/,x=["model","collection","el","id","attributes","className","tagName","events"];n.extend(E.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(S),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||F()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&T&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var T=typeof window!="undefined"&&!!window.ActiveXObject&&(!window.XMLHttpRequest||!(new XMLHttpRequest).dispatchEvent),N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);s.execute(i,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/?]+)"}).replace(A,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e,t){return t===r.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/,B=/#.*$/;M.started=!1,n.extend(M.prototype,f,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(H,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/");if(s&&this._wantsHashChange){var o=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=o.hide().appendTo("body")[0].contentWindow,this.navigate(r)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var u=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&u.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:!!t};var n=this.root+(e=this.getFragment(e||""));e=e.replace(B,"");if(this.fragment===e)return;this.fragment=e,e===""&&n!=="/"&&(n=n.slice(0,-1));if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}if(t.trigger)return this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var j=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=m.extend=C.extend=E.extend=M.extend=j;var F=function(){throw new Error('A "url" property or function must be specified')},I=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t}),function(e,t){if(typeof define=="function"&&define.amd)define("marionette",["backbone","underscore"],function(n,r){return e.Marionette=e.Mn=t(e,n,r)});else if(typeof exports!="undefined"){var n=require("backbone"),r=require("underscore");module.exports=t(e,n,r)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,n){(function(e,t){var n=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;return this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===n)return delete this._indexByCustom[t],!0},this),delete this._views[n],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(r){t.isFunction(r[e])&&r[e].apply(r,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return t.each(r,function(e){n.prototype[e]=function(){var n=t.values(this._views),r=[n].concat(t.toArray(arguments));return t[e].apply(t,r)}}),n}(e,t),e.ChildViewContainer.VERSION="0.1.5",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=n,this},e.ChildViewContainer})(t,n),function(e,t){var n=e.Wreqr,r=e.Wreqr={};return e.Wreqr.VERSION="1.3.1",e.Wreqr.noConflict=function(){return e.Wreqr=n,this},r.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var r=null;t.isObject(e)&&!t.isFunction(e)&&(r=e.context,e=e.callback),this.setHandler(n,e,r)},this)},setHandler:function(e,t,n){var r={callback:t,context:n};this._wreqrHandlers[e]=r,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(!t)return;return function(){var e=Array.prototype.slice.apply(arguments);return t.callback.apply(t.context,e)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,t),r.CommandStorage=function(){var n=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(n.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var n=this.getCommands(e);n.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),n}(),r.Commands=function(e){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var n=Array.prototype.slice.call(arguments);e.Handlers.prototype.constructor.apply(this,n)},execute:function(e,t){e=arguments[0],t=Array.prototype.slice.call(arguments,1),this.hasHandler(e)?this.getHandler(e).apply(this,t):this.storage.addCommand(e,t)},_executeCommands:function(e,n,r){var i=this.storage.getCommands(e);t.each(i.instances,function(e){n.apply(r,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var n,r=e.storageType||this.storageType;t.isFunction(r)?n=new r:n=r,this.storage=n}})}(r),r.RequestResponse=function(e){return e.Handlers.extend({request:function(){var e=arguments[0],t=Array.prototype.slice.call(arguments,1);if(this.hasHandler(e))return this.getHandler(e).apply(this,t)}})}(r),r.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,t),r.Channel=function(n){var r=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(r.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,n,r){if(!n)return;r=r||this;var i=e==="vent"?"on":"setHandler";t.each(n,function(n,s){this[e][i](s,t.bind(n,r))},this)}}),r}(r),r.radio=function(e){var n=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(n.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var n=this._channels[t];return n||(n=new e.Channel(t),this._channels[t]=n),n},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(r[e],function(t){this[e][t]=i(this,e,t)},this)},this)}});var r={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},i=function(e,t,n){return function(r){var i=e._getChannel(r)[t],s=Array.prototype.slice.call(arguments,1);return i[n].apply(i,s)}};return new n}(r),e.Wreqr}(t,n);var r=e.Marionette,i=t.Marionette={};i.VERSION="2.3.2",i.noConflict=function(){return e.Marionette=r,this},t.Marionette=i,i.Deferred=t.$.Deferred,i.extend=t.Model.extend,i.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},i.getOption=function(e,t){if(!e||!t)return;return e.options&&e.options[t]!==undefined?e.options[t]:e[t]},i.proxyGetOption=function(e){return i.getOption(this,e)},i._getValue=function(e,t,r){return n.isFunction(e)&&(r=r||[],e=e.apply(t,r)),e},i.normalizeMethods=function(e){return n.reduce(e,function(e,t,r){return n.isFunction(t)||(t=this[t]),t&&(e[r]=t),e},{},this)},i.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z_$0-9]*/g,function(e){return t[e.slice(4)]})},i.normalizeUIKeys=function(e,t){return n.reduce(e,function(e,n,r){var s=i.normalizeUIString(r,t);return e[s]=n,e},{})},i.normalizeUIValues=function(e,t){return n.each(e,function(r,s){n.isString(r)&&(e[s]=i.normalizeUIString(r,t))}),e},i.actAsCollection=function(e,t){var r=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];n.each(r,function(r){e[r]=function(){var e=n.values(n.result(this,t)),i=[e].concat(n.toArray(arguments));return n[r].apply(n,i)}})};var s=i.deprecate=function(e,t){n.isObject(e)&&(e=e.prev+" is going to be removed in the future. "+"Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),(t===undefined||!t)&&!s._cache[e]&&(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._warn=typeof console!="undefined"&&(console.warn||console.log)||function(){},s._cache={},i._triggerMethod=function(){function t(e,t,n){return n.toUpperCase()}var e=/(^|:)(\w)/gi;return function(r,i,s){var o=arguments.length<3;o&&(s=i,i=s[0]);var u="on"+i.replace(e,t),a=r[u],f;return n.isFunction(a)&&(f=a.apply(r,o?n.rest(s):s)),n.isFunction(r.trigger)&&(o+s.length>1?r.trigger.apply(r,o?s:[i].concat(n.rest(s,0))):r.trigger(i)),f}}(),i.triggerMethod=function(e){return i._triggerMethod(this,arguments)},i.triggerMethodOn=function(e){var t=n.isFunction(e.triggerMethod)?e.triggerMethod:i.triggerMethod;return t.apply(e,n.rest(arguments))},i.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,s()}function r(){e._isRendered=!0,s()}function s(){e._isShown&&e._isRendered&&i.isNodeAttached(e.el)&&n.isFunction(e.triggerMethod)&&e.triggerMethod("dom:refresh")}e.on({show:t,render:r})},function(e){function t(t,r,i,s){var o=s.split(/\s+/);n.each(o,function(n){var s=t[n];if(!s)throw new e.Error('Method "'+n+'" was configured as an event handler, but does not exist.');t.listenTo(r,i,s)})}function r(e,t,n,r){e.listenTo(t,n,r)}function i(e,t,r,i){var s=i.split(/\s+/);n.each(s,function(n){var i=e[n];e.stopListening(t,r,i)})}function s(e,t,n,r){e.stopListening(t,n,r)}function o(t,r,i,s,o){if(!r||!i)return;if(!n.isObject(i))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});i=e._getValue(i,t),n.each(i,function(e,i){n.isFunction(e)?s(t,r,i,e):o(t,r,i,e)})}e.bindEntityEvents=function(e,n,i){o(e,n,i,r,t)},e.unbindEntityEvents=function(e,t,n){o(e,t,n,s,i)},e.proxyBindEntityEvents=function(t,n){return e.bindEntityEvents(this,t,n)},e.proxyUnbindEntityEvents=function(t,n){return e.unbindEntityEvents(this,t,n)}}(i);var o=["description","fileName","lineNumber","name","message","number"];return i.Error=i.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+i.VERSION+"/",constructor:function(e,t){n.isObject(e)?(t=e,e=t.message):t||(t={});var r=Error.call(this,e);n.extend(this,n.pick(r,o),n.pick(t,o)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,i.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),i.Error.extend=i.extend,i.Callbacks=function(){this._deferred=i.Deferred(),this._callbacks=[]},n.extend(i.Callbacks.prototype,{add:function(e,t){var r=n.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),r.then(function(n){t&&(n.context=t),e.call(n.context,n.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=i.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),i.Controller=function(e){this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},i.Controller.extend=i.extend,n.extend(i.Controller.prototype,t.Events,{destroy:function(){return i._triggerMethod(this,"before:destroy",arguments),i._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:i.triggerMethod,getOption:i.proxyGetOption}),i.Object=function(e){this.options=n.extend({},n.result(this,"options"),e),this.initialize.apply(this,arguments)},i.Object.extend=i.extend,n.extend(i.Object.prototype,t.Events,{initialize:function(){},destroy:function(){this.triggerMethod("before:destroy"),this.triggerMethod("destroy"),this.stopListening()},triggerMethod:i.triggerMethod,getOption:i.proxyGetOption,bindEntityEvents:i.proxyBindEntityEvents,unbindEntityEvents:i.proxyUnbindEntityEvents}),i.Region=i.Object.extend({constructor:function(e){this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el;if(!this.el)throw new i.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),i.Object.call(this,e)},show:function(e,t){if(!this._ensureElement())return;this._ensureViewIsIntact(e);var n=t||{},r=e!==this.currentView,s=!!n.preventDestroy,o=!!n.forceShow,u=!!this.currentView,a=r&&!s,f=r||o;u&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&delete this.currentView._parent,a?this.empty():u&&f&&this.currentView.off("destroy",this.empty,this);if(f){e.once("destroy",this.empty,this),e.render(),e._parent=this,u&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),i.triggerMethodOn(e,"before:show",e,this,t),u&&this.triggerMethod("swapOut",this.currentView,this,t);var l=i.isNodeAttached(this.el),c=[],h=n.triggerBeforeAttach||this.triggerBeforeAttach,p=n.triggerAttach||this.triggerAttach;return l&&h&&(c=this._displayedViews(e),this._triggerAttach(c,"before:")),this.attachHtml(e),this.currentView=e,l&&p&&(c=this._displayedViews(e),this._triggerAttach(c)),u&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),i.triggerMethodOn(e,"show",e,this,t),this}return this},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var r=(t||"")+"attach";n.each(e,function(e){i.triggerMethodOn(e,r,e,this)},this)},_displayedViews:function(e){return n.union([e],n.result(e,"_getNestedViews")||[])},_ensureElement:function(){n.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]);if(!this.$el||this.$el.length===0){if(this.getOption("allowMissingEl"))return!1;throw new i.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new i.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new i.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,i._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(){var e=this.currentView;if(!e)return;return e.off("destroy",this.empty,this),this.triggerMethod("before:empty",e),this._destroyView(),this.triggerMethod("empty",e),delete this.currentView,this},_destroyView:function(){var e=this.currentView;e.destroy&&!e.isDestroyed?e.destroy():e.remove&&(e.remove(),e.isDestroyed=!0)},attachView:function(e){return this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(n.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(n.isFunction(e))return this._buildRegionFromRegionClass(e);throw new i.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var r=e.regionClass||t,i=n.omit(e,"selector","regionClass");return e.selector&&!i.el&&(i.el=e.selector),new r(i)},_buildRegionFromRegionClass:function(e){return new e}}),i.RegionManager=i.Controller.extend({constructor:function(e){this._regions={},i.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=i._getValue(e,this,arguments),n.reduce(e,function(e,r,i){return n.isString(r)&&(r={selector:r}),r.selector&&(r=n.defaults({},r,t)),e[i]=this.addRegion(i,r),e},{},this)},addRegion:function(e,t){var n;return t instanceof i.Region?n=t:n=i.Region.buildRegion(t,i.Region),this.triggerMethod("before:add:region",e,n),n._parent=this,this._store(e,n),this.triggerMethod("add:region",e,n),n},get:function(e){return this._regions[e]},getRegions:function(){return n.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return n.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return n.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),i.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]=t,this._setLength()},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this._setLength(),this.triggerMethod("remove:region",e,t)},_setLength:function(){this.length=n.size(this._regions)}}),i.actAsCollection(i.RegionManager.prototype,"_regions"),i.TemplateCache=function(e){this.templateId=e},n.extend(i.TemplateCache,{templateCaches:{},get:function(e){var t=this.templateCaches[e];return t||(t=new i.TemplateCache(e),this.templateCaches[e]=t),t.load()},clear:function(){var e,t=n.toArray(arguments),r=t.length;if(r>0)for(e=0;e<r;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(i.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var e=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(e),this.compiledTemplate},loadTemplate:function(e){var n=t.$(e).html();if(!n||n.length===0)throw new i.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return n},compileTemplate:function(e){return n.template(e)}}),i.Renderer={render:function(e,t){if(!e)throw new i.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var r=n.isFunction(e)?e:i.TemplateCache.get(e);return r(t)}},i.View=t.View.extend({isDestroyed:!1,constructor:function(e){n.bindAll(this,"render"),e=i._getValue(e,this),this.options=n.extend({},n.result(this,"options"),e),this._behaviors=i.Behaviors(this),t.View.apply(this,arguments),i.MonitorDOMRefresh(this),this.on("show",this.onShowCalled)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,n.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=i._getValue(t,this),n.extend(e,t)},normalizeUIKeys:function(e){var t=n.result(this,"_uiBindings");return i.normalizeUIKeys(e,t||n.result(this,"ui"))},normalizeUIValues:function(e){var t=n.result(this,"ui"),r=n.result(this,"_uiBindings");return i.normalizeUIValues(e,r||t)},configureTriggers:function(){if(!this.triggers)return;var e=this.normalizeUIKeys(n.result(this,"triggers"));return n.reduce(e,function(e,t,n){return e[n]=this._buildViewTrigger(t),e},{},this)},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var r=i._getValue(e||this.events,this);r=this.normalizeUIKeys(r),n.isUndefined(e)&&(this.events=r);var s={},o=n.result(this,"behaviorEvents")||{},u=this.configureTriggers(),a=n.result(this,"behaviorTriggers")||{};n.extend(s,o,r,u,a),t.View.prototype.delegateEvents.call(this,s)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},onShowCalled:function(){},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new i.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return;var e=n.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.remove(),n.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),n.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(!this.ui)return;this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(e,function(e,t){this.ui[t]=this.$(e)},this)},unbindUIElements:function(){this._unbindUIElements(),n.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){if(!this.ui||!this._uiBindings)return;n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings},_buildViewTrigger:function(e){var t=n.isObject(e),r=n.defaults({},t?e:{},{preventDefault:!0,stopPropagation:!0}),i=t?r.event:e;return function(e){e&&(e.preventDefault&&r.preventDefault&&e.preventDefault(),e.stopPropagation&&r.stopPropagation&&e.stopPropagation());var t={view:this,model:this.model,collection:this.collection};this.triggerMethod(i,t)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return n.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=i._triggerMethod,t=e(this,arguments),n=this._behaviors;for(var r=0,s=n&&n.length;r<s;r++)e(n[r],arguments);return t},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?n.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},normalizeMethods:i.normalizeMethods,getOption:i.proxyGetOption,bindEntityEvents:i.proxyBindEntityEvents,unbindEntityEvents:i.proxyUnbindEntityEvents}),i.ItemView=i.View.extend({constructor:function(){i.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,n.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e===!1)return;if(!e)throw new i.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.serializeData();t=this.mixinTemplateHelpers(t);var n=i.Renderer.render(e,t,this);return this.attachElContent(n),this},attachElContent:function(e){return this.$el.html(e),this}}),i.CollectionView=i.View.extend({childViewEventPrefix:"childview",constructor:function(e){var t=e||{};n.isUndefined(this.sort)&&(this.sort=n.isUndefined(t.sort)?!0:t.sort),this.once("render",this._initialEvents),this._initChildViewStorage(),i.View.apply(this,arguments),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this._triggerBeforeShowBufferedChildren(),this.attachBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerBeforeShowBufferedChildren:function(){this._isShown&&n.each(this._bufferedChildren,n.partial(this._triggerMethodOnChild,"before:show"))},_triggerShowBufferedChildren:function(){this._isShown&&(n.each(this._bufferedChildren,n.partial(this._triggerMethodOnChild,"show")),this._bufferedChildren=[])},_triggerMethodOnChild:function(e,t){i.triggerMethodOn(t,e)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e){this.destroyEmptyView();var t=this.getChildView(e),n=this.collection.indexOf(e);this.addChild(e,t,n)},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},onShowCalled:function(){this.children.each(n.partial(this._triggerMethodOnChild,"show"))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.triggerMethod("render",this),this},resortView:function(){this.render()},_sortViews:function(){var e=this.collection.find(function(e,t){var n=this.children.findByModel(e);return!n||n._index!==t},this);e&&this.resortView()},_emptyViewIndex:-1,_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren(),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this))},showCollection:function(){var e;this.collection.each(function(t,n){e=this.getChildView(t),this.addChild(t,e,n)},this)},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var n=new t.Model;this.addEmptyView(n,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var r=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");n.isFunction(r)&&(r=r.call(this,e,this._emptyViewIndex));var s=this.buildChildView(e,t,r);s._parent=this,this.proxyChildEvents(s),this._isShown&&i.triggerMethodOn(s,"before:show"),this.children.add(s),this.renderChildView(s,this._emptyViewIndex),this._isShown&&i.triggerMethodOn(s,"show")},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new i.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,n){var r=this.getOption("childViewOptions");r=i._getValue(r,this,[e,n]);var s=this.buildChildView(e,t,r);return this._updateIndices(s,!0,n),this._addChildView(s,n),s._parent=this,s},_updateIndices:function(e,t,n){if(!this.sort)return;t&&(e._index=n),this.children.each(function(n){n._index>=e._index&&(n._index+=t?1:-1)})},_addChildView:function(e,t){this.proxyChildEvents(e),this.triggerMethod("before:add:child",e),this.children.add(e),this.renderChildView(e,t),this._isShown&&!this.isBuffering&&i.triggerMethodOn(e,"show"),this.triggerMethod("add:child",e)},renderChildView:function(e,t){return e.render(),this.attachHtml(this,e,t),e},buildChildView:function(e,t,r){var i=n.extend({model:e},r);return new t(i)},removeChildView:function(e){return e&&(this.triggerMethod("before:remove:child",e),e.destroy?e.destroy():e.remove&&e.remove(),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1)),e},isEmpty:function(){return!this.collection||this.collection.length===0},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},attachHtml:function(e,t,n){e.isBuffering?(e.elBuffer.appendChild(t.el),e._bufferedChildren.push(t)):e._insertBefore(t,n)||e._insertAfter(t)},_insertBefore:function(e,t){var n,r=this.sort&&t<this.children.length-1;return r&&(n=this.children.find(function(e){return e._index===t+1})),n?(n.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){if(this.isDestroyed)return;return this.triggerMethod("before:destroy:collection"),this.destroyChildren(),this.triggerMethod("destroy:collection"),i.View.prototype.destroy.apply(this,arguments)},destroyChildren:function(){var e=this.children.map(n.identity);return this.children.each(this.removeChildView,this),this.checkEmpty(),e},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var r=n.toArray(arguments),i=r[0],s=this.normalizeMethods(n.result(this,"childEvents"));r[0]=t+":"+i,r.splice(1,0,e),typeof s!="undefined"&&n.isFunction(s[i])&&s[i].apply(this,r.slice(1)),this.triggerMethod.apply(this,r)},this)},_getImmediateChildren:function(){return n.values(this.children._views)}}),i.CompositeView=i.CollectionView.extend({constructor:function(){i.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.sort&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){var t=this.getOption("childView")||this.constructor;return t},serializeData:function(){var e={};return this.model&&(e=n.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this.isRendered=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this.triggerMethod("render",this),this},_renderChildren:function(){this.isRendered&&i.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),n=i.Renderer.render(t,e,this);this.attachElContent(n),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var n=this.getChildViewContainer(e);n.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},getChildViewContainer:function(e,t){if("$childViewContainer"in e)return e.$childViewContainer;var n,r=i.getOption(e,"childViewContainer");if(r){var s=i._getValue(r,e);s.charAt(0)==="@"&&e.ui?n=e.ui[s.substr(4)]:n=e.$(s);if(n.length<=0)throw new i.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else n=e.$el;return e.$childViewContainer=n,n},resetChildViewContainer:function(){this.$childViewContainer&&delete this.$childViewContainer}}),i.LayoutView=i.ItemView.extend({regionClass:i.Region,constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),i.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),i.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.regionManager.destroy(),i.ItemView.prototype.destroy.apply(this,arguments))},addRegion:function(e,t){var n={};return n[e]=t,this._buildRegions(n)[e]},addRegions:function(e){return this.regions=n.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:n.partial(n.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=i._getValue(this.regions,this,[e])||{};var r=this.getOption.call(e,"regions");r=i._getValue(r,this,[e]),n.extend(t,r),t=this.normalizeUIValues(t),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new i.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return n.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),i.Behavior=i.Object.extend({constructor:function(e,t){this.view=t,this.defaults=n.result(this,"defaults")||{},this.options=n.extend({},this.defaults,e),i.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){this.stopListening()},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),i.Behaviors=function(e,t){function r(e,n){return t.isObject(e.behaviors)?(n=r.parseBehaviors(e,n||t.result(e,"behaviors")),r.wrap(e,n,t.keys(i)),n):{}}function s(e,n){this._view=e,this._viewUI=t.result(e,"ui"),this._behaviors=n,this._triggers={}}var n=/^(\S+)\s*(.*)$/,i={behaviorTriggers:function(e,t){var n=new s(this,t);return n.buildBehaviorTriggers()},behaviorEvents:function(r,i){var s={},o=this._uiBindings||t.result(this,"ui");return t.each(i,function(r,i){var u={},a=t.clone(t.result(r,"events"))||{},f=r._uiBindings||t.result(r,"ui"),l=t.extend({},o,f);a=e.normalizeUIKeys(a,l);var c=0;t.each(a,function(e,s){var o=s.match(n),a=o[1]+"."+[this.cid,i,c++," "].join(""),f=o[2],l=a+f,h=t.isFunction(e)?e:r[e];u[l]=t.bind(h,r)},this),s=t.extend(s,u)},this),s}};return t.extend(r,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(r.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,i){var s=r.getBehaviorClass(n,i),o=new s(n,e),u=r.parseBehaviors(e,t.result(o,"behaviors"));return[o].concat(u)}).flatten().value()},wrap:function(e,n,r){t.each(r,function(r){e[r]=t.partial(i[r],e[r],n)})}}),t.extend(s.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(n,r){var i=t.extend({},this._viewUI,t.result(n,"ui")),s=t.clone(t.result(n,"triggers"))||{};s=e.normalizeUIKeys(s,i),t.each(s,t.bind(this._setHandlerForBehavior,this,n,r))},_setHandlerForBehavior:function(e,t,n,r){var i=r.replace(/^\S+/,function(e){return e+"."+"behaviortriggers"+t});this._triggers[i]=this._view._buildViewTrigger(n)}}),r}(i,n),i.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var n=this.getOption("appRoutes"),r=this._getController();this.processAppRoutes(r,n),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var n=this._getController();this._addAppRoute(n,e,t)},_processOnRoute:function(e,t){if(n.isFunction(this.onRoute)){var r=n.invert(this.getOption("appRoutes"))[e];this.onRoute(e,r,t)}},processAppRoutes:function(e,t){if(!t)return;var r=n.keys(t).reverse();n.each(r,function(n){this._addAppRoute(e,n,t[n])},this)},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,r){var s=e[r];if(!s)throw new i.Error('Method "'+r+'" was not found on the controller');this.route(t,r,n.bind(s,e))},getOption:i.proxyGetOption,triggerMethod:i.triggerMethod,bindEntityEvents:i.proxyBindEntityEvents,unbindEntityEvents:i.proxyUnbindEntityEvents}),i.Application=i.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new i.Callbacks,this.submodules={},n.extend(this,e),this._initChannel(),i.Object.call(this,e)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var r=i.Module.getClass(t),s=n.toArray(arguments);return s.unshift(this),r.create.apply(r,s)},getRegionManager:function(){return new i.RegionManager},_initializeRegions:function(e){var t=n.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var r=i.getOption(e,"regions");return n.isFunction(r)&&(r=r.call(this,e)),n.extend(t,r),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){i._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,i._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){i._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],i._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=n.result(this,"channelName")||"global",this.channel=n.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=n.result(this,"vent")||this.channel.vent,this.commands=n.result(this,"commands")||this.channel.commands,this.reqres=n.result(this,"reqres")||this.channel.reqres}}),i.Module=function(e,t,r){this.moduleName=e,this.options=n.extend({},this.options,r),this.initialize=r.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,n.isFunction(this.initialize)&&this.initialize(e,t,this.options)},i.Module.extend=i.extend,n.extend(i.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){if(this._isInitialized)return;n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e)},stop:function(){if(!this._isInitialized)return;this._isInitialized=!1,this.triggerMethod("before:stop"),n.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(undefined,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop")},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,r){if(!e)return;var s=n.flatten([this,this.app,t,i,t.$,n,r]);e.apply(this,s)},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new i.Callbacks,this._finalizerCallbacks=new i.Callbacks},triggerMethod:i.triggerMethod}),n.extend(i.Module,{create:function(e,t,r){var i=e,s=n.rest(arguments,3);t=t.split(".");var o=t.length,u=[];return u[o-1]=r,n.each(t,function(t,n){var o=i;i=this._getModule(o,t,e,r),this._addModuleDefinition(o,i,u[n],s)},this),i},_getModule:function(e,t,r,i,s){var o=n.extend({},i),u=this.getClass(i),a=e[t];return a||(a=new u(t,r,o),e[t]=a,e.submodules[t]=a),a},getClass:function(e){var t=i.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,n,r){var i=this._getDefine(n),s=this._getStartWithParent(n,t);i&&t.addDefinition(i,r),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var r;return n.isFunction(e)&&e.prototype instanceof i.Module?(r=t.constructor.prototype.startWithParent,n.isUndefined(r)?!0:r):n.isObject(e)?(r=e.startWithParent,n.isUndefined(r)?!0:r):!0},_getDefine:function(e){return!n.isFunction(e)||e.prototype instanceof i.Module?n.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,n){t.startWithParent=t.startWithParent&&n;if(!t.startWithParent||!!t.startWithParentIsConfigured)return;t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)})}}),i}),function(e){typeof define=="function"&&define.amd?define("jcookie",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){function n(e){return u.raw?e:encodeURIComponent(e)}function r(e){return u.raw?e:decodeURIComponent(e)}function i(e){return n(u.json?JSON.stringify(e):String(e))}function s(e){e.indexOf('"')===0&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(t," ")),u.json?JSON.parse(e):e}catch(n){}}function o(t,n){var r=u.raw?t:s(t);return e.isFunction(n)?n(r):r}var t=/\+/g,u=e.cookie=function(t,s,a){if(s!==undefined&&!e.isFunction(s)){a=e.extend({},u.defaults,a);if(typeof a.expires=="number"){var f=a.expires,l=a.expires=new Date;l.setTime(+l+f*864e5)}return document.cookie=[n(t),"=",i(s),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("")}var c=t?undefined:{},h=document.cookie?document.cookie.split("; "):[];for(var p=0,d=h.length;p<d;p++){var v=h[p].split("="),m=r(v.shift()),g=v.join("=");if(t&&t===m){c=o(g,s);break}!t&&(g=o(g))!==undefined&&(c[m]=g)}return c};u.defaults={},e.removeCookie=function(t,n){return e.cookie(t)===undefined?!1:(e.cookie(t,"",e.extend({},n,{expires:-1})),!e.cookie(t))}}),define("base/utils",["jquery","underscore","jcookie"],function(e,t){return Date.prototype.addMonth=function(e){return this.setMonth(this.getMonth()+parseInt(e)),this},Date.prototype.addHours=function(e){return this.setHours(this.getHours()+parseInt(e)),this},{getRemembedCity:function(){var t=null,n=e.cookie("location_city_id");return n&&(t=parseInt(n.split("~")[1])),t},parseQueryString:function(e){if(!t.isString(e))return;e=e.substring(e.indexOf("?")+1);var n={},r=decodeURI(e).split(/&/g);return t.each(r,function(e){var r=e.split("=");r.length>=1&&(e=undefined,r.length==2&&(e=r[1],e.split(",").length>1&&(e=e.split(","))),n[r[0]]?(t.isArray(n[r[0]])||(n[r[0]]=[n[r[0]]]),n[r[0]].push(e)):n[r[0]]=e)}),n},toQueryString:function(e){var n=0,r="";return t.each(e,function(e,t){n!==0&&(r+="&"),r+=t+"="+e,n++}),r!==""&&(r="?"+r),r},priceFormat:function(e){var t,n,r=0,i=" ",s=".",o="# р.",u=parseFloat(e),a=Math.pow(10,r);return u=Math.round(u*a)/a,t=Number(u).toFixed(r).toString().split("."),n=t[0].replace(/(\d{1,3}(?=(\d{3})+(?:\.\d|\b)))/g,"$1"+i),u=t[1]?n+s+t[1]:n,o.replace("#",u)},months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],getFutureMonths:function(e){e=e||12;var t=new Date,n=new Date,r=0,i=[];while(r<e){var s={};s.month=n.getMonth(),s.realMonth=s.month+1,s.monthName=this.months[s.month],s.year=n.getFullYear(),s.fullDate=n.getFullYear()+"-"+(s.realMonth>9?s.realMonth:"0"+s.realMonth)+"-01",s.showDate="01."+(s.realMonth>9?s.realMonth:"0"+s.realMonth)+"."+n.getFullYear(),this.dayDiff(t,n)<15&&(s.disabled=!0),i.push(s),n=n.addMonth(1),r++}return i},dayDiff:function(e,t){var n=new Date(e),r=new Date(t);return parseInt((r-n)/864e5)},toLocaleDateTime:function(e){return new Date(Date.parse(e))},iconPreload:function(e,n,r){var i=0;e=e||[],t.each(e,function(t){t="/static/images/"+t;var s=document.createElement("img");s.onload=function(){n.attr("src",t).attr("height",25),i==e.length-1&&r&&n.attr("src",r),i++},s.error=function(){i++},s.src=t})}}}),define("base/routers/index",["marionette","base/utils"],function(e,t){return e.AppRouter.extend({onRoute:function(e,n,r){var i=r[0],s=/\((.*)\)+/ig;app.currentBaseUrl=n?n.replace(s,""):"",app.currentQueryParams=t.parseQueryString(i)}})}),define("lib/text",["module"],function(e){var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.14",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.lastIndexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i[0]==="﻿"&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("lib/text!templates/searchPopup.tmpl",[],function(){return'<% if (objects_found()) { %> \n	<p>Найдено <%=objects_found()%> объявлений. Нажмите Enter чтобы посмотреть все</p>\n<% } %>\n<div class="js-objects"></div>\n<% if (pricerows_found()) { %> \n	<p>Найдено <%=pricerows_found()%> позиций в прайс-листах</p>\n<% } %>\n<div  class="js-pricerows"></div>'}),define("lib/text!templates/filters/listFilterItem.tmpl",[],function(){return'<div class="cont">\n	<select name="<%=seo_name%>">\n		<option value="0"><%=title%></option>\n		<% _.each(values, function(value, key) { %>\n			<option value="<%=key%>"><%=value%></option>\n		<% }); %>\n	</select>\n</div>'}),define("lib/text!templates/filters/listBoxFilterItem.tmpl",[],function(){return'<div class="multiselect li ">\n	<div class="cont js-filter-label">\n	<p><span class="name bold"><%=title%></span></p>\n	<p><span class="info js-filter-str-value">Не важно</span></p>\n</div>\n<% var cols = 5; %>\n<% if (_.keys(values).length <= cols) { rows = 5; cols = 1;} else { %>\n	<% var rows = Math.round(_.keys(values).length/cols); %>\n<% } %>\n<% var i = 0; %>\n\n<div class="checkbox js-filter-values-cont" style="display: none;z-index:90;">\n	<div class="filters-items" style="width:<%=155*cols%>px">\n		<div class="line" style="float:left;">\n			<div style="width:100%;float: left;"><label><input class="js-filter-anyinput" type="checkbox" disabled checked data-type="service"><span>Не важно</span></label></div>\n			<% _.each(_.range(cols), function(col) { %>\n				<div class="column-list">\n					<% _.each(_.keys(values).slice(i, i + rows), function(key){ %>\n						<div><label><input type="checkbox" name="<%=seo_name%>[<%=key%>]" value="<%=clearValue(key)%>" data-str="<%=values[key]%>" <%=checked(key)%>><span><%=values[key]%></span></label></div>\n					<% }); %>\n				</div>\n				<% i = i + rows;  %>\n			<% }); %>\n		</div>\n	</div>\n	<div class="operations-cont"><input class="js-filter-ok" type="button" value="ОК"></div>\n</div>'}),define("lib/text!templates/filters/numericFilterItem.tmpl",[],function(){return'<div class="multiselect">\n	<div class="cont js-filter-label">\n	<p><span class="name bold"><%=title%></span></p>\n	<p><span class="info js-filter-str-value">Не важно</span></p>\n</div>\n<div class="checkbox js-filter-values-cont" style="display: none;z-index:90;">\n	<div class="filters-range">\n		<div class="line">\n			<p class="mb5"><span><%=title%></span>,&nbsp;<span class=""><%=unit%></span></p>\n			<span class="range-l">от</span>\n			<input autocomplete="off" type="text" class="first" name="<%=seo_name%>[min]" value="<%=((value)?value.min:\'\') %>">\n			<span class="range-l">до </span>\n			<input autocomplete="off" type="text" class="last" name="<%=seo_name%>[max]" value="<%=((value)?value.max:\'\') %>">\n		</div>\n	</div>\n	<div class="operations-cont"><input class="js-filter-ok" type="button" value="ОК"></div>\n</div>'}),define("lib/text!templates/filters/ilistFilterItem.tmpl",[],function(){return'<div class="multiselect">\n	<div class="cont js-filter-label">\n	<p><span class="name bold"><%=title%></span></p>\n	<p><span class="info js-filter-str-value">Не важно</span></p>\n</div>\n<div class="checkbox js-filter-values-cont" style="display: none;z-index:90;">\n	<div class="filters-range">\n		<div class="line">\n			<p class="mb5"><span><%=title%></span>,&nbsp;<span class=""><%=unit%></span></p>\n			<span class="range-l">от</span>\n			<select name="<%=seo_name%>[min]">\n				<option value="0">--</option>\n				<% _.each(values, function(option_value, key) { %>\n					<% var value_min = (value && value.min == option_value) ? "selected" : ""; %>\n					<option value="<%=key%>" <%=value_min%>><%=option_value%></option>\n				<% }); %>\n			</select>\n			<span class="range-l">до </span>\n			<select name="<%=seo_name%>[max]">\n				<option value="0">--</option>\n				<% _.each(values, function(option_value, key) { %>\n					<% var value_max = (value && value.max == option_value) ? "selected" : ""; %>\n					<option value="<%=key%>" <%=value_max%>><%=option_value%></option>\n				<% }); %>\n			</select>\n		</div>\n	</div>\n	<div class="operations-cont"><input class="js-filter-ok" type="button" value="ОК"></div>\n</div>'}),define("lib/text!templates/filters/textFilterItem.tmpl",[],function(){return'<div class="multiselect li ">\n	<div class="cont js-filter-label">\n	<p><span class="name bold"><%=title%></span></p>\n	<p><span class="info js-filter-str-value">Не важно</span></p>\n</div>\n<div class="checkbox js-filter-values-cont" style="display: none;z-index:90;">\n	<div class="filters-range">\n		<div class="line">\n			<label>\n				<p class="mb5"><span><%=title%></span></p>\n				<input autocomplete="off" type="text" name="<%=seo_name%>" value="<%=value%>">\n			</label>						\n		</div>\n	</div>\n	<div class="operations-cont"><input class="js-filter-ok" type="button" value="ОК"></div>\n</div>'}),define("lib/text!templates/filters/listPopup.tmpl",[],function(){return""}),define("lib/text!templates/windows/service.tmpl",[],function(){return'<div class="popup-window w650">	\n	<div class="header">\n		<%=getTitle()%>\n		<div class="popup-window-close js-close">\n			<i class="ico close-ico16"></i>\n		</div>			\n	</div>					\n	<div class="cont">\n		<form>		\n			<div class="service-cont js-service-cont"></div>\n			<% if (code < 400) { %>\n				<div class="row mt10">\n					<div class="col-md-6"><button class="w100p button button-style1 bg-color-blue white mb5 js-tocontinue">В корзину и продолжить</button></div>\n					<div class="col-md-6"><button class="w100p button button-style1 bg-color-blue white js-tocart">Перейти к оформлению</button></div>\n				</div>\n			<% } %>\n		</form>\n	</div>\n</div>\n'}),define("lib/text!templates/windows/backcall.tmpl",[],function(){return'<div class="popup-window w500">	\n	<div class="header">\n		Введите ваши данные для обратной связи\n		<div class="popup-window-close js-close">\n			<i class="ico close-ico16"></i>\n		</div>			\n	</div>					\n	<div class="cont form-cont">\n		<form class="js-form">\n			<div class="row">\n				<div class="col-md-12">\n					<label class="bold"><span class="red fs20">*</span> Как к Вам обращаться?</label>\n				</div>\n				<div class="col-md-12">\n					<div class="inp-cont <% if (getError("name")) { %>error<% } %>">																								\n						<input class="w100p" type="text" name="name" value="<%=name%>">\n						<% if (getError("name")) { %>\n								<span class="inform"><%=getError("name")%></span>\n						<% } %>						\n					</div>\n				</div>\n			</div>\n\n			<div class="row">\n				<div class="col-md-12">\n					<label class="bold"><span class="red fs20">*</span> Номер телефона:</label>\n				</div>\n				<div class="col-md-12">\n					<div class="inp-cont <% if (getError("phone")) { %>error<% } %>">																		\n						<input class="w100p" type="text" name="phone" value="<%=phone%>">\n						<span class="inform">В формате 7(XXX)XXX-XX-XX</span>\n						<% if (getError("phone")) { %>\n								<span class="inform"><%=getError("phone")%></span>\n						<% } %>						\n					</div>\n				</div>\n			</div>\n\n			<div class="row">\n				<div class="col-md-12">\n					<label class="bold">Комментарий:</label>\n				</div>\n				<div class="col-md-12">\n					<div class="inp-cont <% if (getError("comment")) { %>error<% } %>">																	\n						<textarea class="w100p" cols="30" rows="10" name="comment"><%=comment%></textarea>\n						<span class="inform">Например время, в которое вам удобно принять звонок</span>\n						<% if (getError("comment")) { %>\n								<span class="inform"><%=getError("comment")%></span>\n						<% } %>						\n					</div>\n				</div>\n			</div>\n\n			<div class="row mt10">\n				<div class="col-md-6">&nbsp;</div>\n				<div class="col-md-6"><button class="w100 button button-style1 bg-color-blue white js-ok fr">OK</button></div>\n			</div>\n		</form>\n	</div>\n</div>\n'}),define("lib/text!templates/windows/object_callback.tmpl",[],function(){return'<div class="popup-window w500">	\n	<div class="header">\n		Снятие объявлений\n		<div class="popup-window-close js-close">\n			<i class="ico close-ico16"></i>\n		</div>			\n	</div>					\n	<div class="cont">\n		<form class="js-form">\n			<div class="mt10">\n				Пожалуйста, отметьте причину снятия объявлений с публикации\n			</div>\n			<div class="mt10">\n				<% var reasons = {\'sold_yarmarka\':\'Я продал на Ярмарке\', \'sold_yarmarka_paper\':\'Я продал через газету\', \'sold_somewhere\':\'Я продал где-то еще\', \'other\':\'Другая причина\'}; %>\n				<% _.each(reasons, function(value, key) {%>\n					<p class="p5">\n					<input type="radio" name="reason" value="<%=key%>" id="radio_<%=key%>"><label for="radio_<%=key%>" class="ml5 pointer"><%=value%></label>\n					</p>\n				<% }); %>\n			</div>\n			<div class="row mt10">\n				<div class="col-md-6">&nbsp;</div>\n				<div class="col-md-6"><button class="w100 button button-style1 bg-color-blue white js-ok fr">OK</button></div>\n			</div>\n		</form>\n	</div>\n</div>\n'}),define("lib/text!templates/windows/message.tmpl",[],function(){return'<div class="popup-window w500">	\n	<div class="header">\n		<%=getTitle()%>\n	</div>					\n	<div class="cont">\n		<div class="row mt10">\n			<div class="col-md-12 p10"><%=getText()%></div>\n		</div>\n		<% if (!getDisableOk()) { %>\n			<div class="row mt10">\n				<div class="col-md-6">&nbsp;</div>\n				<div class="col-md-6"><button class="w100 button button-style1 bg-color-blue white js-ok fr">OK</button></div>\n			</div>\n		<% } %>\n	</div>\n</div>\n'}),define("lib/text!templates/windows/editService.tmpl",[],function(){return'<div class="popup-window w500 z400">	\n	<div class="header">\n		<%=title%>\n		<div class="popup-window-close js-close">\n			<i class="ico close-ico16"></i>\n		</div>			\n	</div>					\n	<div class="cont">\n		<form>		\n			<div class="service-cont js-service-cont"></div>\n			<% if (code < 400) { %>\n				<div class="row mt10">\n					<div class="col-md-12"><button class="w100 button button-style1 bg-color-blue white js-ok fr">OK</button></div>\n				</div>\n			<% } %>\n		</form>\n	</div>\n</div>\n'}),define("lib/text!templates/services/up.tmpl",[],function(){return'<div class="description-cont">\n	<p>Если вы приобретаете <strong>сразу несколько подъемов</strong> для одного объявления, услуга активируется автоматически купленное количество раз каждый  день, выводя объявление вверх списка. Услуга платная</p>\n</div>\n<% if (info.count && info.count > 0) { %>\n	<div class="p10">Каждый день начисляется 3 бесплатных подъема</div>\n	<div class="p10">Осталось бесплатных: <%=info.count%></div>\n<% } else { %>\n	<div class="p10">Бесплатные подъемы использованы.</div>\n<% } %>\n<table class="table table-bordered">\n	<thead>\n		<th class="service-title">Услуга</th>\n		<th class="quantity">Количество</th>\n		<th class="price">Цена</th>\n	</thead>\n	<tbody>\n	<tr>\n		<td class="service-title"><%=getTitle()%></td>\n		<td class="quantity">\n			<% var quantity  = 1; %>\n			<% if (is_edit) { \n				quantity = edit_params.service.quantity;\n			} %>\n			<input class="js-quantity" type="number" value="<%=quantity%>" min="1" max="99">\n		</td>\n		<td class="price">\n			<span class="js-price">\n				<%=getPrice()%>\n			</span>\n		</td>\n	</tr>\n	</tbody>\n</table>\n\n<% if (info.code > 200 && info.code < 400) { %>\n	<%=info.text%>\n<% } %>\n\n<% if (info.code >= 400) { %>\n	<p>Вы не можете воспользоваться этой услугой, потому что объявление заполнено не полностью.</p>\n	<p><%=info.text%></p>\n<% } %>\n'}),define("lib/text!templates/services/premium.tmpl",[],function(){return'<div class="description-cont">\n	<img class="fr ml10 mb5" src="<%=getStaticPath()%>images/content/11.jpg">\n	<p><strong>Премиум-объявление</strong> в течение 7 дней отображается в специальном блоке на сайте. Этот блок располагается на самом видимом месте - сверху, над обычными объявлениями в поисковой выдаче:</p>\n	<p>Услуга также предусматривает поднятие объявления на первое место страницы поиска в момент применения.</p>\n	<p>На каждой странице рубрики в премиум-блоке размещается не более 5 объявлений. Объявления выводятся в соответствии с запросами посетителей сайта, в хронологическом порядке. По мере добавления новых премиум-объявлений, остальные объявления смещаются на следующие страницы. Таким образом, выше всегда будут находиться наиболее актуальные предложения.</p>\n	<p><strong>Я уже разместил бесплатное объявление, зачем мне премиум?</strong></p>\n	<p>Ежедневно yarmarka.biz посещают порядка 10 тысяч человек, большинство из них создают новые объявления - при таком потоке многие из них быстро теряются в результатах поиска. Премиум-объявления привлекают к себе гораздо больше внимания, всегда находятся выше других объявлений в рубриках и гарантируют более быстрый отклик на Ваше предложение в сравнении с обычными объявлениями.</p>\n	<p>Если вы приобретаете <strong>сразу несколько премиумов</strong> для одного объявления, услуга активируется автоматически купленное количество раз каждые 7 дней, выводя объявление вверх списка каждые 7 дней</p>\n</div>\n<% if (info.count && info.count > 0) { %>\n	<div class="p10">Осталось бесплатных: <%=info.count%></div>\n<% } %>\n<table class="table table-bordered">\n	<thead>\n		<th class="service-title">Услуга</th>\n		<th class="quantity">Количество</th>\n		<th class="price w150">Цена</th>\n	</thead>\n	<tbody>\n	<tr>\n		<td class="service-title"><%=getTitle()%></td>\n		<td class="quantity">\n			<% var quantity  = 1; %>\n			<% if (is_edit) { \n				quantity = edit_params.service.quantity;\n			} %>\n			<input class="js-quantity" type="number" value="<%=quantity%>" min="1" max="99">\n		</td>\n		<td class="price w150">\n			<span class="js-price">\n				<%=getPrice()%>\n			</span>\n		</td>\n	</tr>\n	</tbody>\n</table>\n\n<% if (info.code > 200 && info.code < 400) { %>\n	<%=info.text%>\n<% } %>\n\n<% if (info.code >= 400) { %>\n	<p>Вы не можете воспользоваться этой услугой, потому что объявление заполнено не полностью.</p>\n	<p><%=info.text%></p>\n<% } %>\n'}),define("lib/text!templates/services/lider.tmpl",[],function(){return'<div class="description-cont">\n	<p><b>Услуга “Лидер”</b> - это размещение фотообъявления, которое отображается в специальном блоке на сайте. Этот блок располагается вверху главных страниц рубрик и разделов сайта, под бегущей строкой:</p>\n	<p>Фотообъявление содержит цену на товар/услугу и краткое описание. При клике на такое объявление, посетитель попадает в карточку Вашего объявления с подробным описанием товара/услуги.</p>\n	<p><b>Преимущества услуги “Лидер”:</b></p>\n	<ul>\n		<li>1. Ваше объявление всегда наверху</li>\n		<li>2. Отсутствие ротации - объявление будет видно посетителям в течение всего срока размещения и не будет чередоваться с объявлениями других рекламодателей</li>\n		<li>3. Правильно подобранное фото привлечет гораздо больше внимания среди посетителей и обеспечит Вам большее количество просмотров объявления</li>\n	</ul>\n	<p class="mt10">Если вы приобретаете <strong>сразу несколько лидеров</strong> для одного объявления, услуга активируется автоматически купленное количество раз каждые 7 дней (или выбранный вами период), выводя объявление вверх списка лидеров</p>\n</div>\n\n<table class="table table-bordered">\n	<thead>\n		<th class="service-title">Услуга</th>\n		<th class="quantity">Количество</th>\n		<th class="price">Цена</th>\n	</thead>\n	<tbody>\n	<tr>\n		<td class="service-title"><%=getTitle()%></td>\n		<td class="quantity">\n			<% var quantity  = 1; %>\n			<% if (is_edit) { \n				quantity = edit_params.service.quantity;\n			} %>\n			<input class="js-quantity" type="number" value="<%=quantity%>" min="1" max="99">\n		</td>\n		<td class="price">\n			<span class="js-price">\n				<%=getPrice()%>\n			</span>\n		</td>\n	</tr>\n	</tbody>\n</table>\n\n<% if (info.code > 200 && info.code < 400) { %>\n	<%=info.text%>\n<% } %>\n\n<% if (info.code >= 400) { %>\n	<p>Вы не можете воспользоваться этой услугой, потому что объявление заполнено не полностью.</p>\n	<p><%=info.text%></p>\n<% } %>\n'}),define("lib/text!templates/services/buyObject.tmpl",[],function(){return'<table class="table table-bordered">\n	<thead>\n		<th class="service-title">Товар</th>\n		<th class="price">Цена</th>\n	</thead>\n	<tbody>\n	<tr>\n		<td class="service-title"><%=info.service.title%></td>\n		<td class="price">\n			<span><%=info.service.price%> руб.</span>\n		</td>\n	</tr>\n	</tbody>\n</table>\n\n<% if (info.code > 200 && info.code < 400) { %>\n	<%=info.text%>\n<% } %>\n\n<% if (info.code >= 400) { %>\n	<p>Вы не можете воспользоваться этой услугой, потому что объявление заполнено не полностью.</p>\n	<p><%=info.text%></p>\n<% } %>\n'}),define("lib/text!templates/services/kupon.tmpl",[],function(){return'<form action="">\n<table class="table table-bordered">\n	<thead>\n		<th></th>\n		<th class="service-title">Товар</th>\n		<th class="price">Цена</th>\n	</thead>\n	<tbody>\n	<%  _.each(info.groups, function(item, key) {%>\n		<tr>\n			<td class=""><input type="radio" class="js-group" id="<%=item.service.name%><%=key%>" name="<%=item.service.name%>" <% if (key == 0) { %> checked <% } %> value="<%=item.id%>"></td>\n			<td class="service-title"><label for="<%=item.service.name%><%=key%>"><span style="display:block; cursor:pointer;"><%=item.service.title%></span></label></td>\n			<td class="price">\n				<span><%=item.service.price%> руб.</span>\n			</td>\n		</tr>\n	<% }); %>\n	</tbody>\n</table>\n</form>\n\n<% if (info.code > 200 && info.code <= 400) { %>\n	<%=info.text%>\n<% } %>\n'}),define("lib/text!templates/services/newspaper.tmpl",[],function(){return'<form class="js-form">\n	<div class="row">\n		<div class="col-md-12 p10">\n			<p class="mb10">В какую газету Вы хотите разместить объявление?</p>\n			\n				<% _.each(getNewspaperCities(), function(value, key){ %>\n					<label for="city_<%=key%>">\n						<span class="p10 pointer">\n							<input type="radio" name="city" class="m10 js-city" value="<%=value[1]%>" id="city_<%=key%>" <% if (parseInt(city_id) == key || (is_edit && edit_params.service.city == value[1]) ) { %>checked<% } %>><span class="ml5 bold"><%=value[0]%></span>\n						</span>\n					</label>\n				<% }); %>\n			\n		</div>\n	</div>\n	<div class="row">\n		<div class="col-md-12 p10">\n			<%=getTitle()%>\n		</div>\n	</div>\n	<div class="row">\n		<div class="col-md-12 p10">\n			<table class="table table-bordered">\n				<thead>\n					<th class="service-title bold">Выберите тип объявления (можно несколько)<br>\n						(<span class="span-link js-service-description">подробнее о типах объявлений</span>)\n					</th>\n					<th class="quantity bold">Количество <br>публикаций</th>\n					<th class="price bold">Стоимость</th>\n				</thead>\n				<tbody>\n				<% var types = getTypes() %>\n				<% _.each(types, function(type, type_key){ %>\n					<tr>\n						<td class="service-title">\n							<label for="type_n_<%=type_key%>">\n								<span style="display:block; cursor:pointer;">\n									<% if (is_edit) { %>\n										<input type="checkbox" name="type" value="<%=type_key%>" id="type_n_<%=type_key%>" class="js-type" <% if ( edit_params.service.contents[type_key] ){%>checked<%}%>>\n									<% } else { %>\n										<input type="checkbox" name="type" value="<%=type_key%>" id="type_n_<%=type_key%>" class="js-type">\n									<% } %>\n									\n									<span  class="ml5"><%=type%></span>\n								</span>\n							</label>\n						</td>\n						<td class="quantity">\n							<% var quantity  = 2; %>\n							<% if (type_key == "free") { quantity = 3; %>\n								3\n								<input class="js-quantity js-quantity_<%=type_key%> hidden" type="number" value="<%=quantity%>" min="1" max="99" data-type="<%=type_key%>">\n							<% } else { %>\n\n								<% if (is_edit) {\n									quantity = edit_params.service.contents[type_key] || quantity;\n								} %>\n								<input class="js-quantity js-quantity_<%=type_key%>" type="number" value="<%=quantity%>" min="1" max="99" data-type="<%=type_key%>">\n							<% } %>\n						</td>\n						<td class="price">\n							<span class="js-price js-price_<%=type_key%>">\n									<% if (info.service) { %>\n										<%=getPrice(type_key, info.service.city, quantity)%>\n									<% } else { %>\n										(?)\n									<% } %>\n							</span>\n						</td>\n					</tr>\n				<% }); %>\n				\n				</tbody>\n			</table>\n		</div>\n	</div>\n</form>'}),define("lib/text!templates/detail/baloon.tmpl",[],function(){return'<p><a href="/detail/<%=id%>"><%=title%></a></p>\n<p><img src="/<%=photo%>" alt="<%=title%>"></p>\n<% if (price) { %>\n<p><%=price%> руб</p>\n<% } %>'}),define("lib/text!templates/descriptions/newspaper.tmpl",[],function(){return'<div class="row">\n	<div class="col-md-6 p10">\n		<p>В чем отличие платных объявлений от бесплатных?</p>\n		<p>1. Платные объявления выделяются на Ваш выбор точкой, рамкой, цветом, что визуально привлекает взгляд</p>\n		<p>2. Более увеличенный размер шрифта позволяет выделиться среди однотипных объявлений</p>\n		<p>3. Возможности размещения фотоизображения еще более усиливают доверие к данному объявлению</p>\n		<p>Воспользуйтесь вышеперечисленными возможностями для повышения внимания к Вашему объявлению.</p>\n		<p>После оплаты и оформления объявления вам придет уведомление на e-mail, или оператор свяжется с вами по телефону для уточнений. Объявления оформляются с пн по пт с 9 до 18 час.</p>\n		<p>Объявления должны соответствовать правилам ресурса</p>\n	</div>\n	<div class="col-md-6 p10"><img src="/images/news_adverts_type.png" alt=""></div>\n</div>'}),define("templates",["require","lib/text!templates/searchPopup.tmpl","lib/text!templates/filters/listFilterItem.tmpl","lib/text!templates/filters/listBoxFilterItem.tmpl","lib/text!templates/filters/numericFilterItem.tmpl","lib/text!templates/filters/ilistFilterItem.tmpl","lib/text!templates/filters/textFilterItem.tmpl","lib/text!templates/filters/listPopup.tmpl","lib/text!templates/windows/service.tmpl","lib/text!templates/windows/backcall.tmpl","lib/text!templates/windows/object_callback.tmpl","lib/text!templates/windows/message.tmpl","lib/text!templates/windows/editService.tmpl","lib/text!templates/services/up.tmpl","lib/text!templates/services/premium.tmpl","lib/text!templates/services/lider.tmpl","lib/text!templates/services/buyObject.tmpl","lib/text!templates/services/kupon.tmpl","lib/text!templates/services/newspaper.tmpl","lib/text!templates/detail/baloon.tmpl","lib/text!templates/descriptions/newspaper.tmpl"],function(e){return{searchPopup:e("lib/text!templates/searchPopup.tmpl"),filters:{listFilterItem:e("lib/text!templates/filters/listFilterItem.tmpl"),listBoxFilterItem:e("lib/text!templates/filters/listBoxFilterItem.tmpl"),numericFilterItem:e("lib/text!templates/filters/numericFilterItem.tmpl"),ilistFilterItem:e("lib/text!templates/filters/ilistFilterItem.tmpl"),textFilterItem:e("lib/text!templates/filters/textFilterItem.tmpl"),listPopup:e("lib/text!templates/filters/listPopup.tmpl")},components:{windows:{service:e("lib/text!templates/windows/service.tmpl"),backcall:e("lib/text!templates/windows/backcall.tmpl"),object_callback:e("lib/text!templates/windows/object_callback.tmpl"),message:e("lib/text!templates/windows/message.tmpl"),editService:e("lib/text!templates/windows/editService.tmpl")},services:{up:e("lib/text!templates/services/up.tmpl"),premium:e("lib/text!templates/services/premium.tmpl"),lider:e("lib/text!templates/services/lider.tmpl"),buyObject:e("lib/text!templates/services/buyObject.tmpl"),kupon:e("lib/text!templates/services/kupon.tmpl"),newspaper:e("lib/text!templates/services/newspaper.tmpl")},detail:{baloon:e("lib/text!templates/detail/baloon.tmpl")},descriptions:{newspaper:e("lib/text!templates/descriptions/newspaper.tmpl")}}}}),define("views/partials/behaviors/search",["marionette","templates"],function(e,t){var n=Backbone.Collection.extend({}),r=e.ItemView.extend({events:{mouseover:"mouseOver",mouseout:"mouseOut",click:"click"},mouseOut:function(){this.$el.removeClass("mark")},mouseOver:function(){this.$el.siblings().removeClass("mark"),this.$el.addClass("mark"),this.$el.hasClass("pricerow")?this.getOption("uiSearchInput").val(this.getOption("text")):this.getOption("uiSearchInput").val(this.model.get("title"))},click:function(){this.getOption("uiSearchForm").submit()}}),i=r.extend({template:"<span class='finded-title'><%=title %></span><a href='/<%=category_url %>'><%=category_title %></a>",className:"result-line",tagName:"li"}),s=r.extend({template:"<span class='finded-title'><%=description %></span><span class='city'><%=city_name %></span><span class='city mr20' style='color:gray;'><a href='/detail/<%=object_id %>'><%=title %></a></span>",className:"result-line pricerow",tagName:"li"}),o=e.CollectionView.extend({tagName:"ul",childViewOptions:function(){var e=this;return{uiSearchInput:e.getOption("uiSearchInput"),uiSearchForm:e.getOption("uiSearchForm"),text:e.getOption("text")}}}),u=e.LayoutView.extend({template:t.searchPopup,className:"z400",regions:{objects:".js-objects",pricerows:".js-pricerows"},templateHelpers:function(){var e=this;return{objects_found:function(){return e.getOption("objects_found")},pricerows_found:function(){return e.getOption("pricerows_found")}}},onRender:function(){this.objects.show(new o({collection:this.getOption("objects"),childView:i,uiSearchInput:this.getOption("uiSearchInput"),uiSearchForm:this.getOption("uiSearchForm"),text:this.getOption("text")})),this.pricerows.show(new o({collection:this.getOption("pricerows"),childView:s,uiSearchInput:this.getOption("uiSearchInput"),uiSearchForm:this.getOption("uiSearchForm"),text:this.getOption("text")}))}});return e.Behavior.extend({ui:{searchInput:".js-search-input",searchForm:".js-search-form",searchPopupCont:".js-search-popup-cont"},events:{"keyup @ui.searchInput":"searchInputKeyUp"},searchInputKeyUp:function(e){e.preventDefault();var t=$(e.currentTarget),r=t.data("city"),i=t.val(),s=e.keyCode,o=this;s!=38&&s!=40&&(this.text=i,app.search.do(i,{city_id:r,success:function(e,t,r,s){console.log(e,t,r,s);var a=new u({objects:new n(e),pricerows:new n(t),objects_found:r,pricerows_found:s,uiSearchInput:o.ui.searchInput,uiSearchForm:o.ui.searchForm,text:i});o.ui.searchPopupCont.html(a.render().el);if(!e.length&&!t.length){o.ui.searchPopupCont.hide();return}o.ui.searchPopupCont.show()}})),i||o.ui.searchPopupCont.hide(),this.doMarkRow(s)},doMarkRow:function(e){var t=this;if(e!=38&&e!=40)return;var n=t.ui.searchPopupCont.find("li"),r=n.index($(".mark")),i=0;e==38&&(r<0?i=n.length-1:(i=r,i--),n.removeClass("mark"),n.eq(i).addClass("mark")),e==40&&(r<0?i=0:(i=r,i++),n.removeClass("mark"),n.eq(i).addClass("mark"));if(n.eq(i).hasClass("pricerow"))t.ui.searchInput.val(this.text);else{var s=n.eq(i).find(".finded-title").text();s&&t.ui.searchInput.val(s)}}})}),define("views/partials/behaviors/ads",["marionette","templates"],function(e,t){var n=Backbone.Model.extend({}),r=Backbone.Collection.extend({model:n,comparator:function(e){return e.get("weight")},init:function(e){this.limit=e.limit||11;var t=this;_.each($(".js-adslink-graphic .js-adslink-item"),function(e){t.add({$el:$(e),weight:$(e).data("weight")},{sort:!1})}),this.reorder()},reorder:function(){var e=this,t=0;this.each(function(n){var r=t;t==0?(r=e.models.length,n.set("weight",r)):n.set("weight",r),t++}),this.sort()}}),i=e.ItemView.extend({tagName:"a",className:"item js-adslink-graphic",template:"<img src='<%=src%>'><% if (title) {%> <span><%=title%></span><%}%>",events:{mouseover:"itemMouseOver",mouseout:"itemMouseOut"},initialize:function(e){this.$el.attr("style","display:none;"),this.$el.attr("target","_blank"),this.$el.attr("rel","nofollow"),this.$el.attr("href",this.model.get("link")),this.model.get("empty")&&this.$el.addClass("noactive")},itemMouseOver:function(){this.triggerMethod("item:mouseover")},itemMouseOut:function(){this.triggerMethod("item:mouseout")}}),s=e.CollectionView.extend({maxCount:10,childView:i,events:{mouseleave:"viewMouseLeave"},fadeIn:function(){var e=0,t=0,n=this;_.each(this.children._views,function(r){setTimeout(function(){t<n.maxCount&&r.$el.fadeIn(),t+=1},e),e+=50})},fadeOut:function(){var e=this,t=0,n=_.keys(this.children._views).reverse();_.each(n,function(n){var r=e.children._views[n];setTimeout(function(){r.$el.fadeOut()},t),t+=50})},childEvents:{"item:mouseover":function(e){var t=this;_.each(this.children._views,function(t){e.cid!=t.cid&&t.$el.addClass("noactive")}),e.$el.removeClass("noactive"),t.isActive=!0},"item:mouseout":function(e){var t=this;e.model.get("empty")?e.$el.addClass("noactive"):e.$el.removeClass("noactive"),t.isActive=!1}},viewMouseLeave:function(e){var t=this;this.viewMouseOutTimer&&clearTimeout(this.viewMouseOutTimer),this.viewMouseOutTimer=setTimeout(function(){_.each(t.children._views,function(e){e.model.get("empty")?e.$el.addClass("noactive"):e.$el.removeClass("noactive")})},600)}});return e.Behavior.extend({ui:{storageItems:$(".js-ads-storage img"),container:$(".js-adslink-graphic")},initialize:function(){var e=this;this.initAds(),this.adsView&&this.startAnimationAds()},initAds:function(){var e=this,t=300,n=new r;_.each(this.ui.storageItems,function(e){n.add({src:$(e).attr("src"),link:$(e).data("link"),title:$(e).data("title"),weight:0,empty:$(e).data("empty")},{sort:!1})}),n.models=_.shuffle(n.models);var i=new s({el:this.ui.container,collection:n});i.maxCount=Math.floor((this.ui.container.width()-18)/107),i.render(),i.fadeIn(),$(window).resize(function(){clearInterval(e.adsAnimationInterval),i.fadeOut(),i.$el.hide(),e.resizeTimer&&clearTimeout(e.resizeTimer),e.resizeTimer=setTimeout(function(){i.$el.show(),i.maxCount=Math.floor((e.ui.container.width()-18)/107),i.fadeIn()},550)});if(n.where({empty:!0}).length>0)return;this.adsView=i,$(this.ui.container).on("mouseover",function(){clearInterval(e.adsAnimationInterval)}),$(this.ui.container).on("mouseout",function(){e.startAnimationAds()})},startAnimationAds:function(){var e=this.adsView;this.adsAnimationInterval=setInterval(function(){e.fadeOut(),setTimeout(function(){e.collection.reorder(),e.render(),e.fadeIn()},550)},5e3)}})}),define("views/partials/index",["templates","views/partials/behaviors/search","views/partials/behaviors/ads"],function(e,t,n){return Marionette.LayoutView.extend({behaviors:{SearchBehavior:{behaviorClass:t},AdsBehavior:{behaviorClass:n}},initialize:function(){this.bindUIElements();var e=this},startPromo:function(){var e=this;return setInterval(function(){e.changeSizes(),e.iso.layout()},5e3)},changeSizes:function(e){var t=[50,60,70,80,90,100,110,120,130,140,150,160,170,180];_.each($(".js-promo-thumbnails img"),function(n){var r=t[_.random(0,12)];$(n).width(r),e&&$(n).fadeIn()})}})}),define("views/partials/behaviors/favourite",["marionette","templates"],function(e,t){return e.Behavior.extend({ui:{favourite:".js-favourite",favouriteCounter:".js-favourite-counter",favouriteCount:".js-favourite-counter > span",favouriteCaption:".js-favourite-caption"},events:{"click @ui.favourite":"favouriteClick"},favouriteClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id"),r=$(e.currentTarget),i=$(e.currentTarget).find(t.ui.favouriteCaption);$(e.currentTarget).hasClass("js-favourite-ico")||(r=r.find(".js-favourite-ico")),app.favourite.addRemove(n,{success:function(e,n){e?(r.removeClass("fa-heart-o").addClass("fa-heart"),i&&i.text("В избранном")):(r.removeClass("fa-heart").addClass("fa-heart-o"),i&&i.text("В избранное")),t.ui.favouriteCount.text(n?n.length:0)}})}})}),define("views/partials/search",["marionette","templates","views/partials/behaviors/favourite","views/partials/behaviors/search","views/partials/behaviors/ads","base/utils"],function(e,t,n,r,i,s){return e.LayoutView.extend({ui:{tr:"tr.tr",map:"#map",banners:".js-banners",liders:".js-liders"},events:{"mouseover @ui.tr":function(e){e.preventDefault(),$(e.currentTarget).addClass("hover")},"mouseleave @ui.tr":function(e){$(e.currentTarget).removeClass("hover")}},behaviors:{FavouriteBehavior:{behaviorClass:n},SearchBehavior:{behaviorClass:r},AdsBehavior:{behaviorClass:i}},initialize:function(){this.bindUIElements();if(this.ui.map.length){this.initMap();var e=_.max([this.ui.banners.height(),this.ui.liders.height()])+this.ui.map.height();this.ui.liders.length==0?this.fixBlock(this.ui.map.parent(),0,0):this.fixBlock(this.ui.map.parent(),e,0)}this.ui.banners.length&&(this.ui.liders.length==0?this.fixBlock(this.ui.banners,-this.ui.map.height()-70,this.ui.map.height()+10):this.fixBlock(this.ui.banners,this.ui.map.height(),this.ui.map.height()+10)),this.citySelect()},citySelect:function(){var e=s.getRemembedCity()},initMap:function(){var e=[];if($("#objects_for_map").length)try{e=JSON.parse($("#objects_for_map").text())}catch(n){e=[]}var r=this,i=+this.ui.map.data("lat"),s=+this.ui.map.data("lon"),o=t.components.detail.baloon;app.map.getMap({elid:"map",lat:i,lon:s,zoom:10},function(t){var n=new ymaps.GeoObjectCollection,i={};_.each(e,function(e){if(!e.coords[0])return;var t=app.map.createPlacemark([e.coords[0],e.coords[1]],{style:app.map.getIconSettings(e.type?"defRed":"defTwitter"),content:{hintContent:e.title,balloonContent:_.template(o)(e)}});i[e.id]=t,n.add(t)}),t.geoObjects.add(n),t.setBounds(n.getBounds(),{checkZoomRange:!0}),r.ui.tr.on("mouseover",function(e){e.preventDefault();var t=$(e.currentTarget).data("id");i[t].options.set(app.map.getIconSettings("defTwitterActive"))}),r.ui.tr.on("mouseleave",function(e){e.preventDefault();var t=$(e.currentTarget).data("id");i[t].options.set(app.map.getIconSettings("defTwitter"))})})},fixBlock:function(e,t,n){if(e.length==0)return;var r=e.offset().top;$(window).on("scroll",function(){r+t-$(window).scrollTop()<=0?(e.css("position")!="fixed"&&e.hide().fadeIn(),e.css("position","fixed").css("top",n+"px")):e.css("position","inherit").css("top","inherit")})}})}),define("views/partials/behaviors/ocontrol",["marionette","templates"],function(e,t){return e.Behavior.extend({ui:{publishControl:".js-ocontrol-publish",publishControlCaption:".js-ocontrol-publish > span",editControl:".js-ocontrol-edit",contactsShow:".js-contacts-show",contactList:".js-contact-list"},events:{"click @ui.publishControl":"publishControlClick","click @ui.editControl":"editControlClick","click @ui.contactsShow":"showContacts"},publishControlClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.ocontrol.publishUnpublish(n,{success:function(t){t.is_published?($(".js-object-state-"+n).removeClass("red").text("Объявление опубликовано"),$(".js-object-title-"+n).removeClass("red").removeClass("strike"),$(".js-object-services-"+n).removeClass("hidden"),$(".js-object-contacts-"+n).text("Контактные данные доступны, обновите страницу"),$(e.currentTarget).find("span").text("Снять с публикации")):($(".js-object-state-"+n).addClass("red").text("Объявление снято"),$(".js-object-title-"+n).addClass("red").addClass("strike"),$(".js-object-services-"+n).addClass("hidden"),$(".js-object-contacts-"+n).text("Объявление снято с публикации, контактные данные не доступны."),$(e.currentTarget).find("span").text("Опубликовать"),app.windows.vent.trigger("showWindow","object_callback",{id:n})),console.log(t)},error:function(e){alert(e.errors),app.ocontrol.edit(n)}})},editControlClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.ocontrol.edit(n)},showContacts:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.ocontrol.contacts(n,{code:this.ui.contactList.find("input").val(),success:function(e){t.ui.contactList.html(e)},captcha:function(e){t.ui.contactList.html(e)},error:function(e){alert(e)}})}})}),define("views/partials/behaviors/services",["marionette","templates"],function(e,t){return e.Behavior.extend({ui:{upService:".js-service-up",kuponService:".js-service-kupon",premiumService:".js-service-premium",liderService:".js-service-lider",newspaperService:".js-service-newspaper"},events:{"click @ui.upService":"upServiceClick","click @ui.kuponService":"kuponServiceClick","click @ui.premiumService":"premiumServiceClick","click @ui.liderService":"liderServiceClick","click @ui.newspaperService":"newspaperServiceClick"},upServiceClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.services.up(n,{success:function(e){console.log(e)},error:function(e){console.log(e)}})},premiumServiceClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.services.premium(n,{success:function(e){console.log(e)},error:function(e){console.log(e)}})},liderServiceClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.services.lider(n,{success:function(e){console.log(e)},error:function(e){console.log(e)}})},newspaperServiceClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id"),r=$(e.currentTarget).data("city");app.services.newspaper(n,{city_id:r,success:function(e){console.log(e)},error:function(e){console.log(e)}})},kuponServiceClick:function(e){var t=this;e.preventDefault();var n=$(e.currentTarget).data("id");app.services.kupon(n,{success:function(e){console.log(e)},error:function(e){console.log(e)}})}})}),define("views/partials/detail",["templates","views/partials/behaviors/favourite","views/partials/behaviors/search","views/partials/behaviors/ocontrol","views/partials/behaviors/services","views/partials/behaviors/ads","gisMap"],function(e,t,n,r,i,s){return Marionette.LayoutView.extend({ui:{map:"#map",backcallButton:".js-backcall-button"},events:{"click @ui.backcallButton":"backcallButtonClick"},behaviors:{FavouriteBehavior:{behaviorClass:t},SearchBehavior:{behaviorClass:n},OControlBehavior:{behaviorClass:r},ServicesBehavior:{behaviorClass:i},AdsBehavior:{behaviorClass:s}},initialize:function(){this.bindUIElements();if(this.ui.map.length){var t=[];if($("#objects_for_map").length)try{t=JSON.parse($("#objects_for_map").text())}catch(n){t=[]}var r=+this.ui.map.data("lat"),i=+this.ui.map.data("lon"),s=e.components.detail.baloon;app.map.get2GisMap({elid:"map",lat:r,lon:i,zoom:15},function(e){DG.marker([r,i]).addTo(e).bindPopup("Расположение объекта")})}},backcallButtonClick:function(e){e.preventDefault();var t=$(e.currentTarget).data("id");app.windows.vent.trigger("showWindow","backcall",{object_id:t,key:"kupon"})}})}),define("views/partials/behaviors/groupcontrol",["marionette","templates"],function(e,t){return e.Behavior.extend({ui:{selectObject:".js-select-object",selectObjectChecked:".js-select-object:checked",hideRegion:".js-hide-region",groupOperations:"#group_operations",publish:".js-groupcontrol-publish",unpublish:".js-groupcontrol-unpublish",unpublishall:".js-groupcontrol-unpublish-all",up:".js-service-group-up",premium:".js-service-group-premium",lider:".js-service-group-lider",newspaper:".js-service-group-newspaper"},events:{"change @ui.selectObject":"selectObject","click @ui.publish":"publishObjects","click @ui.unpublish":"unpublishObjects","click @ui.unpublishall":"unpublishAllObjects","click @ui.up":"upObjects","click @ui.premium":"premiumObjects","click @ui.lider":"liderObjects","click @ui.newspaper":"newspaperObjects"},selectObject:function(e){var t=$(e.currentTarget).prop("checked"),n=$(e.currentTarget).data("id"),r=$(".js-select-object:checked").length;t?$(".js-hide-region-"+n).hide():$(".js-hide-region-"+n).show(),r>0?(this.ui.groupOperations.show(),this.ui.hideRegion.hide()):(this.ui.groupOperations.hide(),this.ui.hideRegion.show())},publishObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.windows.vent.trigger("showWindow","message",{title:"<i class='fa fa-spinner fa-spin fa-lg mr3'></i> Публикация объявлений",text:"Ожидайте окончания операции.",disableOk:!0}),this.publishUnpublish(t,!0)},unpublishObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.windows.vent.trigger("showWindow","message",{title:"<i class='fa fa-spinner fa-spin fa-lg mr3'></i> Снятие объявлений с публикации",text:"Ожидайте окончания операции..",disableOk:!0}),this.publishUnpublish(t,!1),app.windows.vent.trigger("showWindow","object_callback",{ids:t})},publishAllObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.windows.vent.trigger("showWindow","message",{title:"<i class='fa fa-spinner fa-spin fa-lg mr3'></i> Публикация объявлений",text:"Ожидайте окончания операции..",disableOk:!0}),this.publishUnpublish(t,!0,!0)},unpublishAllObjects:function(e){e.preventDefault();if(!confirm("Вы уверены что хотите снять с публикации все объявления?"))return;var t=this.get_objects_ids(!0);app.windows.vent.trigger("showWindow","message",{title:"<i class='fa fa-spinner fa-spin fa-lg mr3'></i> Снятие объявлений с публикации",text:"Ожидайте окончания операции..",disableOk:!0}),this.publishUnpublish(t,!1,!0)},upObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.services.up(null,{ids:t,success:function(e){console.log(e)},error:function(e){console.log(e)}})},premiumObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.services.premium(null,{ids:t,success:function(e){console.log(e)},error:function(e){console.log(e)}})},liderObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.services.lider(null,{ids:t,success:function(e){console.log(e)},error:function(e){console.log(e)}})},newspaperObjects:function(e){e.preventDefault();var t=this.get_objects_ids(!0);app.services.newspaper(null,{ids:t,success:function(e){console.log(e)},error:function(e){console.log(e)}})},get_objects_ids:function(e){var t=[],n=e?$(".js-select-object:checked"):$(".js-select-object");return _.each(n,function(e){t.push($(e).data("id"))}),t},publishUnpublish:function(e,t,n){var r=this,i=0;return app.ocontrol.publishUnpublishGroup(e,t,n,{success:function(e){e.affected&&_.each(e.affected,function(e){t?($(".js-object-state-"+e).removeClass("red").text("Объявление опубликовано"),$(".js-object-title-"+e).removeClass("red").removeClass("strike"),$(".js-object-services-"+e).removeClass("hidden"),$(".js-object-contacts-"+e).text("Контактные данные доступны, обновите страницу")):($(".js-object-state-"+e).addClass("red").text("Объявление снято"),$(".js-object-title-"+e).addClass("red").addClass("strike"),$(".js-object-services-"+e).addClass("hidden"),$(".js-object-contacts-"+e).text("Объявление снято с публикации, контактные данные не доступны."))}),t&&e.code==400&&alert("Несколько объявлений, не удалось опубликовать. Скорее всего не все поля заполнены"),app.windows.vent.trigger("closeWindow","message")},error:function(e){i++,alert("Несколько объявлений, не удалось опубликовать. Скорее всего не все поля заполнены"),app.windows.vent.trigger("closeWindow","message")}}),i}})}),define("views/partials/userSearch",["marionette","templates","views/partials/behaviors/favourite","views/partials/behaviors/search","views/partials/behaviors/ocontrol","views/partials/behaviors/services","views/partials/behaviors/groupcontrol"],function(e,t,n,r,i,s,o){return e.LayoutView.extend({ui:{tr:"tr.tr"},events:{"mouseover @ui.tr":function(e){e.preventDefault(),$(e.currentTarget).addClass("hover")},"mouseout @ui.tr":function(e){$(e.currentTarget).removeClass("hover")}},behaviors:{FavouriteBehavior:{behaviorClass:n},SearchBehavior:{behaviorClass:r},OControlBehavior:{behaviorClass:i},ServicesBehavior:{behaviorClass:s},GroupControlBehavior:{behaviorClass:o}},initialize:function(){this.bindUIElements()}})}),function(e){function t(){var e=document.createElement("input"),t="onpaste";return e.setAttribute(t,""),typeof e[t]=="function"?"paste":"input"}var n=t()+".mask",r=navigator.userAgent,i=/iphone/i.test(r),s=/android/i.test(r),o;e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(this.length===0||this.is(":hidden"))return;return typeof e=="number"?(t=typeof t=="number"?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,r){var u,a,f,l,c,h;return!t&&this.length>0?(u=e(this[0]),u.data(e.mask.dataName)()):(r=e.extend({placeholder:e.mask.placeholder,completed:null},r),a=e.mask.definitions,f=[],l=h=t.length,c=null,e.each(t.split(""),function(e,t){t=="?"?(h--,l=e):a[t]?(f.push(new RegExp(a[t])),c===null&&(c=f.length-1)):f.push(null)}),this.trigger("unmask").each(function(){function v(e){while(++e<h&&!f[e]);return e}function m(e){while(--e>=0&&!f[e]);return e}function g(e,t){var n,i;if(e<0)return;for(n=e,i=v(t);n<h;n++)if(f[n]){if(!(i<h&&f[n].test(p[i])))break;p[n]=p[i],p[i]=r.placeholder,i=v(i)}S(),u.caret(Math.max(c,e))}function y(e){var t,n,i,s;for(t=e,n=r.placeholder;t<h;t++)if(f[t]){i=v(t),s=p[t],p[t]=n;if(!(i<h&&f[i].test(s)))break;n=s}}function b(e){var t=e.which,n,r,s;t===8||t===46||i&&t===127?(n=u.caret(),r=n.begin,s=n.end,s-r===0&&(r=t!==46?m(r):s=v(r-1),s=t===46?v(s):s),E(r,s),g(r,s-1),e.preventDefault()):t==27&&(u.val(d),u.caret(0,x()),e.preventDefault())}function w(t){var n=t.which,i=u.caret(),o,a,l;if(t.ctrlKey||t.altKey||t.metaKey||n<32)return;n&&(i.end-i.begin!==0&&(E(i.begin,i.end),g(i.begin,i.end-1)),o=v(i.begin-1),o<h&&(a=String.fromCharCode(n),f[o].test(a)&&(y(o),p[o]=a,S(),l=v(o),s?setTimeout(e.proxy(e.fn.caret,u,l),0):u.caret(l),r.completed&&l>=h&&r.completed.call(u))),t.preventDefault())}function E(e,t){var n;for(n=e;n<t&&n<h;n++)f[n]&&(p[n]=r.placeholder)}function S(){u.val(p.join(""))}function x(e){var t=u.val(),n=-1,i,s;for(i=0,pos=0;i<h;i++)if(f[i]){p[i]=r.placeholder;while(pos++<t.length){s=t.charAt(pos-1);if(f[i].test(s)){p[i]=s,n=i;break}}if(pos>t.length)break}else p[i]===t.charAt(pos)&&i!==l&&(pos++,n=i);return e?S():n+1<l?(u.val(""),E(0,h)):(S(),u.val(u.val().substring(0,n+1))),l?i:c}var u=e(this),p=e.map(t.split(""),function(e,t){if(e!="?")return a[e]?r.placeholder:e}),d=u.val();u.data(e.mask.dataName,function(){return e.map(p,function(e,t){return f[t]&&e!=r.placeholder?e:null}).join("")}),u.attr("readonly")||u.one("unmask",function(){u.unbind(".mask").removeData(e.mask.dataName)}).bind("focus.mask",function(){clearTimeout(o);var e,n;d=u.val(),e=x(),o=setTimeout(function(){S(),e==t.length?u.caret(0,e):u.caret(e)},10)}).bind("blur.mask",function(){x(),u.val()!=d&&u.change()}).bind("keydown.mask",b).bind("keypress.mask",w).bind(n,function(){setTimeout(function(){var e=x(!0);u.caret(e),r.completed&&e==u.val().length&&r.completed.call(u)},0)}),x()}))}})}(jQuery),define("maskedInput",function(){}),define("views/partials/cart",["marionette","templates","maskedInput"],function(e,t){var n=Backbone.Model.extend({urlRoot:"/rest_service/check_kupon_number"}),r=Backbone.Model.extend({urlRoot:"/rest_service/get_temp_item",sum:function(){return this.get("total")}}),i=Backbone.Collection.extend({model:r}),s=Backbone.Model.extend({urlRoot:"/cart/saveorder"}),o=e.ItemView.extend({ui:{edit:".js-edit",sum:".js-itemsum","delete":".js-delete"},events:{"click @ui.edit":"edit","click @ui.delete":"deleteItem",click:"click"},initialize:function(){this.bindUIElements()},click:function(e){},edit:function(e){var t=this.model.get("name"),n=this.model.get("id"),r=this.model.get("object_id");this.model.fetch({data:{id:n},success:function(e){var i=e.get("result");app.services[t](r,{is_edit:n,edit_params:i.params,success:function(e){location.reload(),console.log(e)},error:function(e){console.log(e)}})}})},deleteItem:function(e){var t=this;e.preventDefault(),this.model.destroy({url:"/cart/remove_item/"+this.model.id,success:function(){t.destroy()},wait:!0})}});return e.ItemView.extend({el:"body",ui:{form:"#cart-form",checkNumberform:"#check-number-form",checkNumber:".js-check-number",checkNumberSubmit:".js-check-number-submit",messages:".js-messages",endSum:".js-endsum",comment:".js-comment",save:".js-save",error:".js-error",deliveryType:".js-delivery-type"},events:{"click @ui.save":"saveOrder","change @ui.deliveryType":"changeDeliveryType","click @ui.checkNumberSubmit":"checkNumberSubmit"},initialize:function(){this.bindUIElements();var e=this,t=new i;t.on("change:quantity",function(t){e.recalcsum()}),t.on("remove",function(t){this.models.length==0&&(document.location="cart"),e.recalcsum()}),t.on("add",function(e){new o({model:e,el:e.get("$item")})}),_.each($(".js-cartitem"),function(e){t.add({id:$(e).data("id"),object_id:$(e).data("object-id"),name:$(e).data("name"),total:$(e).data("total"),$item:e})}),this.cartList=t,this.cartOrder=new s,this.recalcsum(),$(".js-mobile-phone").length&&$(".js-mobile-phone").mask("+7(999)999-99-99",{completed:function(){}})},recalcsum:function(){var e=0;this.cartList.each(function(t){e+=t.sum()}),this.ui.endSum.text(e+" руб."),this.sum=e},saveOrder:function(e){var t=this,n={};e.preventDefault(),this.recalcsum(),this.ui.form.serializeArray().map(function(e){n[e.name]=e.value}),t.showError("");var r=t.ui.save.data("next-page"),i=this.cartList.toJSON(),s=_.pluck(i,"id");this.cartOrder.set({sum:this.sum}),this.cartOrder.save(n,{success:function(e,n,i){n.code==200?document.location=r+n.order_id:n.code==300?document.location="/cart/order/"+n.order_id:t.showError(n.message)},error:function(e){t.showError("Ошибка при сохранении заказа")}})},showError:function(e){e?this.ui.error.html(e):this.ui.error.html("")},changeDeliveryType:function(e){e.preventDefault();var t=$(e.currentTarget).val();console.log(t),$(".js-delivery-cont").hide(),$(".js-"+t+"-cont").show()},checkNumberSubmit:function(e){e.preventDefault();var t=this,r=new n;r.save({number:this.ui.checkNumber.val(),captcha:$("#captcha_number").val()},{success:function(e){var e=e.toJSON();e.code=="200"?t.ui.messages.html("<p class='ta-c green'>Купон действителен</p>"):e.code=="300"?t.ui.messages.html(e.result):t.ui.messages.html("<p class='ta-c red'>Купон недействителен</p>")}})}})}),define("lib/text!templates/add/contact.tmpl",[],function(){return'<div class="cont-left">\n	<select class="sl-contact-type fn-contact-type" name="contact_<%=id%>_type">\n		<option value="1" data-comment="Введите номер" data-validation-type="phone" data-format="+7(999)999-99-99" <% if (type == "1") {%> selected <%}%> >Мобильный тел.</option>\n		<option value="2" data-comment="Введите номер" data-validation-type="phone" data-format="+7(9999)99-99-99" <% if (type == "2") {%> selected <%}%> >Городской тел.</option>\n		<option value="5" data-comment="Введите ваш почтовый ящик" data-validation-type="email" data-format="" <% if (type == "5") {%> selected <%}%> >Email</option>\n	</select>\n	<input class=\'inp_contact fn-contact-value\' type="text" name="contact_<%=id%>_value" value="<%=value%>">\n	<span class="inform"><span class="fn-contact-inform">\n		<% if (status == "verified") { %>\n			Контакт подтвержден\n		<% } else if (status == "noverified"){ %>\n			Контакт не подтвержден\n		<% } %>\n	</span></span>\n</div>\n<div class="cont-right">\n	<span title="Верифицировать" class="button button-style1 bg-color-blue apply fn-contact-verify-button">Подтвердить контакт</span>\n	<span class="cansel span-link fn-contact-delete-button" title="Удалить">Удалить</span>\n</div><!--contact-right-->			'}),define("lib/text!templates/add/custom-address.tmpl",[],function(){return'<div class="row mb10" id="div_<%=id%>">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label><%=title%><%=(unit)?", "+unit+":":":"%></label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont ">\n			<% if (is_required) { %>\n				<span class="required-star">*</span>\n			<% } %>\n\n			<input class="w100p" id="<%=id%>" type="text" name="<%=id%>" value="<%=value%>"/>\n\n			<span class="inform">\n				<span>Например: ул. Мельникайте, д. 44, корп. 2</span>\n			</span>					\n		</div>\n	</div>\n</div>'}),define("lib/text!templates/add/custom-multiselect.tmpl",[],function(){return'<div class="row mb10" id="div_<%=id%>">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label><%=title%><%=(unit)?", "+unit+":":":"%></label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont ">\n			<% if (is_required) { %>\n				<span class="required-star">*</span>\n			<% } %>\n			<select id="<%=id%>" name="<%=id%>[]" class="<%=classes%> w100p" multiple style="height:<%=(_.values(data).length*15)%>px;">\n				<% if (!is_required) { %>\n					<option value="">--нет--</option>\n				<% } %>\n				<% _.each(data, function(item, key){ %>\n					<% if (key == 0) return; %>\n					<%  if (typeof item == "object") item = item[0].title %>\n\n\n					<option value="<%=key%>"><%=item%></option>\n				<% }); %>\n			</select> \n\n			<span class="inform">\n				<span>Используйте Ctrl чтобы выбрать несколько значений</span>\n			</span>				\n		</div>\n	</div>\n</div>'}),define("lib/text!templates/add/description.tmpl",[],function(){return'<div class="col-md-3 col-xs-4 labelcont">\n	<label>!</label>\n</div>\n<div class="col-md-9 col-xs-8">\n	<div class="inp-cont user-text mb15">\n		<%=text%>					\n	</div>\n</div>\n'}),define("lib/text!templates/add/integer.tmpl",[],function(){return'<div class="row mb10" id="div_<%=id%>">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label><%=title%><%=(unit)?", "+unit+":":":"%></label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont " data-condition="">\n			<% if (is_required) { %>\n				<span class="required-star">*</span>\n			<% } %>\n			<input  id="<%=id%>" name="<%=id%>" class="<%=classes%> w100p" type="text" value="<%=value%>"/>					\n		</div>\n	</div>\n</div>'}),define("lib/text!templates/add/list.tmpl",[],function(){return'<div class="col-md-6" id="div_<%=id%>">\n	<div class="inp-cont">\n		<% if (is_required) { %>\n			<span class="required-star">*</span>\n		<% } %>\n			<select id="<%=id%>" name="<%=id%>" class="w100p <%=classes%>">\n				<option value="">--<%=title%><%=(unit)?", "+unit:""%>--</option>\n				<% _.each(data, function(item, key){ %>\n					<% if (key == 0) return; %>\n					<%  if (typeof item == "object") item = item[0].title %>\n\n\n					<option value="<%=key%>"><%=item%></option>\n				<% }); %>\n			</select> \n	</div>\n</div>'}),define("lib/text!templates/add/numeric.tmpl",[],function(){return'<div class="row mb10" id="div_<%=id%>">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label><%=title%><%=(unit)?", "+unit+":":":"%></label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="row">\n			<div class="col-md-6">\n				<div class="inp-cont" data-condition="">\n					<% if (is_required) { %>\n						<span class="required-star">*</span>\n					<% } %>\n					<input  id="<%=id%>" name="<%=id%>" class="<%=classes%> w100p" type="text" value="<%=value%>"/>					\n				</div>\n			</div>\n		</div>				\n	</div>\n</div>'}),define("lib/text!templates/add/parameters.tmpl",[],function(){return'<div class="fn-parameters">\n	<div class="row mb10">\n		<div class="col-md-3 col-xs-4 labelcont">\n			<label>Параметры:</label>\n		</div>\n		<div class="col-md-9 col-xs-8">\n			<div class="row bg-color-whitesmoke pt15 mb20">					\n				<div class="fn-list-parameters"></div>					\n			</div>				\n		</div>\n	</div>\n	<div class="fn-rows-parameters"></div>\n</div>'}),define("lib/text!templates/add/photo.tmpl",[],function(){return'<div class="img <%=((active)?\'active\':\'\')%>"><img src="<%=filepath%>"/></div> \n		<div class="href-bl"><span href="" class="remove span-link fn-remove">Удалить</span></div>\n		<input type="hidden" name="userfile[]" value="<%=filename%>"/>'}),define("lib/text!templates/add/subject.tmpl",[],function(){return'<div class="row mb10" id="div_subject">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label>Заголовок:</label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont <% if (error) {%> error <%}%>">\n			<span class="required-star">*</span>																		\n			<input class="w100p" type="text" maxlength="<%=maxlength%>"  id="title_adv" name="title_adv" value="<%=value%>"/>	\n\n			<% if (error) { %>\n			<span class="inform">\n				<span></span>\n			</span>\n			<% } %>				\n		</div>\n	</div>\n</div>	  '}),define("lib/text!templates/add/text.tmpl",[],function(){return'<div class="row mb10" id="div_<%=id%>">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label><%=title%><%=(unit)?", "+unit+":":":"%></label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont " data-condition="">\n			<% if (is_required) { %>\n				<span class="required-star">*</span>\n			<% } %>\n			<input class="w100p" id="<%=id%>" type="text" name="<%=id%>" value="<%=value%>"/>					\n		</div>\n	</div>\n</div>'}),define("lib/text!templates/add/textadv.tmpl",[],function(){return'<div class="row mb10" id="div_text">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label>Текст объявления:</label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont user-text">\n			<% if (text_required) { %>\n				<span class="required-star">*</span>\n			<% } %>\n			<div class="textarea user_text_adv_wrp">\n			<textarea name="user_text_adv" id="user_text_adv" class="user_text_adv w100p"><%=value%></textarea>					\n		</div>\n	</div>\n</div>'}),define("lib/text!templates/add/textarea.tmpl",[],function(){return'<div class="row mb10" id="div_<%=id%>">\n	<div class="col-md-3 col-xs-4 labelcont">\n		<label><%=title%></label>\n	</div>\n	<div class="col-md-9 col-xs-8">\n		<div class="inp-cont " data-condition="">\n				<% if (is_required) { %>\n					<span class="required-star">*</span>\n				<% } %>\n				<textarea id="<%=id%>" name="<%=id%>" class="<%=classes%> w100p"><%=value%></textarea>					\n		</div>\n	</div>\n</div>'}),define("lib/text!templates/add/verify-contact-window.tmpl",[],function(){return'<div class="popup-cont confirm-contact-win">\n	<span class="close fn-verify-contact-win-close"></span>\n	<p class="title pb10">Проверка контакта <%=value%></p>										\n	<input class="inp-confirm-code fn-input-code" type="text" placeholder="Введите код" />\n	<p class="msg pt5 pb25 fn-error-block" style="font-size:14px;"></p>\n	<? /*<div class=\'fn-btn-re-send\'><span style="font-size:12px;">Отправить еще раз</span></div> */?>\n	<div class="ta-r"><div class="button blue  fn-verify-contact-win-submit">Готово</div></div>\n</div>'}),define("templates/set/add",["require","lib/text!templates/add/contact.tmpl","lib/text!templates/add/custom-address.tmpl","lib/text!templates/add/custom-multiselect.tmpl","lib/text!templates/add/description.tmpl","lib/text!templates/add/integer.tmpl","lib/text!templates/add/list.tmpl","lib/text!templates/add/numeric.tmpl","lib/text!templates/add/parameters.tmpl","lib/text!templates/add/photo.tmpl","lib/text!templates/add/subject.tmpl","lib/text!templates/add/text.tmpl","lib/text!templates/add/textadv.tmpl","lib/text!templates/add/textarea.tmpl","lib/text!templates/add/verify-contact-window.tmpl"],function(e){return{contact:e("lib/text!templates/add/contact.tmpl"),customaddress:e("lib/text!templates/add/custom-address.tmpl"),custommultiselect:e("lib/text!templates/add/custom-multiselect.tmpl"),description:e("lib/text!templates/add/description.tmpl"),integer:e("lib/text!templates/add/integer.tmpl"),list:e("lib/text!templates/add/list.tmpl"),numeric:e("lib/text!templates/add/numeric.tmpl"),parameters:e("lib/text!templates/add/parameters.tmpl"),photo:e("lib/text!templates/add/photo.tmpl"),subject:e("lib/text!templates/add/subject.tmpl"),text:e("lib/text!templates/add/text.tmpl"),textadv:e("lib/text!templates/add/textadv.tmpl"),textarea:e("lib/text!templates/add/textarea.tmpl"),verifyContactWindow:e("lib/text!templates/add/verify-contact-window.tmpl")}}),define("views/partials/behaviors/contacts",["marionette","templates","maskedInput"],function(e,t){var n={mobile:"+7(999)999-99-99",phone:"+7(9999)99-99-99"},r={ok:"<i class='fa fa-check'></i>",load:"<i class='fa fa-spinner fa-spin'></i>",fail:"<i class='fa fa-question' title='Возможно контакт введен не полностью или с ошибкой'></i>",ready:"Нажмите чтобы подтвердить",empty:"<i class='fa fa-question'></i>",error:"<i class='fa fa-remove'></i>",codeLoad:"<i class='fa fa-spinner fa-spin mr3'></i>Код отправлен"},i={green:"bg-color-lightgreen",red:"bg-color-crimson",gray:"bg-color-gray"},s=Backbone.Model.extend({urlRoot:"/rest_user/check_contact"}),o=Backbone.Model.extend({urlRoot:"/rest_user/check_code",checkCode:function(e){this.save({},{success:function(t){var n=t.toJSON();n.code==200?e.success(n):e.error(n)}})}}),u=Backbone.Model.extend({urlRoot:"/rest_user/sent_code",sendCode:function(e){this.save({},{success:function(t){var n=t.toJSON();n.code==200?e.success(n):n.code>=300&&n.code<400?e.alreadyVerified(n):e.error(n)}})}}),a=e.ItemView.extend({ui:{inputValue:".js-contact-value",buttonOk:".js-contact-ok",contactCodeCont:".js-contact-code",contactDescription:".js-contact-description",inputCode:".js-contact-code-value",buttonCodeOk:".js-contact-code-ok",codeDescription:".js-contact-code-description"},events:{"keyup @ui.inputValue":"keyUpContact","change @ui.inputValue":"keyUpContact","click @ui.buttonOk":"submitContact","click @ui.buttonCodeOk":"submitCode"},modelEvents:{"change:value":"changeContact","change:state":"changeState"},initialize:function(){var e=this;this.bindUIElements(),this.model.set("value",this.ui.inputValue.val()),n[this.model.get("type")]&&this.ui.inputValue.mask(n[this.model.get("type")],{completed:function(){e.model.set("ready",e.ui.inputValue.val())}})},changeContact:function(e){var t=this;this.model.set("state","load"),this.keyupTimeout&&clearTimeout(this.keyupTimeout),this.keyupTimeout=setTimeout(function(){t.checkContact()},600)},keyUpContact:function(e){e.preventDefault(),this.showHideCodeInput(!1),this.ui.inputValue.val()!=this.model.get("ready")&&this.model.set("ready",!1),this.model.get("type")=="email"&&this.model.set("ready",!0),this.model.set("value",this.ui.inputValue.val())},checkContact:function(){var e=this;this.model.save({},{success:function(t){var n=t.toJSON();e.showHideMessage(!1),n.code==200?e.model.set("state","ok"):n.code==300?e.model.get("ready")?e.model.set("state","ready"):e.model.set("state","fail"):(e.model.set("state","error"),e.showHideMessage(n.text))}})},changeState:function(){var e=this.model.get("state");e=="load"||e=="fail"||e=="empty"||e=="codeLoad"?this.ui.buttonOk.removeClass(i.red).removeClass(i.green).addClass(i.gray):e=="ok"?this.ui.buttonOk.removeClass(i.red).addClass(i.green).removeClass(i.gray):(e=="ready"||e=="error")&&this.ui.buttonOk.addClass(i.red).removeClass(i.green).removeClass(i.gray),this.model.get("description_"+this.model.get("state"))?this.ui.buttonOk.html(r[e]+this.model.get("description_"+this.model.get("state"))):this.ui.buttonOk.html(r[e])},showHideCodeInput:function(e){this.ui.contactDescription.addClass("hidden"),e?this.ui.contactCodeCont.removeClass("hidden"):(this.ui.inputCode.val(""),this.ui.contactCodeCont.addClass("hidden"))},showHideMessage:function(e){this.ui.contactCodeCont.addClass("hidden"),e?(this.ui.contactDescription.text(e),this.ui.contactDescription.removeClass("hidden")):(this.ui.contactDescription.text(""),this.ui.contactDescription.addClass("hidden"))},showHideCodeDescription:function(e){e?(this.ui.codeDescription.text(e),this.ui.codeDescription.removeClass("hidden")):(this.ui.codeDescription.text(""),this.ui.codeDescription.addClass("hidden"))},submitContact:function(e){e.preventDefault();var t=this,n=$(e.currentTarget).data("state");$(e.currentTarget).attr("data-state",!1),n&&this.model.set("state",n);if(this.model.get("state")=="error"){t.showHideMessage(!1),this.ui.inputValue.val(""),this.model.set("state","empty");return}if(this.model.get("state")!="ready")return;t.sendTimeout&&clearInterval(t.sendTimeout),this.ui.inputValue.prop("disabled",!0);var r=new u({type:this.model.get("type"),value:this.model.get("value")});this.model.set("state","codeLoad"),r.sendCode({success:function(e){t.showHideCodeInput(!0),t.showHideCodeDescription(!1);var n=90;t.sendTimeout=setInterval(function(){n<=0?(t.model.set("description_codeLoad",null),clearInterval(t.sendTimeout),t.ui.inputValue.prop("disabled",!1),t.model.set("state","ready")):t.model.set("description_codeLoad",". Повтор через ("+n+")"),t.changeState(),n-=1},1e3)},alreadyVerified:function(e){t.model.set("state","ok"),t.showHideMessage(!1),t.ui.inputValue.prop("disabled",!1),e.text&&t.showHideMessage(e.text)},error:function(e){t.showHideMessage(e.text),t.ui.inputValue.prop("disabled",!1),t.model.set("state","error")}})},submitCode:function(e){e.preventDefault();var t=this;if(this.model.get("state")!="codeLoad")return;var n=new o({type:this.model.get("type"),value:this.model.get("value"),code:this.ui.inputCode.val()});n.checkCode({success:function(e){console.log(e),t.showHideCodeInput(!1),t.showHideCodeDescription(!1),t.model.set("state","ok"),t.ui.inputValue.prop("disabled",!1)},error:function(e){t.showHideCodeDescription(e.text)}})}});return e.Behavior.extend({ui:{contacts:$(".js-contact")},events:{},initialize:function(){_.each(this.ui.contacts,function(e){var t=$(e).data("type");new a({el:e,model:new s({type:t})})})}})}),function(e){typeof define=="function"&&define.amd?define("iframeTransport",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(window.jQuery)}(function(e){var t=0;e.ajaxTransport("iframe",function(n){if(n.async){var r=n.initialIframeSrc||"javascript:false;",i,s,o;return{send:function(u,a){i=e('<form style="display:none;"></form>'),i.attr("accept-charset",n.formAcceptCharset),o=/\?/.test(n.url)?"&":"?",n.type==="DELETE"?(n.url=n.url+o+"_method=DELETE",n.type="POST"):n.type==="PUT"?(n.url=n.url+o+"_method=PUT",n.type="POST"):n.type==="PATCH"&&(n.url=n.url+o+"_method=PATCH",n.type="POST"),t+=1,s=e('<iframe src="'+r+'" name="iframe-transport-'+t+'"></iframe>').bind("load",function(){var t,o=e.isArray(n.paramName)?n.paramName:[n.paramName];s.unbind("load").bind("load",function(){var t;try{t=s.contents();if(!t.length||!t[0].firstChild)throw new Error}catch(n){t=undefined}a(200,"success",{iframe:t}),e('<iframe src="'+r+'"></iframe>').appendTo(i),window.setTimeout(function(){i.remove()},0)}),i.prop("target",s.prop("name")).prop("action",n.url).prop("method",n.type),n.formData&&e.each(n.formData,function(t,n){e('<input type="hidden"/>').prop("name",n.name).val(n.value).appendTo(i)}),n.fileInput&&n.fileInput.length&&n.type==="POST"&&(t=n.fileInput.clone(),n.fileInput.after(function(e){return t[e]}),n.paramName&&n.fileInput.each(function(t){e(this).prop("name",o[t]||n.paramName)}),i.append(n.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),n.fileInput.removeAttr("form")),i.submit(),t&&t.length&&n.fileInput.each(function(n,r){var i=e(t[n]);e(r).prop("name",i.prop("name")).attr("form",i.attr("form")),i.replaceWith(r)})}),i.append(s).appendTo(document.body)},abort:function(){s&&s.unbind("load").prop("src",r),i&&i.remove()}}}}),e.ajaxSetup({converters:{"iframe text":function(t){return t&&e(t[0].body).text()},"iframe json":function(t){return t&&e.parseJSON(e(t[0].body).text())},"iframe html":function(t){return t&&e(t[0].body).html()},"iframe xml":function(t){var n=t&&t[0];return n&&e.isXMLDoc(n)?n:e.parseXML(n.XMLDocument&&n.XMLDocument.xml||e(n.body).html())},"iframe script":function(t){return t&&e.globalEval(e(t[0].body).text())}}})}),function(e){typeof define=="function"&&define.amd?define("jquery.ui.widget",["jquery"],e):typeof exports=="object"?e(require("jquery")):e(jQuery)}(function(e){var t=0,n=Array.prototype.slice;e.cleanData=function(t){return function(n){var r,i,s;for(s=0;(i=n[s])!=null;s++)try{r=e._data(i,"events"),r&&r.remove&&e(i).triggerHandler("remove")}catch(o){}t(n)}}(e.cleanData),e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];return t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix||t:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){var r=n.call(arguments,1),i=0,s=r.length,o,u;for(;i<s;i++)for(o in r[i])u=r[i][o],r[i].hasOwnProperty(o)&&u!==undefined&&(e.isPlainObject(u)?t[o]=e.isPlainObject(t[o])?e.widget.extend({},t[o],u):e.widget.extend({},u):t[o]=u);return t},e.widget.bridge=function(t,r){var i=r.prototype.widgetFullName||t;e.fn[t]=function(s){var o=typeof s=="string",u=n.call(arguments,1),a=this;return s=!o&&u.length?e.widget.extend.apply(null,[s].concat(u)):s,o?this.each(function(){var n,r=e.data(this,i);if(s==="instance")return a=r,!1;if(!r)return e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+s+"'");if(!e.isFunction(r[s])||s.charAt(0)==="_")return e.error("no such method '"+s+"' for "+t+" widget instance");n=r[s].apply(r,u);if(n!==r&&n!==undefined)return a=n&&n.jquery?a.pushStack(n.get()):n,!1}):this.each(function(){var t=e.data(this,i);t?(t.option(s||{}),t._init&&t._init()):e.data(this,i,new r(s,this))}),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(n,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var r=t,i,s,o;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof t=="string"){r={},i=t.split("."),t=i.shift();if(i.length){s=r[t]=e.widget.extend({},this.options[t]);for(o=0;o<i.length-1;o++)s[i[o]]=s[i[o]]||{},s=s[i[o]];t=i.pop();if(arguments.length===1)return s[t]===undefined?null:s[t];s[t]=n}else{if(arguments.length===1)return this.options[t]===undefined?null:this.options[t];r[t]=n}}return this._setOptions(r),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^([\w:-]*)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}});var r=e.widget}),function(e){typeof define=="function"&&define.amd?define("fileupload",["jquery","jquery.ui.widget"],e):typeof exports=="object"?e(require("jquery"),require("./vendor/jquery.ui.widget")):e(window.jQuery)}(function(e){function t(t){var n=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var i=r.dataTransfer;i&&e.inArray("Files",i.types)!==-1&&this._trigger(t,e.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),n&&(i.dropEffect="copy"))}}e.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))")).test(window.navigator.userAgent)&&!e('<input type="file">').prop("disabled"),e.support.xhrFileUpload=!!window.ProgressEvent&&!!window.FileReader,e.support.xhrFormDataFileUpload=!!window.FormData,e.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),e.widget("blueimp.fileupload",{options:{dropZone:e(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,n){return t=this.messages[t]||t.toString(),n&&e.each(n,function(e,n){t=t.replace("{"+e+"}",n)}),t},formData:function(e){return e.serializeArray()},add:function(t,n){if(t.isDefaultPrevented())return!1;(n.autoUpload||n.autoUpload!==!1&&e(this).fileupload("option","autoUpload"))&&n.process().done(function(){n.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:e.support.blobSlice&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(e,t,n){var r=e-this.timestamp;if(!this.bitrate||!n||r>n)this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=e;return this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&e.support.xhrFileUpload||e.support.xhrFormDataFileUpload)},_getFormData:function(t){var n;return e.type(t.formData)==="function"?t.formData(t.form):e.isArray(t.formData)?t.formData:e.type(t.formData)==="object"?(n=[],e.each(t.formData,function(e,t){n.push({name:e,value:t})}),n):[]},_getTotal:function(t){var n=0;return e.each(t,function(e,t){n+=t.size||1}),n},_initProgressObject:function(t){var n={loaded:0,total:0,bitrate:0};t._progress?e.extend(t._progress,n):t._progress=n},_initResponseObject:function(e){var t;if(e._response)for(t in e._response)e._response.hasOwnProperty(t)&&delete e._response[t];else e._response={}},_onProgress:function(t,n){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),i;if(n._time&&n.progressInterval&&r-n._time<n.progressInterval&&t.loaded!==t.total)return;n._time=r,i=Math.floor(t.loaded/t.total*(n.chunkSize||n._progress.total))+(n.uploadedBytes||0),this._progress.loaded+=i-n._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,n.bitrateInterval),n._progress.loaded=n.loaded=i,n._progress.bitrate=n.bitrate=n._bitrateTimer.getBitrate(r,i,n.bitrateInterval),this._trigger("progress",e.Event("progress",{delegatedEvent:t}),n),this._trigger("progressall",e.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var n=this,r=t.xhr?t.xhr():e.ajaxSettings.xhr();r.upload&&(e(r.upload).bind("progress",function(e){var r=e.originalEvent;e.lengthComputable=r.lengthComputable,e.loaded=r.loaded,e.total=r.total,n._onProgress(e,t)}),t.xhr=function(){return r})},_isInstanceOf:function(e,t){return Object.prototype.toString.call(t)==="[object "+e+"]"},_initXHRData:function(t){var n=this,r,i=t.files[0],s=t.multipart||!e.support.xhrFileUpload,o=e.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=e.extend({},t.headers),t.contentRange&&(t.headers["Content-Range"]=t.contentRange);if(!s||t.blob||!this._isInstanceOf("File",i))t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(i.name)+'"';s?e.support.xhrFormDataFileUpload&&(t.postMessage?(r=this._getFormData(t),t.blob?r.push({name:o,value:t.blob}):e.each(t.files,function(n,i){r.push({name:e.type(t.paramName)==="array"&&t.paramName[n]||o,value:i})})):(n._isInstanceOf("FormData",t.formData)?r=t.formData:(r=new FormData,e.each(this._getFormData(t),function(e,t){r.append(t.name,t.value)})),t.blob?r.append(o,t.blob,i.name):e.each(t.files,function(i,s){(n._isInstanceOf("File",s)||n._isInstanceOf("Blob",s))&&r.append(e.type(t.paramName)==="array"&&t.paramName[i]||o,s,s.uploadName||s.name)})),t.data=r):(t.contentType=i.type||"application/octet-stream",t.data=t.blob||i),t.blob=null},_initIframeSettings:function(t){var n=e("<a></a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||""),t.formData=this._getFormData(t),t.redirect&&n&&n!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(e){this._isXHRUpload(e)?(this._chunkedUpload(e,!0)||(e.data||this._initXHRData(e),this._initProgressListener(e)),e.postMessage&&(e.dataType="postmessage "+(e.dataType||""))):this._initIframeSettings(e)},_getParamName:function(t){var n=e(t.fileInput),r=t.paramName;return r?e.isArray(r)||(r=[r]):(r=[],n.each(function(){var t=e(this),n=t.prop("name")||"files[]",i=(t.prop("files")||[1]).length;while(i)r.push(n),i-=1}),r.length||(r=[n.prop("name")||"files[]"])),r},_initFormSettings:function(t){if(!t.form||!t.form.length)t.form=e(t.fileInput.prop("form")),t.form.length||(t.form=e(this.options.fileInput.prop("form")));t.paramName=this._getParamName(t),t.url||(t.url=t.form.prop("action")||location.href),t.type=(t.type||e.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase(),t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST"),t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var n=e.extend({},this.options,t);return this._initFormSettings(n),this._initDataSettings(n),n},_getDeferredState:function(e){return e.state?e.state():e.isResolved()?"resolved":e.isRejected()?"rejected":"pending"},_enhancePromise:function(e){return e.success=e.done,e.error=e.fail,e.complete=e.always,e},_getXHRPromise:function(t,n,r){var i=e.Deferred(),s=i.promise();return n=n||this.options.context||s,t===!0?i.resolveWith(n,r):t===!1&&i.rejectWith(n,r),s.abort=i.promise,this._enhancePromise(s)},_addConvenienceMethods:function(t,n){var r=this,i=function(t){return e.Deferred().resolveWith(r,t).promise()};n.process=function(t,s){if(t||s)n._processQueue=this._processQueue=(this._processQueue||i([this])).pipe(function(){return n.errorThrown?e.Deferred().rejectWith(r,[n]).promise():i(arguments)}).pipe(t,s);return this._processQueue||i([this])},n.submit=function(){return this.state()!=="pending"&&(n.jqXHR=this.jqXHR=r._trigger("submit",e.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()},n.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))},n.state=function(){if(this.jqXHR)return r._getDeferredState(this.jqXHR);if(this._processQueue)return r._getDeferredState(this._processQueue)},n.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"},n.progress=function(){return this._progress},n.response=function(){return this._response}},_getUploadedBytes:function(e){var t=e.getResponseHeader("Range"),n=t&&t.split("-"),r=n&&n.length>1&&parseInt(n[1],10);return r&&r+1},_chunkedUpload:function(t,n){t.uploadedBytes=t.uploadedBytes||0;var r=this,i=t.files[0],s=i.size,o=t.uploadedBytes,u=t.maxChunkSize||s,a=this._blobSlice,f=e.Deferred(),l=f.promise(),c,h;return!(this._isXHRUpload(t)&&a&&(o||u<s))||t.data?!1:n?!0:o>=s?(i.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",i.error])):(h=function(){var n=e.extend({},t),l=n._progress.loaded;n.blob=a.call(i,o,o+u,i.type),n.chunkSize=n.blob.size,n.contentRange="bytes "+o+"-"+(o+n.chunkSize-1)+"/"+s,r._initXHRData(n),r._initProgressListener(n),c=(r._trigger("chunksend",null,n)!==!1&&e.ajax(n)||r._getXHRPromise(!1,n.context)).done(function(i,u,a){o=r._getUploadedBytes(a)||o+n.chunkSize,l+n.chunkSize-n._progress.loaded&&r._onProgress(e.Event("progress",{lengthComputable:!0,loaded:o-n.uploadedBytes,total:o-n.uploadedBytes}),n),t.uploadedBytes=n.uploadedBytes=o,n.result=i,n.textStatus=u,n.jqXHR=a,r._trigger("chunkdone",null,n),r._trigger("chunkalways",null,n),o<s?h():f.resolveWith(n.context,[i,u,a])}).fail(function(e,t,i){n.jqXHR=e,n.textStatus=t,n.errorThrown=i,r._trigger("chunkfail",null,n),r._trigger("chunkalways",null,n),f.rejectWith(n.context,[e,t,i])})},this._enhancePromise(l),l.abort=function(){return c.abort()},h(),l)},_beforeSend:function(e,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(t),this._initProgressObject(t),t._progress.loaded=t.loaded=t.uploadedBytes||0,t._progress.total=t.total=this._getTotal(t.files)||1,t._progress.bitrate=t.bitrate=0,this._active+=1,this._progress.loaded+=t.loaded,this._progress.total+=t.total},_onDone:function(t,n,r,i){var s=i._progress.total,o=i._response;i._progress.loaded<s&&this._onProgress(e.Event("progress",{lengthComputable:!0,loaded:s,total:s}),i),o.result=i.result=t,o.textStatus=i.textStatus=n,o.jqXHR=i.jqXHR=r,this._trigger("done",null,i)},_onFail:function(e,t,n,r){var i=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total),i.jqXHR=r.jqXHR=e,i.textStatus=r.textStatus=t,i.errorThrown=r.errorThrown=n,this._trigger("fail",null,r)},_onAlways:function(e,t,n,r){this._trigger("always",null,r)},_onSend:function(t,n){n.submit||this._addConvenienceMethods(t,n);var r=this,i,s,o,u,a=r._getAJAXSettings(n),f=function(){return r._sending+=1,a._bitrateTimer=new r._BitrateTimer,i=i||((s||r._trigger("send",e.Event("send",{delegatedEvent:t}),a)===!1)&&r._getXHRPromise(!1,a.context,s)||r._chunkedUpload(a)||e.ajax(a)).done(function(e,t,n){r._onDone(e,t,n,a)}).fail(function(e,t,n){r._onFail(e,t,n,a)}).always(function(e,t,n){r._onAlways(e,t,n,a),r._sending-=1,r._active-=1;if(a.limitConcurrentUploads&&a.limitConcurrentUploads>r._sending){var i=r._slots.shift();while(i){if(r._getDeferredState(i)==="pending"){i.resolve();break}i=r._slots.shift()}}r._active===0&&r._trigger("stop")}),i};return this._beforeSend(t,a),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(o=e.Deferred(),this._slots.push(o),u=o.pipe(f)):(this._sequence=this._sequence.pipe(f,f),u=this._sequence),u.abort=function(){return s=[undefined,"abort","abort"],i?i.abort():(o&&o.rejectWith(a.context,s),f())},this._enhancePromise(u)):f()},_onAdd:function(t,n){var r=this,i=!0,s=e.extend({},this.options,n),o=n.files,u=o.length,a=s.limitMultiFileUploads,f=s.limitMultiFileUploadSize,l=s.limitMultiFileUploadSizeOverhead,c=0,h=this._getParamName(s),p,d,v,m,g=0;f&&(!u||o[0].size===undefined)&&(f=undefined);if(!(s.singleFileUploads||a||f)||!this._isXHRUpload(s))v=[o],p=[h];else if(!s.singleFileUploads&&!f&&a){v=[],p=[];for(m=0;m<u;m+=a)v.push(o.slice(m,m+a)),d=h.slice(m,m+a),d.length||(d=h),p.push(d)}else if(!s.singleFileUploads&&f){v=[],p=[];for(m=0;m<u;m+=1){c+=o[m].size+l;if(m+1===u||c+o[m+1].size+l>f||a&&m+1-g>=a)v.push(o.slice(g,m+1)),d=h.slice(g,m+1),d.length||(d=h),p.push(d),g=m+1,c=0}}else p=h;return n.originalFiles=o,e.each(v||o,function(s,o){var u=e.extend({},n);return u.files=v?o:[o],u.paramName=p[s],r._initResponseObject(u),r._initProgressObject(u),r._addConvenienceMethods(t,u),i=r._trigger("add",e.Event("add",{delegatedEvent:t}),u),i}),i},_replaceFileInput:function(t){var n=t.fileInput,r=n.clone(!0);t.fileInputClone=r,e("<form></form>").append(r)[0].reset(),n.after(r).detach(),e.cleanData(n.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(e,t){return t===n[0]?r[0]:t}),n[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,n){var r=this,i=e.Deferred(),s=function(e){e&&!e.entry&&(e.entry=t),i.resolve([e])},o=function(e){r._handleFileTreeEntries(e,n+t.name+"/").done(function(e){i.resolve(e)}).fail(s)},u=function(){a.readEntries(function(e){e.length?(f=f.concat(e),u()):o(f)},s)},a,f=[];return n=n||"",t.isFile?t._file?(t._file.relativePath=n,i.resolve(t._file)):t.file(function(e){e.relativePath=n,i.resolve(e)},s):t.isDirectory?(a=t.createReader(),u()):i.resolve([]),i.promise()},_handleFileTreeEntries:function(t,n){var r=this;return e.when.apply(e,e.map(t,function(e){return r._handleFileTreeEntry(e,n)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var n=t.items;return n&&n.length&&(n[0].webkitGetAsEntry||n[0].getAsEntry)?this._handleFileTreeEntries(e.map(n,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):e.Deferred().resolve(e.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=e(t);var n=t.prop("webkitEntries")||t.prop("entries"),r,i;if(n&&n.length)return this._handleFileTreeEntries(n);r=e.makeArray(t.prop("files"));if(!r.length){i=t.prop("value");if(!i)return e.Deferred().resolve([]).promise();r=[{name:i.replace(/^.*\\/,"")}]}else r[0].name===undefined&&r[0].fileName&&e.each(r,function(e,t){t.name=t.fileName,t.size=t.fileSize});return e.Deferred().resolve(r).promise()},_getFileInputFiles:function(t){return t instanceof e&&t.length!==1?e.when.apply(e,e.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(t)},_onChange:function(t){var n=this,r={fileInput:e(t.target),form:e(t.target.form)};this._getFileInputFiles(r.fileInput).always(function(i){r.files=i,n.options.replaceFileInput&&n._replaceFileInput(r),n._trigger("change",e.Event("change",{delegatedEvent:t}),r)!==!1&&n._onAdd(t,r)})},_onPaste:function(t){var n=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};n&&n.length&&(e.each(n,function(e,t){var n=t.getAsFile&&t.getAsFile();n&&r.files.push(n)}),this._trigger("paste",e.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var n=this,r=t.dataTransfer,i={};r&&r.files&&r.files.length&&(t.preventDefault(),this._getDroppedFiles(r).always(function(r){i.files=r,n._trigger("drop",e.Event("drop",{delegatedEvent:t}),i)!==!1&&n._onAdd(t,i)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),e.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(t,n){var r=e.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers(),this._super(t,n),r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof e||(t.fileInput=e(t.fileInput)),t.dropZone instanceof e||(t.dropZone=e(t.dropZone)),t.pasteZone instanceof e||(t.pasteZone=e(t.pasteZone))},_getRegExp:function(e){var t=e.split("/"),n=t.pop();return t.shift(),new RegExp(t.join("/"),n)},_isRegExpOption:function(t,n){return t!=="url"&&e.type(n)==="string"&&/^\/.*\/[igm]{0,3}$/.test(n)},_initDataAttributes:function(){var t=this,n=this.options,r=this.element.data();e.each(this.element[0].attributes,function(e,i){var s=i.name.toLowerCase(),o;/^data-/.test(s)&&(s=s.slice(5).replace(/-[a-z]/g,function(e){return e.charAt(1).toUpperCase()}),o=r[s],t._isRegExpOption(s,o)&&(o=t._getRegExp(o)),n[s]=o)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var n=this;if(!t||this.options.disabled)return;t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(e){t.files=e,n._onAdd(null,t)}):(t.files=e.makeArray(t.files),this._onAdd(null,t))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var n=this,r=e.Deferred(),i=r.promise(),s,o;return i.abort=function(){return o=!0,s?s.abort():(r.reject(null,"abort","abort"),i)},this._getFileInputFiles(t.fileInput).always(function(e){if(o)return;if(!e.length){r.reject();return}t.files=e,s=n._onSend(null,t),s.then(function(e,t,n){r.resolve(e,t,n)},function(e,t,n){r.reject(e,t,n)})}),this._enhancePromise(i)}t.files=e.makeArray(t.files);if(t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});var bkExtend=function(){var e=arguments;e.length==1&&(e=[this,e[0]]);for(var t in e[1])e[0][t]=e[1][t];return e[0]};bkClass.prototype.construct=function(){},bkClass.extend=function(e){var t=function(){if(arguments[0]!==bkClass)return this.construct.apply(this,arguments)},n=new this(bkClass);return bkExtend(n,e),t.prototype=n,t.extend=this.extend,t};var bkElement=bkClass.extend({construct:function(e,t){return typeof e=="string"&&(e=(t||document).createElement(e)),e=$BK(e),e},appendTo:function(e){return e.appendChild(this),this},appendBefore:function(e){return e.parentNode.insertBefore(this,e),this},addEvent:function(e,t){return bkLib.addEvent(this,e,t),this},setContent:function(e){return this.innerHTML=e,this},pos:function(){var e=curtop=0,t=obj=this;if(obj.offsetParent)do e+=obj.offsetLeft,curtop+=obj.offsetTop;while(obj=obj.offsetParent);var n=window.opera?0:parseInt(this.getStyle("border-width")||this.style.border)||0;return[e+n,curtop+n+this.offsetHeight]},noSelect:function(){return bkLib.noSelect(this),this},parentTag:function(e){var t=this;do{if(t&&t.nodeName&&t.nodeName.toUpperCase()==e)return t;t=t.parentNode}while(t);return!1},hasClass:function(e){return this.className.match(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)"))},addClass:function(e){return this.hasClass(e)||(this.className+=" nicEdit-"+e),this},removeClass:function(e){return this.hasClass(e)&&(this.className=this.className.replace(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)")," ")),this},setStyle:function(e){var t=this.style;for(var n in e)switch(n){case"float":t.cssFloat=t.styleFloat=e[n];break;case"opacity":t.opacity=e[n],t.filter="alpha(opacity="+Math.round(e[n]*100)+")";break;case"className":this.className=e[n];break;default:t[n]=e[n]}return this},getStyle:function(e,t){var n=t?t:document.defaultView;if(this.nodeType==1)return n&&n.getComputedStyle?n.getComputedStyle(this,null).getPropertyValue(e):this.currentStyle[bkLib.camelize(e)]},remove:function(){return this.parentNode.removeChild(this),this},setAttributes:function(e){for(var t in e)this[t]=e[t];return this}}),bkLib={isMSIE:navigator.appVersion.indexOf("MSIE")!=-1,addEvent:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},toArray:function(e){var t=e.length,n=new Array(t);while(t--)n[t]=e[t];return n},noSelect:function(e){e.setAttribute&&e.nodeName.toLowerCase()!="input"&&e.nodeName.toLowerCase()!="textarea"&&e.setAttribute("unselectable","on");for(var t=0;t<e.childNodes.length;t++)bkLib.noSelect(e.childNodes[t])},camelize:function(e){return e.replace(/\-(.)/g,function(e,t){return t.toUpperCase()})},inArray:function(e,t){return bkLib.search(e,t)!=null},search:function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return null},cancelEvent:function(e){return e=e||window.event,e.preventDefault&&e.stopPropagation&&(e.preventDefault(),e.stopPropagation()),!1},domLoad:[],domLoaded:function(){if(arguments.callee.done)return;arguments.callee.done=!0;for(i=0;i<bkLib.domLoad.length;i++)bkLib.domLoad[i]()},onDomLoaded:function(e){this.domLoad.push(e),document.addEventListener?document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null):bkLib.isMSIE&&(document.write("<style>.nicEdit-main p { margin: 0; }</style><script id=__ie_onload defer "+(location.protocol=="https:"?"src='javascript:void(0)'":"src=//0")+"></script>"),$BK("__ie_onload").onreadystatechange=function(){this.readyState=="complete"&&bkLib.domLoaded()}),window.onload=bkLib.domLoaded}},bkEvent={addEvent:function(e,t){return t&&(this.eventList=this.eventList||{},this.eventList[e]=this.eventList[e]||[],this.eventList[e].push(t)),this},fireEvent:function(){var e=bkLib.toArray(arguments),t=e.shift();if(this.eventList&&this.eventList[t])for(var n=0;n<this.eventList[t].length;n++)this.eventList[t][n].apply(this,e)}};Function.prototype.closure=function(){var e=this,t=bkLib.toArray(arguments),n=t.shift();return function(){if(typeof bkLib!="undefined")return e.apply(n,t.concat(bkLib.toArray(arguments)))}},Function.prototype.closureListener=function(){var e=this,t=bkLib.toArray(arguments),n=t.shift();return function(r){r=r||window.event;if(r.target)var i=r.target;else var i=r.srcElement;return e.apply(n,[r,i].concat(t))}};var nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b"},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i"},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u"},left:{name:__("Left Align"),command:"justifyleft",noActive:!0},center:{name:__("Center Align"),command:"justifycenter",noActive:!0},right:{name:__("Right Align"),command:"justifyright",noActive:!0},justify:{name:__("Justify Align"),command:"justifyfull",noActive:!0},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"]},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"]},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"]},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"]},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"}},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:!0},indent:{name:__("Indent Text"),command:"indent",noActive:!0},outdent:{name:__("Remove Indent"),command:"outdent",noActive:!0},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:!0}},iconsPath:"/images/nicEditorIcons.gif",buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","bgcolor"],iconList:{bold:1,center:2,hr:3,indent:4,italic:5,justify:6,left:7,ol:8,outdent:9,removeformat:10,right:11,save:12,strikethrough:13,subscript:14,superscript:15,ul:16,underline:17}}),nicEditors={nicPlugins:[],editors:[],registerPlugin:function(e,t){this.nicPlugins.push({p:e,o:t})},allTextAreas:function(e){var t=document.getElementsByTagName("textarea");for(var n=0;n<t.length;n++)nicEditors.editors.push((new nicEditor(e)).panelInstance(t[n]));return nicEditors.editors},findEditor:function(e){var t=nicEditors.editors;for(var n=0;n<t.length;n++)if(t[n].instanceById(e))return t[n].instanceById(e)}},nicEditor=bkClass.extend({construct:function(e){this.options=new nicEditorConfig,bkExtend(this.options,e),this.nicInstances=new Array,this.loadedPlugins=new Array;var t=nicEditors.nicPlugins;for(var n=0;n<t.length;n++)this.loadedPlugins.push(new t[n].p(this,t[n].o));nicEditors.editors.push(this),bkLib.addEvent(document.body,"mousedown",this.selectCheck.closureListener(this))},panelInstance:function(e,t){e=this.checkReplace($BK(e));var n=(new bkElement("DIV")).setStyle({width:(parseInt(e.getStyle("width"))||e.clientWidth)+"px"}).appendBefore(e);return this.setPanel(n),this.addInstance(e,t)},checkReplace:function(e){var t=nicEditors.findEditor(e);return t&&(t.removeInstance(e),t.removePanel()),e},addInstance:function(e,t){e=this.checkReplace($BK(e));if(e.contentEditable||!!window.opera)var n=new nicEditorInstance(e,t,this);else var n=new nicEditorIFrameInstance(e,t,this);return this.nicInstances.push(n),this},removeInstance:function(e){e=$BK(e);var t=this.nicInstances;for(var n=0;n<t.length;n++)t[n].e==e&&(t[n].remove(),this.nicInstances.splice(n,1))},removePanel:function(e){this.nicPanel&&(this.nicPanel.remove(),this.nicPanel=null)},instanceById:function(e){e=$BK(e);var t=this.nicInstances;for(var n=0;n<t.length;n++)if(t[n].e==e)return t[n]},setPanel:function(e){return this.nicPanel=new nicEditorPanel($BK(e),this.options,this),this.fireEvent("panel",this.nicPanel),this},nicCommand:function(e,t){this.selectedInstance&&this.selectedInstance.nicCommand(e,t)},getIcon:function(e,t){var n=this.options.iconList[e],r=t.iconFiles?t.iconFiles[e]:"";return{backgroundImage:"url('"+(n?this.options.iconsPath:r)+"')",backgroundPosition:(n?(n-1)*-18:0)+"px 0px"}},selectCheck:function(e,t){var n=!1;do if(t.className&&t.className.indexOf("nicEdit")!=-1)return!1;while(t=t.parentNode);return this.fireEvent("blur",this.selectedInstance,t),this.lastSelectedInstance=this.selectedInstance,this.selectedInstance=null,!1}});nicEditor=nicEditor.extend(bkEvent);var nicEditorInstance=bkClass.extend({isSelected:!1,construct:function(e,t,n){this.ne=n,this.elm=this.e=e,this.options=t||{},newX=parseInt(e.getStyle("width"))||e.clientWidth,newY=parseInt(e.getStyle("height"))||e.clientHeight,this.initialHeight=newY-8;var r=e.nodeName.toLowerCase()=="textarea";if(r||this.options.hasPanel){var i=bkLib.isMSIE&&(typeof document.body.style.maxHeight=="undefined"||document.compatMode!="CSS1Compat"),s={width:newX+"px",border:"1px solid #ccc",borderTop:0,overflowY:"auto",overflowX:"hidden"};s[i?"height":"maxHeight"]=this.ne.options.maxHeight?this.ne.options.maxHeight+"px":null,this.editorContain=(new bkElement("DIV")).setStyle(s).appendBefore(e);var o=(new bkElement("DIV")).setStyle({width:newX-8+"px",margin:"4px",minHeight:newY+"px"}).addClass("main").appendTo(this.editorContain);e.setStyle({display:"none"}),o.innerHTML=e.innerHTML;if(r){o.setContent(e.value),this.copyElm=e;var u=e.parentTag("FORM");u&&bkLib.addEvent(u,"submit",this.saveContent.closure(this))}o.setStyle(i?{height:newY+"px"}:{overflow:"hidden"}),this.elm=o}this.ne.addEvent("blur",this.blur.closure(this)),this.init(),this.blur()},init:function(){this.elm.setAttribute("contentEditable","true"),this.getContent()==""&&this.setContent("<br />"),this.instanceDoc=document.defaultView,this.elm.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keypress",this.keyDown.closureListener(this)).addEvent("focus",this.selected.closure(this)).addEvent("blur",this.blur.closure(this)).addEvent("keyup",this.selected.closure(this)),this.ne.fireEvent("add",this)},remove:function(){this.saveContent();if(this.copyElm||this.options.hasPanel)this.editorContain.remove(),this.e.setStyle({display:"block"}),this.ne.removePanel();this.disable(),this.ne.fireEvent("remove",this)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var e=this.getSel();if(!e||e.rangeCount===0)return;return e.rangeCount>0?e.getRangeAt(0):e.createRange()},selRng:function(e,t){window.getSelection?(t.removeAllRanges(),t.addRange(e)):e.select()},selElm:function(){var e=this.getRng();if(!e)return;if(e.startContainer){var t=e.startContainer;if(e.cloneContents().childNodes.length==1)for(var n=0;n<t.childNodes.length;n++){var r=t.childNodes[n].ownerDocument.createRange();r.selectNode(t.childNodes[n]);if(e.compareBoundaryPoints(Range.START_TO_START,r)!=1&&e.compareBoundaryPoints(Range.END_TO_END,r)!=-1)return $BK(t.childNodes[n])}return $BK(t)}return $BK(this.getSel().type=="Control"?e.item(0):e.parentElement())},saveRng:function(){this.savedRange=this.getRng(),this.savedSel=this.getSel()},restoreRng:function(){this.savedRange&&this.selRng(this.savedRange,this.savedSel)},keyDown:function(e,t){e.ctrlKey&&this.ne.fireEvent("key",this,e)},selected:function(e,t){!t&&!(t=this.selElm)&&(t=this.selElm());if(!e.ctrlKey){var n=this.ne.selectedInstance;n!=this&&(n&&this.ne.fireEvent("blur",n,t),this.ne.selectedInstance=this,this.ne.fireEvent("focus",n,t)),this.ne.fireEvent("selected",n,t),this.isFocused=!0,this.elm.addClass("selected")}return!1},blur:function(){this.isFocused=!1,this.elm.removeClass("selected")},saveContent:function(){if(this.copyElm||this.options.hasPanel)this.ne.fireEvent("save",this),this.copyElm?this.copyElm.value=this.getContent():this.e.innerHTML=this.getContent()},getElm:function(){return this.elm},getContent:function(){return this.content=this.getElm().innerHTML,this.ne.fireEvent("get",this),this.content},setContent:function(e){this.content=e,this.ne.fireEvent("set",this),this.elm.innerHTML=this.content},nicCommand:function(e,t){document.execCommand(e,!1,t)}}),nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var e=this.elm.innerHTML.replace(/^\s+|\s+$/g,"");this.elm.innerHTML="",e?e:e="<br />",this.initialContent=e,this.elmFrame=(new bkElement("iframe")).setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(this.elm),this.copyElm&&this.elmFrame.setStyle({width:this.elm.offsetWidth-4+"px"});var t=["font-size","font-family","font-weight","color"];for(itm in t)this.savedStyles[bkLib.camelize(itm)]=this.elm.getStyle(itm);setTimeout(this.initFrame.closure(this),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var e=$BK(this.elmFrame.contentWindow.document);e.designMode="on",e.open();var t=this.ne.options.externalCSS;e.write("<html><head>"+(t?'<link href="'+t+'" rel="stylesheet" type="text/css" />':"")+'</head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+this.initialContent+"</body></html>"),e.close(),this.frameDoc=e,this.frameWin=$BK(this.elmFrame.contentWindow),this.frameContent=$BK(this.frameWin.document.body).setStyle(this.savedStyles),this.instanceDoc=this.frameWin.document.defaultView,this.heightUpdate(),this.frameDoc.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keyup",this.heightUpdate.closureListener(this)).addEvent("keydown",this.keyDown.closureListener(this)).addEvent("keyup",this.selected.closure(this)),this.ne.fireEvent("add",this)},getElm:function(){return this.frameContent},setContent:function(e){this.content=e,this.ne.fireEvent("set",this),this.frameContent.innerHTML=this.content,this.heightUpdate()},getSel:function(){return this.frameWin?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(e,t){this.frameDoc.execCommand(e,!1,t),setTimeout(this.heightUpdate.closure(this),100)}}),nicEditorPanel=bkClass.extend({construct:function(e,t,n){this.elm=e,this.options=t,this.ne=n,this.panelButtons=new Array,this.buttonList=bkExtend([],this.ne.options.buttonList),this.panelContain=(new bkElement("DIV")).setStyle({overflow:"hidden",width:"100%",border:"1px solid #cccccc",backgroundColor:"#efefef"}).addClass("panelContain"),this.panelElm=(new bkElement("DIV")).setStyle({margin:"2px",marginTop:"0px",zoom:1,overflow:"hidden"}).addClass("panel").appendTo(this.panelContain),this.panelContain.appendTo(e);var r=this.ne.options,i=r.buttons;for(button in i)this.addButton(button,r,!0);this.reorder(),e.noSelect()},addButton:function(buttonName,options,noOrder){var button=options.buttons[buttonName],type=button.type?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton,hasButton=bkLib.inArray(this.buttonList,buttonName);type&&(hasButton||this.ne.options.fullPanel)&&(this.panelButtons.push(new type(this.panelElm,buttonName,options,this.ne)),hasButton||this.buttonList.push(buttonName))},findButton:function(e){for(var t=0;t<this.panelButtons.length;t++)if(this.panelButtons[t].name==e)return this.panelButtons[t]},reorder:function(){var e=this.buttonList;for(var t=0;t<e.length;t++){var n=this.findButton(e[t]);n&&this.panelElm.appendChild(n.margin)}},remove:function(){this.elm.remove()}}),nicEditorButton=bkClass.extend({construct:function(e,t,n,r){this.options=n.buttons[t],this.name=t,this.ne=r,this.elm=e,this.margin=(new bkElement("DIV")).setStyle({"float":"left",marginTop:"2px"}).appendTo(e),this.contain=(new bkElement("DIV")).setStyle({width:"20px",height:"20px"}).addClass("buttonContain").appendTo(this.margin),this.border=(new bkElement("DIV")).setStyle({backgroundColor:"#efefef",border:"1px solid #efefef"}).appendTo(this.contain),this.button=(new bkElement("DIV")).setStyle({width:"18px",height:"18px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").setStyle(this.ne.getIcon(t,n)).appendTo(this.border),this.button.addEvent("mouseover",this.hoverOn.closure(this)).addEvent("mouseout",this.hoverOff.closure(this)).addEvent("mousedown",this.mouseClick.closure(this)).noSelect(),window.opera||(this.button.onmousedown=this.button.onclick=bkLib.cancelEvent),r.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)).addEvent("key",this.key.closure(this)),this.disable(),this.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){this.isDisabled?this.setBg():this.isHover?this.setBg("hover"):this.isActive?this.setBg("active"):this.setBg()},setBg:function(e){switch(e){case"hover":var t={border:"1px solid #666",backgroundColor:"#ddd"};break;case"active":var t={border:"1px solid #666",backgroundColor:"#ccc"};break;default:var t={border:"1px solid #efefef",backgroundColor:"#efefef"}}this.border.setStyle(t).addClass("button-"+e)},checkNodes:function(e){var t=e;do if(this.options.tags&&bkLib.inArray(this.options.tags,t.nodeName))return this.activate(),!0;while(t=t.parentNode&&t.className!="nicEdit");t=$BK(e);while(t.nodeType==3)t=$BK(t.parentNode);if(this.options.css)for(itm in this.options.css)if(t.getStyle(itm,this.ne.selectedInstance.instanceDoc)==this.options.css[itm])return this.activate(),!0;return this.deactivate(),!1},activate:function(){this.isDisabled||(this.isActive=!0,this.updateState(),this.ne.fireEvent("buttonActivate",this))},deactivate:function(){this.isActive=!1,this.updateState(),this.isDisabled||this.ne.fireEvent("buttonDeactivate",this)},enable:function(e,t){this.isDisabled=!1,this.contain.setStyle({opacity:1}).addClass("buttonEnabled"),this.updateState(),this.checkNodes(t)},disable:function(e,t){this.isDisabled=!0,this.contain.setStyle({opacity:.6}).removeClass("buttonEnabled"),this.updateState()},toggleActive:function(){this.isActive?this.deactivate():this.activate()},hoverOn:function(){this.isDisabled||(this.isHover=!0,this.updateState(),this.ne.fireEvent("buttonOver",this))},hoverOff:function(){this.isHover=!1,this.updateState(),this.ne.fireEvent("buttonOut",this)},mouseClick:function(){this.options.command&&(this.ne.nicCommand(this.options.command,this.options.commandArgs),this.options.noActive||this.toggleActive()),this.ne.fireEvent("buttonClick",this)},key:function(e,t){this.options.key&&t.ctrlKey&&String.fromCharCode(t.keyCode||t.charCode).toLowerCase()==this.options.key&&(this.mouseClick(),t.preventDefault&&t.preventDefault())}}),nicPlugin=bkClass.extend({construct:function(e,t){this.options=t,this.ne=e,this.ne.addEvent("panel",this.loadPanel.closure(this)),this.init()},loadPanel:function(e){var t=this.options.buttons;for(var n in t)e.addButton(n,this.options);e.reorder()},init:function(){}});define("nicEdit",function(){}),define("views/partials/add",["marionette","templates/set/add","views/partials/behaviors/contacts","fileupload","nicEdit","maskedInput","ymap"],function(Marionette,templates,ContactsBehavior){var photoList=Backbone.Collection.extend({}),paramList=Backbone.Collection.extend({comparator:function(e){return e.get("weight")}}),paramView=Backbone.View.extend({tagName:"div",containers:{list:".fn-list-parameters",row:".fn-rows-parameters"},events:{change:"change",keyup:"keyup"},initialize:function(e){_.extend(this,e),this.$el=$("#"+this.model.get("id")),this.model.get("type")||(this.type=this.model.get("data")[0].type,this.model.set("type",this.type)),this.$el.length==0?this.render():this.model.set("value",this.$el.val());var t=this.initChilds();this.model.set("childs",t)},render:function(){var e=this,t=this.model.get("type");this.model.get("custom")&&(t="custom"+this.model.get("custom"));var n=_.template(templates[t])(this.model.toJSON());return this.appendToOwnPosition(this.model,n),this.$el=$("#"+this.model.get("id")),this.whitespace(),n},appendToOwnPosition:function(e,t){var n=$(this.containers[e.get("container")]),r=new paramList(this.collection.where({container:e.get("container")})),i=r.indexOf(this.model);if(r.length>1)if(i){var s=r.at(i-1);$(t).insertAfter("#div_"+s.get("id"))}else{var s=r.at(1);$(t).insertBefore("#div_"+s.get("id"))}else n.append(t)},whitespace:function(){this.model.get("options")=="whitespace"&&this.$el.closest(".col-md-6").addClass("whitespace")},change:function(e){this.removeChilds(this.model.get("childs")),this.model.set("value",$(e.target).val());var t=this.initChilds();this.model.set("childs",t);var n="div_"+this.model.get("id");this.model.get("value")?(this.app.removeError(n),this.app.removeRequired(n)):this.app.addRequired(n),this.paramsBlock.initAddressPrecision()},keyup:function(e){this.model.set("value",$(e.target).val());var t="div_"+this.model.get("id");this.model.get("value")?(this.app.removeError(t),this.app.removeRequired(t)):this.app.addRequired(t)},initChilds:function(){var e=this,t=this.model.get("data"),n=[];if(this.model.get("type")!="list")return;_.isArray(this.model.get("value"))?_.each(this.model.get("value"),function(e){n.push(t[e])}):n.push(t[this.model.get("value")]);var r=[];return _.each(n,function(t){_.isObject(t)&&_.each(t,function(t,n){if(n==0)return;var i={classes:"fn-param",value:"",data:t,added:1,parent_id:e.model.get("id")};_.extend(i,t[0]),e.collection.add(i),r.push(i.id)})}),r},removeChilds:function(e){var t=this;_.each(e,function(e){t.collection.get(e).get("childs")&&t.removeChilds(t.collection.get(e).get("childs")),t.collection.remove(t.collection.get(e))})}}),paramsView=Backbone.View.extend({el:"#div_params",template:templates.parameters,initialize:function(e){var t=this;_.extend(this,e),this.bind("destroy",this.destroy);var n=data[this.category_id],r=_.keys(n).length>1;if(!r)return;this.$el.children().length==0&&this.render(),this.collection=new paramList,this.collection.on("add",this.addItem,this),this.collection.on("remove",this.removeItem,this),_.each(n,function(e,n){if(n==0)return;var r=$("#"+e[0].id),i=r.attr("class"),s=r.val(),o={classes:i?i:"fn-param",value:s?s:"",data:e,added:r.length?1:0};_.extend(o,e[0]),t.collection.add(o)}),this.initAddressPrecision()},render:function(){var e={lists:0},t=_.template(this.template)({});return this.$el.html(t),this},addItem:function(e){e.set("container",this.getContainer(e)),e.get("type")=="text"&&e.get("is_textarea")&&e.set("type","textarea"),e.get("type")=="ilist"&&e.set("type","list"),new paramView({model:e,collection:this.collection,app:this.app,paramsBlock:this}),e.get("custom")=="address"&&this.app._init_map(e.get("id"))},removeItem:function(e){e.get("custom")=="address"&&this.app.cmap.trigger("disable"),$("#div_"+e.get("id")).remove()},getContainer:function(e){var t=e.get("type"),n=e.get("custom");return _.contains(["list","ilist"],t)>0&&n!="multiselect"?"list":"row"},destroy:function(){return this.$el.empty(),this.stopListening(),this},initAddressPrecision:function(){if(!this.address_precisions)return;var e=this,t=null;_.each(this.address_precisions,function(n){t=n.filters,delete t.rubricid,_.keys(t).length?_.each(t,function(t,r){e.collection.get(r)&&_.indexOf(t,+e.collection.get(r).get("value").replace("_",""))!=-1&&(e.app.address_precision=n.precision,e.app.precision_error=n.error_text,e.app.cmap.mapcontrol&&e.app.cmap.mapcontrol.setMessage(n.error_text,"blue"))}):(e.app.address_precision=n.precision,e.app.precision_error=n.error_text,e.app.cmap.mapcontrol&&e.app.cmap.mapcontrol.setMessage(n.error_text,"blue"))})}}),cityView=Backbone.View.extend({el:"#div_city",events:{"change select":"change","click #real_city_exists":"setRealCity","keyup #real_city":"changeRealCity"},initialize:function(e){_.extend(this,e),this.control=this.$el.find("select"),this.control.length?(this.value=this.control.val(),this.title=this.control.find("option:selected").text()):(this.control=this.$el.find("input"),this.value=this.control.val(),this.title=this.control.data("title")),this.init_real_city()},init_real_city:function(){this.app.real_city_exists=$("#real_city_exists").prop("checked"),this.app.real_city=this.app.real_city_exists?$("#real_city").val():""},change:function(){this.value=this.control.val(),this.title=this.control.find("option:selected").text(),this.setLatLon(),this.app.cmap.mapcontrol&&this.app.cmap.mapcontrol.keyup();var e="div_city";this.value?(this.app.removeError(e),this.app.removeRequired(e)):this.app.addRequired(e)},setLatLon:function(){var e=this.control.find("option:selected");this.control.attr("data-lon",e.attr("lon")),this.control.attr("data-lat",e.attr("lat"))},setRealCity:function(e){$(".real_city_exists").toggle(),this.changeRealCity()},changeRealCity:function(e){this.init_real_city(),this.app.cmap.mapcontrol&&(this.app.cmap.mapcontrol.setMessage(""),this.app.cmap.mapcontrol.keyup(e))}}),mapView=Backbone.View.extend({el:"#div_map",initialize:function(e){_.extend(this,e),this.bind("enable",this.on),this.bind("disable",this.off)},on:function(e){var t=this;_.extend(t,e),t.$el.removeClass("hidden"),ymaps.ready(function(){var e=$("#object_coordinates").val(),n=$("#city_id").data("lat"),r=$("#city_id").data("lon"),i=[n,r],s=10,o=null;n||(i=[57.140738,65.573836],s=7),e?(e=e.split(","),o=13):(e=i,o=s),t.map=new ymaps.Map("map_block",{center:e,zoom:o,controls:["smallMapDefaultSet"]}),t.placemark=app.map.createPlacemark(e,{style:_.extend(app.map.getIconSettings("house"),{draggable:!0})}),t.map.geoObjects.add(t.placemark),t.placemark.events.add("dragend",function(e){$("#object_coordinates").val(t.placemark.geometry.getCoordinates())}),t.map.events.add("click",function(e){placemark.geometry.setCoordinates(e.get("coordPosition")),$("#object_coordinates").val(t.placemark.geometry.getCoordinates())}),t.mapcontrol=new mapcontrolView({app:t.app,city:t.city,address_field:t.address_field,map:t.map,placemark:t.placemark})})},off:function(){this.$el.addClass("hidden"),this.map&&this.map.destroy(),this.map=null}}),mapcontrolView=Backbone.View.extend({events:{keyup:"keyup",focusout:"keyup",paste:"keyup"},precisions:{other:1,street:2,exact:3},initialize:function(e){_.extend(this,e),this.$el=$("#"+this.address_field),this.keyup()},keyup:function(){var e=this,t=null;this.app.real_city_exists&&this.app.real_city?t=this.app.real_city:e.city.value&&(t=e.city.title),t?(e.search=t+", "+this.$el.val(),window.clearTimeout(e.timeout),e.timeout=setTimeout(function(){e.kladr_autocomplete(),e.geoCoder()},500)):this.setMessage("Город не определен. Поле 'Город'  обязательно для заполнения","red")},setMessage:function(e,t){var n=$("#div_"+this.address_field).find(".inform");e?(n.html(e),n.css("color",t),t=="red"?$("#div_"+this.address_field).find(".inp-cont").addClass("error"):$("#div_"+this.address_field).find(".inp-cont").removeClass("error")):(n.html("Например: ул. Мельникайте, д. 44, корп. 2"),$("#div_"+this.address_field).find(".inp-cont").removeClass("error"))},geoCoder:function(){var e=this,t=14,n=ymaps.geocode(e.search,{results:1,json:!0});n.then(function(n){if(n.GeoObjectCollection.featureMember.length==0)$("#object_coordinates").val(""),e.setMessage("Адрес не найден, видимо он не существует.","red");else{e.setMessage();var r=n.GeoObjectCollection.featureMember[0].GeoObject,i=r.Point.pos.split(" ");e.placemark.geometry.setCoordinates([Number(i[1]),Number(i[0])]),e.map.setCenter([Number(i[1]),Number(i[0])],t),$("#object_coordinates").val(e.placemark.geometry.getCoordinates());var s=e.precisions[r.metaDataProperty.GeocoderMetaData.precision];e.app.address_precision&&e.precisions[e.app.address_precision]<=s&&e.app.precision_error?e.setMessage("Адрес введен верно. "+e.app.precision_error,"gray"):e.app.precision_error&&e.setMessage("Адрес не найден. "+e.app.precision_error,"red")}},function(t){e.setMessage("Адрес не найден, видимо он не существует","red")})},kladr_autocomplete:function(){}}),subjectView=Backbone.View.extend({template:templates.subject,tagName:"div",initialize:function(e){_.extend(this,e),this.bind("destroy",this.destroy),this.control=this.$el.find("input"),this.maxlength=this.app.settings.subject_max_length?this.app.settings.subject_max_length:75,this.inform=this.$el.find(".inform"),this.value=this.control.val(),this.error=this.inform.html(),(!this.title_auto&&!this.app.is_edit||!this.title_auto&&this.app.is_edit)&&this.render()},render:function(){var e=_.template(this.template)({value:this.value,error:this.error,maxlength:this.maxlength});return this.$el.html(e),this},destroy:function(){return this.$el.empty(),this.stopListening(),this}}),textView=Backbone.View.extend({template:templates.textadv,tagName:"div",initialize:function(e){_.extend(this,e),this.bind("destroy",this.destroy),this.control=this.$el.find("textarea"),this.value=this.control.val(),this.control.length||this.render();var t=app.settings.staticPath;(new nicEditor({iconsPath:t+"images/nicEditorIcons.gif"})).panelInstance("user_text_adv")},render:function(){var e=_.template(this.template)({value:this.value,text_required:this.text_required});return this.$el.html(e),this},destroy:function(){return this.$el.empty().off(),this.stopListening(),this}}),photoView=Backbone.View.extend({tagName:"div",className:"img-b",template:templates.photo,events:{"click .fn-remove":"remove","click .img":"setActive"},initialize:function(e){_.extend(this,e),this.render()},render:function(){var e=_.template(this.template)(this.model.toJSON());return this.container.append(this.$el.html(e)),this},remove:function(){this.collection.remove(this.model)},setActive:function(){this.model.set("active",!0)}}),photoControlView=Backbone.View.extend({el:"#div_photo",photos:[],maxLength:10,hints:{main:"Главным по умолчанию является первое фото, щелкните по любому фото, чтобы сделать его главным<br>До 10 фотографий с расширениями jpg, png, gif, не более 5мб",requires:"До 10 фотографий с расширениями jpg, png, gif, не более 5мб. Фото можно перетащить в эту зону мышкой."},initialize:function(e){var t=this;_.extend(this,e),this._init_ajax_upload(),this.collection=new photoList,this.collection.comparator=function(e){return e.get("id")},this.collection.on("add",this.addItem,this),this.collection.on("remove",this.removeItem,this),this.collection.on("change:active",this.changeActive,this),_.each(this.$el.find(".img-b"),function(e){var n={id:$(e).attr("id"),filename:$(e).find("input").val(),filepath:$(e).find("img").attr("src"),active:$(e).find(".img").hasClass("active")};t.collection.add(n)}),this.renderHint()},renderHint:function(){this.collection.length?$(".fn-photo-hint").html(this.hints.main):$(".fn-photo-hint").html(this.hints.requires)},_init_ajax_upload:function(){var e=this;$("#fileupload").fileupload({uidropzone:$(".fn-photo-list"),acceptFileTypes:/(\.|\/)(gif|jpe?g|png)$/i,maxFileSize:6e3,autoUpload:!1,dataType:"json",success:function(t,n){if(e.collection.length>=e.maxLength){e.setError("Можно загрузить не более 10 фотографий");return}if(t.filename){var r=!1;e.collection.length==0&&($("#active_userfile").val(n.filename),r=!0),e.collection.add({filename:t.filename,filepath:t.filepaths["120x90"],active:r}),e.setError("")}else t.error?(e.renderHint(),e.setError(t.error)):e.setError("Произошла непредвиденная ошибка")}}).on("fileuploadadd",function(t,n){var r=n.submit();e.collection.length>=e.maxLength&&(e.setError("Можно загрузить не более 10 фотографий"),r.abort()),this.jqXHR=r}).on("fileuploaddone",function(t,n){e.collection.length>=e.maxLength&&(e.setError("Можно загрузить не более 10 фотографий"),this.jqXHR?this.jqXHR.abort():(this.jqXHR.errorThrown="Можно загрузить не более 10 фотографий",this._trigger("fail",t,n)))}).on("fileuploadfail",function(t,n){e.renderHint()}).on("fileuploadprogressall",function(e,t){var n=parseInt(t.loaded/t.total*100,10);n==100?$(".fn-photo-hint").html("Файл загружен. Идет сохранение..."):$(".fn-photo-hint").html("Идет загрузка... "+n+"%")})},addItem:function(e){var t=this.$el.find(".fn-photo-list"),n=undefined;e.get("id")&&(n=$("#"+e.get("id"))),this.photos[e.cid]=new photoView({el:n,model:e,collection:this.collection,container:t}),this.collection.length>0&&$(".fn-photo-hint").text(),this.renderHint()},removeItem:function(e){this.photos[e.cid].unbind(),this.photos[e.cid].$el.remove(),this.collection.length&&e.get("active")&&this.collection.at(0).set("active",!0),this.setError(""),this.renderHint()},changeActive:function(e){var t=this.photos[e.cid].$el.find(".img");e.get("active")?(t.addClass("active"),this.collection.each(function(t){t.cid!=e.cid&&t.set("active",!1)}),$("#active_userfile").val(e.get("filename"))):t.removeClass("active")},onSubmit:function(e,t){var n=this._settings.data.context;n.setError("")},onComplete:function(e,t){var n=this._settings.data.context;t&&(t=$.parseJSON(t));if(t===null||!t.filename){n.setError("Произошла непредвиденная ошибка");return}if(t.error){n.setError(t.error);return}var r=!1;n.collection.length==0&&($("#active_userfile").val(t.filename),r=!0),n.collection.add({filename:t.filename,filepath:t.filepaths["120x90"],active:r})},setError:function(e){$("#error_userfile1").html(e)}}),categoryView=Backbone.View.extend({el:"#div_category",events:{"change select":"change"},initialize:function(e){_.extend(this,e),this.control=this.$el.find("select"),this.control.length||(this.control=this.$el.find("#fn-category")),this._init_data(),this._init_description(),this._init_price()},_init_data:function(){this.settings={},this.category_id=this.control.val(),this.category_id&&this.category_id!=0&&(this.data=data[this.category_id],this.data&&_.extend(this.settings,this.data[0])),this.app.descriptions=data.descriptions},change:function(e){this.value=$(e.target).val(),this._init_data(),this.app.initialize({reinit_after_change:!0});var t="div_category";this.value?(this.app.removeError(t),this.app.removeRequired(t)):this.app.addRequired(t),this._init_description(),this._init_price()},_init_description:function(){this.app.descriptions&&new categoryDescriptionView({text:this.app.descriptions[this.settings.description]})},_init_price:function(){$("#div_price").hide(),this.settings.price_enabled&&$("#div_price").show()}}),categoryDescriptionView=Backbone.View.extend({el:"#div_category_description",className:"row mb10",template:templates.description,initialize:function(e){_.extend(this,e),this.render()},render:function(){if(this.text){var e=_.template(this.template)({text:this.text});this.$el.html(e)}else this.$el.html("")}}),additionalView=Backbone.View.extend({el:"#div_additional",initialize:function(e){var t=this;_.extend(this,e),this.app.org_type||(this.app.org_type=1),this.additional_fields=this.additional_fields||[],this.additional_fields=this.additional_fields[this.app.org_type],this.render()},render:function(){var e=this;this.$el.find(".fn-additional").each(function(t,n){_.indexOf(e.additional_fields,$(n).attr("id"))>=0?$(n).show():$(n).hide()})}}),verifyWindowView=Backbone.View.extend({tagName:"div",className:"popup enter-popup fn-verify-contact-win",template:templates.verifyContactWindow,events:{"click .fn-verify-contact-win-close":"close","click .fn-verify-contact-win-submit":"doVerifyCode"},initialize:function(e){_.extend(this,e),this.render(),this.model.get("type")=="1"||this.model.get("type")=="5"?this.sendSms():this.showVerificationCode()},render:function(){var e=_.template(this.template)(this.model.toJSON());return $("body").append(this.$el.html(e)),$("body").find(".popup-layer").fadeIn(),this.$el.fadeIn(),this},close:function(){this.unbind(),this.remove(),$("body").find(".popup-layer").fadeOut()},doVerifyCode:function(){this.model.get("type")=="1"||this.model.get("type")=="5"?this.checkCode():this.checkHomePhoneCode()},sendSms:function(e){var t=this,n={contact_type_id:this.model.get("type"),force:e};this.model.get("type")=="5"?n.email=this.model.get("value"):n.phone=this.model.get("value"),$.post("/ajax/sent_verification_code",n,function(e){t.responseSms(e,t)},"json")},responseSms:function(e,t){var n=t;n.contact_id=e.contact_id;switch(+e.code){case 200:n.setError("Сообщение с кодом отправлено");break;case 303:n.setError("Сообщение с кодом уже отправлено вам ранее");break;case 301:n.model.set("status","verified"),n.close();break;case 302:n.setError(e.msg);break;case 304:n.setError("Вы исчерпали лимит SMS на сегодня");break;case 305:n.setError("Контакт в черном списке");break;case 401:n.setError('Это не мобильный телефон, выберите "городской"')}},checkCode:function(){var e=this,t=this.$el.find(".fn-input-code").val();if(!e.contact_id)return;$.post("/ajax/check_contact_code/"+e.contact_id,{code:t},function(t){t.code==200?(e.model.set("status","verified"),e.close()):e.setError("Неправильный код")},"json")},checkHomePhoneCode:function(){var e=this,t=this.$el.find(".fn-input-code").val();t==this.verificationCode?$.post("/ajax/verify_home_phone",{contact:e.model.get("value")},function(t){t.code==200?(e.model.set("status","verified"),e.close()):e.setError(t.msg)},"json"):e.setError("Неправильный код")},showVerificationCode:function(){this.verificationCode=this.generateVerificationCode(),this.setError("Этот номер телефона пройдет проверку. Подтвердите что вы согласны, введите код:"+this.verificationCode)},generateVerificationCode:function(){var e=_.random(1e3,9999);return e},setError:function(e){this.$el.find(".fn-error-block").html(e)}}),contactModel=Backbone.Model.extend({defaults:{type:1,value:"",status:"clear"}}),contactList=Backbone.Collection.extend({model:contactModel}),contactView=Marionette.ItemView.extend({tagName:"div",className:"contact-cont fn-contact",template:templates.contact,ui:{"delete":".fn-contact-delete-button",verify:".fn-contact-verify-button",type:".fn-contact-type",value:".fn-contact-value"},events:{"click @ui.delete":"remove","click @ui.verify":"doVerify","change @ui.type":"changeType"},initialize:function(e){_.extend(this,e)},_init_inputs:function(){this.contact=this.$el.find(".fn-contact-value"),this.type=this.$el.find(".fn-contact-type"),this.format=this.type.find("option:selected").data("format"),this.validation_type=this.type.find("option:selected").data("validation-type"),this.setValues()},_init_mask:function(){var e=this;this.model.get("type")!=5?$(this.contact).mask(this.format,{completed:function(){e.model.set("status","valided"),e.setValues()}}):$(this.contact).unbind()},setValues:function(){this.model.set("value",this.contact.val()),this.model.set("type",this.type.val())},onRender:function(){this._init_inputs(),this._init_mask()},remove:function(){console.log(this.model),this.model.collection.remove(this.model)},changeType:function(){this._init_inputs(),this._init_mask()},doVerify:function(){this.setValues(),this.window=new verifyWindowView({model:this.model})},changeStatus:function(){this.$el.removeClass("verified"),this.$el.removeClass("noverified"),this.$el.find(".fn-contact-inform").html(""),this.model.get("status")!="clear"&&this.model.get("status")!="valided"&&(this.model.get("status")=="verified"?(this.$el.addClass("verified"),this.$el.find(".fn-contact-inform").html("Контакт подтвержден")):this.model.get("status")=="noverified"&&this.$el.addClass("noverified"))}}),contactListView=Marionette.CollectionView.extend({el:"#div_contacts",contacts:[],childView:contactView,buildChildView:function(e,t,n){var r=_.extend({model:e},n);$("#contact_"+e.id).length&&(r.$el=$("#contact_"+e.id));var i=new t(r);return i},ui:{addContact:".fn-add-contact-button-text",contacts:".contact-cont"},events:{"click @ui.addContact":"addContact"},initialize:function(e){_.extend(this,e);var t=this;this.bindUIElements(),this.collection=new contactList,this.collection.on("change:status",this.changeStatus,this),_.each(this.ui.contacts,function(e){var n="clear",r=$(e);r.hasClass("verified")?n="verified":r.hasClass("noverified")&&(n="noverified");var i={id:r.data("item-id"),value:r.find(".fn-contact-value").val(),type:r.find(".fn-contact-type").val(),status:n};t.collection.add(i)})},addContact:function(){this.collection.add({id:this.collection.length+1})},changeStatus:function(e){this.contacts[e.cid].changeStatus()}});return Marionette.ItemView.extend({form_id:"element_list",events:{"click #submit_button":"submitForm"},behaviors:{ContactsBehavior:{behaviorClass:ContactsBehavior}},initialize:function(options){_.extend(this,options);var self=this;self.is_edit=$("#object_id").val(),this.settings=$("#moderate").text()?eval($("#moderate").text()):{},this.reinit_after_change&&this._destroy_controls(),self._init_controls()},_init_controls:function(){this.reinit_after_change||(this.category=new categoryView({app:this}),this.city=new cityView({category_id:this.category.category_id,app:this}),this.photo=new photoControlView({app:this})),this.address_precision=null,this.precision_error=null,this.cmap=new mapView({category_id:this.category.category_id,app:this}),this.params=new paramsView({category_id:this.category.category_id,data:this.category.data,address_precisions:this.category.settings.address_precisions,app:this}),this.subject=new subjectView({el:"#div_subject",category_id:this.category.category_id,title_auto:this.category.settings.title_auto,app:this}),this.text=new textView({el:"#div_textadv",category_id:this.category.category_id,text_required:this.category.settings.text_required,app:this}),this.additional=new additionalView({el:"#div_additional",category_id:this.category.category_id,app:this,additional_fields:this.category.settings.additional_fields})},_destroy_controls:function(){this.params.trigger("destroy"),this.subject.trigger("destroy"),this.text.trigger("destroy"),this.cmap.trigger("disable")},_init_map:function(e){this.cmap&&this.cmap.trigger("enable",{city:this.city,address_field:e})},removeError:function(e){var t=$("#"+e);t.find(".fn-error").remove(),t.find(".inp-cont").removeClass("error")},removeRequired:function(e){var t=$("#"+e);t.find(".required-label").html("")},addRequired:function(e){var t=$("#"+e);t.find(".required-label").html("*")},submitForm:_.once(function(){this.text&&nicEditors.findEditor("user_text_adv").saveContent(),$("#"+this.form_id).submit()})})}),define("views/partials/article",["templates","views/partials/behaviors/favourite","views/partials/behaviors/ads","views/partials/behaviors/ocontrol","views/partials/behaviors/services","gisMap"],function(e,t,n,r,i){return Marionette.LayoutView.extend({ui:{map:"#map"},behaviors:{FavouriteBehavior:{behaviorClass:t},AdsBehavior:{behaviorClass:n},OControlBehavior:{behaviorClass:r},ServicesBehavior:{behaviorClass:i}},initialize:function(){this.bindUIElements();if(this.ui.map.length){var t=+this.ui.map.data("lat"),n=+this.ui.map.data("lon"),r=e.components.detail.baloon;app.map.get2GisMap({elid:"map",lat:t,lon:n,zoom:15},function(e){DG.marker([t,n]).addTo(e).bindPopup("Расположение объекта")})}}})}),define("modules/filters",["marionette","backbone","templates"],function(e,t,n){var r=t.Model.extend({defaults:{value:undefined},unselect:function(){this.set("select",!1),this.removeChilds()},select:function(e){_.isArray(e)?e=_.map(e,function(e){return"_"+e}):e="_"+e,this.set("select",e),this.addChilds()},addChilds:function(){var e=this,t=this.get("select");if(!t)return;_.isArray(t)||(t=[t]);var n=this.collection.indexOf(this)+1;_.each(t,function(t){var r="childs"+t;e.set(r,[]),e.get(t)&&_.isObject(e.get(t))&&_.each(e.get(t),function(t,i){if(i==0)return;if(t[0].options!="subelements"&&e.collection.findWhere({seo_name:t[0].seo_name}))return;e.get(r).push(t[0].ref_id),e.collection.add(t,{at:n}),n++})})},removeChilds:function(){var e=_.keys(this.get("values"));this.removeFromList(e)},removeChildsMult:function(){var e=_.keys(this.get("values")),t=this.get("select");_.isArray(t)||(t=[t]);var n=_.difference(e,t);this.removeFromList(n)},removeFromList:function(e,t){var n=this;_.each(e,function(e){var t="childs"+e;n.get(t)&&_.each(n.get(t),function(e){var t=n.collection.findWhere({ref_id:e});t&&(t.removeChilds(),n.collection.remove(t))})})}}),i=t.Collection.extend({model:r,comparator:function(e){return e.get("weight")}}),s=e.ItemView.extend({templateHelpers:function(){var e=this;return{clearValue:function(e){return e?+e.replace("_",""):0},checked:function(t){var n="",r=e.model.get("value");return t=+t.replace("_",""),r&&_.isArray(r)?n=_.contains(r,t)?"checked":"":r&&(n=r==t?"checked":""),n}}},showHide:function(e){e.preventDefault(),this.ui.valuesCont.toggle(),this.ui.valuesCont.parent().parent().siblings().find(".js-filter-values-cont").hide()},initialize:function(e){_.extend(this.options.attibute={},this.model.get(0)),delete this.model.attributes[0];var t=this;this.options.values={},_.each(this.model.attributes,function(e,n){if(n.indexOf("_")>=0||t.options.attibute["type"]=="ilist")t.options.values[n]=_.isObject(e)?e[0].title:e}),this.model.set(this.options.attibute),this.model.set({values:this.options.values}),this.model.on("change:str_value",function(){t.changeValue(),this.collection.trigger("checkCount")});var n=this.getOption("queryParams")[this.model.get("seo_name")];n&&this.model.set("value",n)},onShow:function(){this.setValue?this.setValue():""},changeValue:function(){this.model.get("str_value")?this.ui.strValue.text(this.model.get("str_value")):this.ui.strValue.text("Не важно")}}),o=s.extend({template:n.filters.textFilterItem,ui:{valuesCont:".js-filter-values-cont",strValue:".js-filter-str-value",input:"input"},events:{"click .js-filter-label, .js-filter-ok":"showHide","keyup @ui.input":"inputKeyUp"},initialize:function(e){this.bindUIElements(),s.prototype.initialize.call(this,e)},inputKeyUp:function(){var e=this.ui.input.val();e?this.model.set("str_value",e.substr(0,10)+"..."):this.model.set("str_value",!1)},setValue:function(){var e=this.model.get("value");this.ui.input.trigger("keyup")}}),u=s.extend({template:n.filters.numericFilterItem,ui:{valuesCont:".js-filter-values-cont",strValue:".js-filter-str-value",firstInput:"input.first",lastInput:"input.last"},events:{"click .js-filter-label, .js-filter-ok":"showHide","keyup @ui.firstInput":"inputKeyUp","keyup @ui.lastInput":"inputKeyUp"},initialize:function(e){this.bindUIElements(),s.prototype.initialize.call(this,e)},inputKeyUp:function(){var e=parseInt(this.ui.firstInput.val()),t=parseInt(this.ui.lastInput.val());e>0||t>0?this.model.set("str_value","от "+(e?e:"неогр.")+" до "+(t?t:"неогр.")):this.model.set("str_value",!1)},setValue:function(){var e=this.model.get("value");_.isObject(e)||this.model.set("value",{}),_.each(this.ui.valuesCont.find("input"),function(e){$(e).trigger("keyup")})}}),a=s.extend({template:n.filters.ilistFilterItem,ui:{valuesCont:".js-filter-values-cont",strValue:".js-filter-str-value",select:"select"},events:{"click .js-filter-label, .js-filter-ok":"showHide","change @ui.select":"selectChange"},initialize:function(e){this.bindUIElements(),s.prototype.initialize.call(this,e)},selectChange:function(){var e=parseInt(this.ui.select.first().val()),t=parseInt(this.ui.select.last().val());e>0||t>0?this.model.set("str_value","от "+(e?e:"неогр.")+" до "+(t?t:"неогр.")):this.model.set("str_value",!1)},setValue:function(){var e=this.model.get("value");_.isObject(e)||this.model.set("value",{}),_.each(this.ui.valuesCont.find("select"),function(e){$(e).trigger("change")})}}),f=s.extend({template:n.filters.listFilterItem,ui:{select:"select",option:"option"},events:{"change @ui.select":"changeSelect"},initialize:function(e){s.prototype.initialize.call(this,e)},changeSelect:function(e){e.preventDefault();var t=this.ui.select.val(),n=this.ui.select.find("this.ui.select").text();this.model.set("str_value",n),this.model.unselect(),this.model.select(t)}}),l=f.extend({template:n.filters.listBoxFilterItem,ui:{valuesCont:".js-filter-values-cont",input:"input",strValue:".js-filter-str-value",anyInput:".js-filter-anyinput"},events:{"click .js-filter-label, .js-filter-ok":"showHide","change input:not(.js-filter-anyinput)":"changeInput","change @ui.anyInput":"changeAnyInput"},initialize:function(e){var t=this;console.log(this.model.toJSON()),this.bindUIElements(),f.prototype.initialize.call(this,e)},changeInput:function(e){e.preventDefault();var t=[],n={},r;_.each(this.ui.valuesCont.find("input:checked"),function(e){if($(e).val()=="on")return;t.push($(e).val()),r=$(e).data("str")}),this.model.unselect(),this.model.select(t),t.length>1?this.model.set("str_value","Выбрано: "+t.length):this.model.set("str_value",r),t&&t.length>0?(this.ui.anyInput.removeAttr("disabled"),this.ui.anyInput.removeAttr("checked")):(this.ui.anyInput.prop("disabled",!0),this.ui.anyInput.prop("checked",!0))},setValue:function(){var e=this.model.get("value");e=_.isArray(e)?e:e?[e]:!1,this.model.set("value",e),_.each(this.ui.valuesCont.find("input:checked"),function(e){if($(e).val()=="on")return;$(e).trigger("change")})},changeAnyInput:function(e){e.preventDefault(),_.each(this.ui.valuesCont.find("input:checked"),function(e){$(e).prop("checked",!1),$(e).trigger("change")})}}),c=e.CollectionView.extend({getChildView:function(e){var t=e.get(0);t||(t=e.toJSON());if(_.contains(["list"],t.type))return l;if(_.contains(["ilist"],t.type))return a;if(_.contains(["integer","numeric"],t.type))return u;if(_.contains(["text"],t.type))return o},childViewOptions:function(){var e=this;return{queryParams:e.getOption("queryParams")}}}),h=t.Model.extend({url:"/ajax_search/filters_submit"}),p=t.Model.extend({url:"/ajax_search/filters_check"}),d=e.LayoutView.extend({ui:{form:".js-filters-form",submit:".js-filters-submit",staticFilters:".js-filters-static input"},regions:{filters:".js-filters-cont"},events:{"click @ui.submit":"submitClick"},initialize:function(e){this.bindUIElements(),this.initStaticFilters(),this.initVariableFilters()},initStaticFilters:function(){var e=this.getOption("queryParams");_.each(this.ui.staticFilters,function(t){e[$(t).attr("name")]&&$(t).prop("checked",!0)})},initVariableFilters:function(){var e=this,t=this.getOption("data"),n=new i,r=0;_.each(t,function(e){n.add(e,{at:r}),r+=10}),this.filters.show(new c({collection:n,queryParams:this.getOption("queryParams")})),$(document).mouseup(function(e){var t=$(".js-filters-cont");t.has(e.target).length===0&&t.find(".js-filter-values-cont").hide()}),this.filtersList=n,this.filtersList.on("checkCount",function(t){e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){var t=new p,n=e.getFormValues(),r=e.getQueryString(n);t.save({queryString:r,category_id:app.settings.category_id,city_id:app.settings.city_id},{success:function(t,n){var r=t.get("count");r?e.ui.submit.text("Найдено: "+r+". Показать!").removeClass("bg-color-crimson").addClass("bg-color-blue"):e.ui.submit.text("Не найдено").addClass("bg-color-crimson").removeClass("bg-color-blue")}})},1500)})},submitClick:function(e){e.preventDefault();var t=this,n=this.getFormValues(),r=this.getQueryString(n),i=new h;i.save({queryString:r,category_id:app.settings.category_id,city_id:app.settings.city_id},{success:function(e,n){var r=e.toJSON(),i=t.ui.form.attr("action")?"/"+t.ui.form.attr("action"):"",s=r.seo_segment_url?"/"+r.seo_segment_url:"",o=r.query?"?"+r.query:"";$(window).attr("location",i+s+o)}})},getFormValues:function(){var e=this,t={};return this.ui.form.serializeArray().map(function(e){t[e.name]=e.value}),_.each(t,function(e,n){(!e||e=="0")&&delete t[n]}),t},getQueryString:function(e){var t=[];return _.each(e,function(e,n){t.push(n+"="+e)}),t.join("&")}});return e.Module.extend({initialize:function(){this.data=app.settings.data,this.queryParams=app.settings.query_params},initFilters:function(e){var t=this.data[e];_.isObject(t)?delete t[0]:t=null;var n=new d({el:".js-filters",data:t,queryParams:this.queryParams});_.isEmpty(this.queryParams)||$(".js-filters").show(),this.filtersLoaded()},filtersLoaded:function(){$(".js-search-extend i").remove(),$(".js-search-extend").click(function(e){e.preventDefault(),$(".js-filters").toggle()})}})}),define("modules/map",["marionette","ymap"],function(e){var t={house:{iconLayout:"default#image",iconImageHref:"/static/develop/images/house.png",iconImageSize:[27,39],iconImageOffset:[-13.5,-39],zIndex:10},defBlue:{preset:"islands#icon",iconColor:"#2D5169"},defRed:{preset:"islands#icon",iconColor:"#D30000",zIndex:1},defTwitter:{preset:"islands#circleDotIcon",iconColor:"#1faee9",zIndex:0},defTwitterActive:{preset:"islands#circleDotIcon",iconColor:"#D30000",zIndex:2}};return e.Module.extend({initialize:function(){ymaps.ready(function(){console.log("ymap ready")})},getIconSettings:function(e){return e=="house"&&(t[e]=app.settings.staticPath+"images/house.png"),t[e]},get2GisMap:function(e,t){var n,r=e.elid,i=e.lat||55.76,s=e.lon||37.64,o=e.zoom||10,u=e.settings||{};DG.then(function(){var e=DG.map(r,{center:[i,s],zoom:o});t(e)})},getMap:function(e,t){var n,r=e.elid,i=e.lat||55.76,s=e.lon||37.64,o=e.zoom||10,u=e.settings||{};ymaps.ready(function(){var e=new ymaps.Map(r,_.extend({center:[i,s],zoom:o,controls:["smallMapDefaultSet"]},u));t(e)})},destroyMap:function(e){e.destroy(),e=null},setCenter:function(e,t,n){e.setCenter([t,n])},createPlacemark:function(e,t){return t=t||{},new ymaps.Placemark(e,t.content,t.style)},setOptimalBounds:function(e){e.setBounds(e.getBounds(),{checkZoomRange:!0})},getUserLocation:function(e){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){var n={lat:t.coords.latitude,lon:t.coords.longitude};e(n)})},geocode:function(e,t){t.error=t.error||function(){};var n=ymaps.geocode(e,{results:1}).then(function(e){t.success(e.geoObjects.get(0))},function(e){t.error()})}})}),define("controllers/index",["marionette","templates","base/utils","views/partials/index","views/partials/search","views/partials/detail","views/partials/userSearch","views/partials/cart","views/partials/add","views/partials/article","modules/filters","modules/map"],function(e,t,n,r,i,s,o,u,a,f,l,c){return e.Controller.extend({before:function(){},start_indexSection:function(){console.log("index start"),app.menu.init(["main","city","kupon","news"]),new r({el:"body"})},start_detailSection:function(){console.log("detail start","kupon","news"),app.menu.init(["main","kupon","news"]),app.module("map",c),new s({el:"body"})},start_searchSection:function(){console.log("search start"),app.module("filters",l),app.module("map",c),app.filters.initFilters(app.settings.category_id),app.menu.init(["main","city","kupon","news"]),app.favourite.init(["list"]),new i({el:"body"})},start_usersearchSection:function(){console.log("usersearch start"),app.menu.init(["main","kupon","news"]),app.favourite.init(["list"]),new o({el:"body"})},start_cartSection:function(){console.log("cart start"),app.menu.init(["main","kupon","news"]),app.favourite.init(["list"]),new u({el:"body"})},start_addSection:function(){console.log("Add start"),app.module("map",c),app.menu.init(["main","kupon","news"]),new a({el:"body"})},start_userSection:function(){console.log("user start"),app.menu.init(["main","kupon","news"])},start_articleSection:function(){console.log("article start"),app.menu.init(["main","kupon","news"]),app.module("map",c),new f({el:"body"})},notFound:function(){}})}),define("routers/index",["marionette","base/routers/index","controllers/index"],function(e,t,n){return t.extend({routes:{"*found":"startSection"},onRoute:function(e,n,r){t.prototype.onRoute.call(this,e,n,r),console.log("index route fired: "+e,n,r)},getSectionController:function(){return new n},startSection:function(e){var t=this.getSectionController();t["start_"+app.settings.page+"Section"]&&t["start_"+app.settings.page+"Section"](e)},notFound:function(){console.log(this)}})}),define("views/components/windows/service",["backbone","marionette","templates","jcookie"],function(e,t,n){var r=e.Model.extend({urlRoot:"/rest_service/save"});return t.LayoutView.extend({template:n.components.windows.service,className:"popup-wrp z400",errors:{},ui:{close:".js-close",tocontinue:".js-tocontinue",tocart:".js-tocart",took:".js-ok",form:".js-form"},events:{"click @ui.tocontinue":"save","click @ui.took":"save","click @ui.tocart":"saveAndRedirect","click @ui.close":"close"},regions:{service:".js-service-cont"},close:function(){app.windows.vent.trigger("closeWindow","service")},templateHelpers:function(){var e=this;return{getTitle:function(){return e.options.title}}},initialize:function(e){e.is_edit&&(this.template=n.components.windows.editService),this.model=new r({title:e.title,code:e.code,is_edit:e.is_edit,edit_params:e.edit_params,parentView:this.$el})},onRender:function(){this.service.show(this.getOption("serviceView"))},saveAndRedirect:function(e){e.preventDefault();var t=this;t.save(e,!0)},save:function(e,t){e.preventDefault();var n=this,i=this.service.currentView;if(i.resultValid&&!i.resultValid())return;var s=new r,o=i.model.toJSON();this.getOption("is_edit")&&(o.temp_order_item_id=this.getOption("is_edit")),s.save({serviceData:o},{success:function(e){var r=e.toJSON();r.code==200?(app.services.updateCart(),app.windows.vent.trigger("closeWindow","service"),n.getOption("success")(e),t&&$(window).attr("location","/cart")):(n.getOption("error")("Ошибка при сохранении услуги"),console.log("Ошибка при сохранении услуги"))},error:function(e){n.getOption("error")("Ошибка при сохранении услуги"),console.log("Ошибка при сохранении услуги")}})}})}),define("base/validation",["jquery","underscore"],function(e,t){var n={validationMessages:{require:function(e){return"Обязательно для заполнения"},requireint:function(e){return"Обязательно для заполнения"},minlen:function(e,t){return"Минимум "+t+" символов"}},validationMethods:{require:function(t){return e.trim(t)!=undefined&&e.trim(t)!=0},requireint:function(e){return+e},minlen:function(e,t){return e.length>=t}},isValid:function(e,r,i){var s,o,u=[];return t.each(e,function(e){s=e.split("_"),o=n.validationMethods[s[0]].apply(this,[i,s[1]]),o||u.push(n.validationMessages[s[0]].apply(this,[r,s[1]]))}),u.length?{name:r,text:u.join(", ")}:!1}};return n}),define("views/components/windows/backcall",["backbone","marionette","templates","base/validation"],function(e,t,n,r){var i=e.Model.extend({urlRoot:"/rest_object/backcall",settings:{name:["require"],phone:["require"],comment:[]},defaults:{name:null,phone:null,comment:null},validate:function(e,t){var n=this,i,s=[];return _.each(_.keys(e),function(t){i=r.isValid(n.settings[t],t,e[t]),i&&s.push(i)}),s.length?s:!1}});return t.ItemView.extend({template:n.components.windows.backcall,className:"popup-wrp z400",errors:{},ui:{close:".js-close",took:".js-ok",form:".js-form"},events:{"click @ui.took":"save","click @ui.close":"close"},close:function(){app.windows.vent.trigger("closeWindow","backcall")},templateHelpers:function(){var e=this;return{getError:function(t){return _.has(e.errors,t)&&e.errors[t]?e.errors[t]:!1}}},initialize:function(e){this.model=new i({object_id:e.object_id,key:e.key})},save:function(e){e.preventDefault();var t=this,n={};this.ui.form.serializeArray().map(function(e){n[e.name]=e.value}),this.model.set(n),this.model.isValid()?this.model.save({},{success:function(e){var n=e.toJSON();n.code==200?(t.close(),app.windows.vent.trigger("showWindow","message",{title:"Обратный звонок",text:"Спасибо! Специалист свяжется с Вами в ближайшее время"})):(t.errors.common="Ошибка при сохранении",t.render())},error:function(e){t.errors.common="Ошибка при сохранении",t.render()}}):(t.errors={},_.each(this.model.validationError,function(e,n){t.errors[e.name]=e.text}),this.render())}})}),define("views/components/windows/message",["marionette","templates"],function(e,t){return e.ItemView.extend({template:t.components.windows.message,className:"popup-wrp z400",errors:{},ui:{ok:".js-ok"},events:{"click @ui.ok":"ok"},templateHelpers:{getTitle:function(){return this.context.getOption("title")},getText:function(){return this.context.getOption("text")},getDisableOk:function(){return this.context.getOption("disableOk")}},initialize:function(e){this.bindUIElements()},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.context=this,e},onDestroy:function(){this.getOption("success")&&this.getOption("success")()},ok:function(e){e.preventDefault(),app.windows.vent.trigger("closeWindow","message")}})}),define("views/components/windows/object_callback",["backbone","marionette","templates","base/validation"],function(e,t,n,r){var i=e.Model.extend({urlRoot:"/rest_object/callback"});return t.ItemView.extend({template:n.components.windows.object_callback,className:"popup-wrp z400",errors:{},ui:{close:".js-close",took:".js-ok",form:".js-form"},events:{"click @ui.took":"save","click @ui.close":"close"},close:function(){app.windows.vent.trigger("closeWindow","object_callback")},initialize:function(e){this.model=new i({ids:e.ids?e.ids:[e.id]})},save:function(e){e.preventDefault();var t=this,n={};this.ui.form.serializeArray().map(function(e){n[e.name]=e.value});if(!n.reason)return;this.model.set(n),this.model.save({},{success:function(e){var n=e.toJSON();n.code==200?(t.close(),app.windows.vent.trigger("showWindow","message",{title:"Снятие объявлений",text:"Спасибо! За то что воспользовались нашими услугами"})):(t.errors.common="Ошибка при сохранении",t.render())},error:function(e){t.errors.common="Ошибка при сохранении",t.render()}})}})}),define("modules/windows",["marionette","templates","views/components/windows/service","views/components/windows/backcall","views/components/windows/message","views/components/windows/object_callback"],function(e,t,n,r,i,s){var o=e.ItemView.extend({className:"popup-wrp",ui:{close:".s_close",login:".s_enter",register:".s_register"},events:{"click @ui.close":"close","click @ui.login":"toLogin","click @ui.register":"toRegister"},close:function(e){app.windows.vent.trigger("closeWindow",this.getOption("name"))},initialize:function(e){this.template=t.components.windows.error[e.name]},toLogin:function(e){e.preventDefault(),app.windows.vent.trigger("closeWindow",this.getOption("name")),app.auth.showLoginWindow()},toRegister:function(e){e.preventDefault(),app.windows.vent.trigger("closeWindow",this.getOption("name")),app.auth.showRegisterWindow()}});return e.Module.extend({$layer:null,windows:[],windowView:{service:n,backcall:r,message:i,object_callback:s},zIndex:{},label:{},blackLayer:{service:!0,backcall:!0,message:!0,object_callback:!0},transparentLayer:{},initialize:function(e){var t=this;console.log("Windows module initialized"),this.vent=new Backbone.Wreqr.EventAggregator,app.backLayer.on("click",function(){t.vent.trigger("closeWindow")}),this.vent.on("showWindow",function(e,n){var r;t.windows[e]&&app.windows.vent.trigger("closeWindow",e),r=new t.windowView[e](n),$(r.render().el).appendTo("#windows"),t.windows[e]=r;var i=t.label[e];i&&($(i.class).show(),i.expand=!0,$(".overlay").removeClass("w360").addClass("w30").show(),$(i.class).bind("click",function(e){i.expand=!i.expand,i.expand?($(i.winclass).show(),$(i.class).addClass("expanded"),$(".overlay").addClass("w360").removeClass("w30").show()):($(i.winclass).hide(),$(i.class).removeClass("expanded"),$(".overlay").removeClass("w360").addClass("w30").show()),i.depency.length&&_.each(i.depency,function(e){t.label[e].exec?t.label[e].exec(!i.expand):$(t.label[e].class).click()})})),t.zIndex[e]&&$(".overlay").show().addClass(t.zIndex[e]),t.blackLayer[e]&&($("#popup-layer").show(),$("#popup-layer").bind("click",function(){app.windows.vent.trigger("closeWindow",e)})),t.transparentLayer[e]}),this.vent.on("closeWindow",function(e){var n=t.windows[e];if(!n)return;n.destroy(),delete t.windows[e];var r=t.label[e];r&&($(r.class).hide(),r.expand=!1,$(r.class).addClass("expanded"),$(r.class).unbind("click")),t.zIndex[e]&&$(".overlay").hide().removeClass(t.zIndex[e]),t.blackLayer[e]&&($("#popup-layer").hide(),$("#popup-layer").unbind("click")),t.transparentLayer[e]})}})}),function(e){function t(t){var n=e(this),r=null,i=[],s=null,o=null,u=e.extend({rowSelector:"> li",submenuSelector:"*",submenuDirection:"right",tolerance:75,enter:e.noop,exit:e.noop,activate:e.noop,deactivate:e.noop,exitMenu:e.noop},t),a=3,f=300,l=function(e){i.push({x:e.pageX,y:e.pageY}),i.length>a&&i.shift()},c=function(){o&&clearTimeout(o),u.exitMenu(this)&&(r&&u.deactivate(r),r=null)},h=function(){o&&clearTimeout(o),u.enter(this),m(this)},p=function(){u.exit(this)},d=function(){v(this)},v=function(e){if(e==r)return;r&&u.deactivate(r),u.activate(e),r=e},m=function(e){var t=g();t?o=setTimeout(function(){m(e)},t):v(e)},g=function(){function d(e,t){return(t.y-e.y)/(t.x-e.x)}if(!r||!e(r).is(u.submenuSelector))return 0;var t=n.offset(),o={x:t.left,y:t.top-u.tolerance},a={x:t.left+n.outerWidth(),y:o.y},l={x:t.left,y:t.top+n.outerHeight()+u.tolerance},c={x:t.left+n.outerWidth(),y:l.y},h=i[i.length-1],p=i[0];if(!h)return 0;p||(p=h);if(p.x<t.left||p.x>c.x||p.y<t.top||p.y>c.y)return 0;if(s&&h.x==s.x&&h.y==s.y)return 0;var v=a,m=c;u.submenuDirection=="left"?(v=l,m=o):u.submenuDirection=="below"?(v=c,m=l):u.submenuDirection=="above"&&(v=o,m=a);var g=d(h,v),y=d(h,m),b=d(p,v),w=d(p,m);return g<b&&y>w?(s=h,f):(s=null,0)};n.mouseleave(c).find(u.rowSelector).mouseenter(h).mouseleave(p).click(d),e(document).mousemove(l)}e.fn.menuAim=function(e){return this.each(function(){t.call(this,e)}),this}}(jQuery),define("menuAim",function(){}),define("modules/menu",["marionette","menuAim"],function(e){var t={controlClass:".js-mainmenu-dropdown",menuClass:".js-mainmenu",menuTemplate:"#template-mainmenu"},n={controlClass:".js-usermenu-dropdown",menuClass:".js-usermenu",menuTemplate:"#template-usermenu"},r={controlClass:".js-citymenu-dropdown",menuClass:".js-citymenu",menuTemplate:"#template-citymenu"},i={controlClass:".js-newsmenu-dropdown",menuClass:".js-newsmenu",menuTemplate:"#template-newsmenu"},s={controlClass:".js-kuponmenu-dropdown",menuClass:".js-kuponmenu",menuTemplate:"#template-kuponmenu"},o=e.ItemView.extend({events:{mouseover:"showMenu",mouseleave:"closeMenu"},initialize:function(e){this.$el.append($(e.templateClass).html()),$(e.templateClass).remove()},showMenu:function(){var e=this;this.activateTimer&&clearTimeout(this.activateTimer),this.activateTimer=setTimeout(function(){$(e.getOption("menuClass")).fadeIn(),$("#popup-layer").fadeIn(),$(e.getOption("controlClass")).addClass("z301")},200)},closeMenu:function(){this.activateTimer&&clearTimeout(this.activateTimer),$(this.getOption("menuClass")).fadeOut(),$("#popup-layer").fadeOut(),$(this.getOption("controlClass")).removeClass("z301")}}),u=o.extend({initialize:function(e){o.prototype.initialize.call(this,e);var t=this,n=this.$el.find(this.getOption("menuClass")+" ul.top");if(n.length>0)try{n.menuAim({activate:this.activateSubmenu,deactivate:this.deactivateSubmenu,rowSelector:".js-submenu-item"})}catch(r){}},onRender:function(){},activateSubmenu:function(e){var t=this;this.submenuActivateTimer&&clearTimeout(this.submenuActivateTimer),this.submenuActivateTimer=setTimeout(function(){var t=$(e),n=t.data("submenu-id"),r=$("#"+n);r.fadeIn()},200)},deactivateSubmenu:function(e){this.submenuActivateTimer&&clearTimeout(this.submenuActivateTimer);var t=$(e),n=t.data("submenu-id"),r=$("#"+n);r.fadeOut()}});return e.Module.extend({initialize:function(){this.user=new o({el:n.controlClass,templateClass:n.menuTemplate,menuClass:n.menuClass,controlClass:n.controlClass})},init:function(e){e=e||[],_.contains(e,"main")&&(this.main=new u({el:t.controlClass,templateClass:t.menuTemplate,menuClass:t.menuClass,controlClass:t.controlClass})),_.contains(e,"city")&&(this.city=new o({el:r.controlClass,templateClass:r.menuTemplate,menuClass:r.menuClass,controlClass:r.controlClass})),_.contains(e,"news")&&(this.news=new u({el:i.controlClass,templateClass:i.menuTemplate,menuClass:i.menuClass,controlClass:i.controlClass})),_.contains(e,"kupon")&&(this.kupon=new u({el:s.controlClass,templateClass:s.menuTemplate,menuClass:s.menuClass,controlClass:s.controlClass}))}})}),define("modules/favourite",["marionette","backbone"],function(e,t){var n=t.Model.extend({urlRoot:"/ajax_object/favourite"});return e.Module.extend({initialize:function(){},init:function(e){},addRemove:function(e,t){var r=new n({id:e});t.error=t.error||function(){},t.success=t.success||function(){},r.save({},{success:function(e){var n=e.toJSON();n.code==200?t.success(n.result,n.favourites):t.error(n.result)}})},list:function(e){var t=new n;e.error=e.error||function(){},e.success=e.success||function(){},t.fetch({success:function(t){var n=t.toJSON();n.code==200?e.success(n.result):e.error(n.result)}})}})}),define("modules/ocontrol",["marionette","backbone"],function(e,t){var n=t.Model.extend({});return e.Module.extend({publishUnpublish:function(e,t){var r=new n;r.urlRoot="/ajax/pub_toggle/"+e,t.error=t.error||function(){},t.success=t.success||function(){},r.save({},{success:function(e){var n=e.toJSON();n.code==200?t.success(n):t.error(n)}})},publishUnpublishGroup:function(e,t,r,i){var s=new n;s.urlRoot="/rest_object/group_publishun",i.error=i.error||function(){},i.success=i.success||function(){},s.save({ids:e,to_publish:t,all:r},{success:function(e){var t=e.toJSON();t.code==200?i.success(t):i.error(t)}})},edit:function(e){$(window).attr("location","/edit/"+e)},contacts:function(e,t){var r=new n;r.urlRoot="/rest_object/show_contacts",t.error=t.error||function(){},t.success=t.success||function(){},t.captcha=t.captcha||function(){},r.save({id:e,captcha:t.code},{success:function(e){var n=e.toJSON();n.code==200?t.success(n.result):n.code==300?t.captcha(n.result):t.error(n.error)}})}})}),define("modules/search",["marionette","backbone"],function(e,t){var n=t.Model.extend({urlRoot:"/ajax_object/global_search"});return e.Module.extend({initialize:function(){},init:function(e){},"do":function(e,t){var n=this;window.clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){n.searchAdverts(e,t)},400)},searchAdverts:function(e,t){console.log(e);var r=new n;t.error=t.error||function(){},t.success=t.success||function(){},r.fetch({data:{text:e,city_id:t.city_id},success:function(e){var n=e.toJSON();n.code==200?t.success(n.objects,n.pricerows,parseInt(n.objects_found),parseInt(n.pricerows_found)):t.error(n)}})}})}),define("views/components/services/up",["marionette","backbone","templates"],function(e,t,n){return e.ItemView.extend({template:n.components.services.up,ui:{quantity:".js-quantity",price:".js-price"},events:{"change @ui.quantity":"changeQuantity"},templateHelpers:function(){var e=this;return{getPrice:function(){var t=e.model.get("info");if(t.service)return t.available?t.service.discount_reason:t.service.price+" руб.";if(t.services)return t.services.length>t.count?"(?)":"(бесплатно)"},getCount:function(){var t=e.model.get("info");if(t.object)return 1;if(t.objects)return t.objects.length},getTitle:function(){var t=e.model.get("info");if(t.object)return"Услуга 'Подъем' для объявления '"+t.object.title+"'";if(t.objects)return"Услуга 'Подъем' для "+t.objects.length+" объявлений(ия)"}}},changeQuantity:function(){var e=this.ui.quantity.val(),t={quantity:e};if(this.model.get("info").service){var n=this.model.get("info").service.price,r=this.model.get("info").service.discount_reason,i=this.model.get("info").available;t.sum=n*e,e>1?this.ui.price.text(n*e+" руб."):i?this.ui.price.text(r):this.ui.price.text(n+" руб.")}else this.model.get("info").services&&(console.log(this.model.get("info")),e>1?this.ui.price.text("(?)"):this.ui.price.text(this.model.get("info").services.length>this.model.get("info").count?"(?)":"(бесплатно)"));this.model.set("result",t)},onRender:function(){this.bindUIElements(),this.changeQuantity()},check:function(){return!1}})}),define("views/components/services/premium",["marionette","backbone","templates"],function(e,t,n){return e.ItemView.extend({template:n.components.services.premium,ui:{quantity:".js-quantity",price:".js-price"},events:{"change @ui.quantity":"changeQuantity"},templateHelpers:function(){var e=this;return{getPrice:function(){var t=e.model.get("info");if(t.service)return t.available?t.service.discount_reason:t.service.price+" руб.";if(t.services)return t.services.length>t.count?"(?)":"(бесплатно)"},getStaticPath:function(){return app.settings.staticPath},getCount:function(){var t=e.model.get("info");if(t.object)return 1;if(t.objects)return t.objects.length},getTitle:function(){var t=e.model.get("info");if(t.object)return"Услуга 'Премиум' для объявления '"+t.object.title+"'";if(t.objects)return"Услуга 'Премиум' для "+t.objects.length+" объявлений(ия)"}}},changeQuantity:function(){var e=this.ui.quantity.val(),t={quantity:e};if(this.model.get("info").service){var n=parseFloat(this.model.get("info").service.price),r=this.model.get("info").service.discount_reason,i=this.model.get("info").available;t.sum=n*e,e>1?this.ui.price.text(n*e+" руб."):i?this.ui.price.text(r):this.ui.price.text(n+" руб.")}else this.model.get("info").services&&(console.log(this.model.get("info")),e>1?this.ui.price.text("(?)"):this.ui.price.text(this.model.get("info").services.length>this.model.get("info").count?"(?)":"(бесплатно)"));this.model.set("result",t)},onRender:function(){this.bindUIElements(),this.changeQuantity()},check:function(){return!1}})}),define("views/components/services/lider",["marionette","backbone","templates"],function(e,t,n){return e.ItemView.extend({template:n.components.services.lider,ui:{quantity:".js-quantity",price:".js-price"},events:{"change @ui.quantity":"changeQuantity"},templateHelpers:function(){var e=this;return{getPrice:function(){var t=e.model.get("info");if(t.service)return t.service.price+" руб.";if(t.services)return"(?)"},getCount:function(){var t=e.model.get("info");if(t.object)return 1;if(t.objects)return t.objects.length},getTitle:function(){var t=e.model.get("info");if(t.object)return"Услуга 'Лидер' для объявления '"+t.object.title+"'";if(t.objects)return"Услуга 'Лидер' для "+t.objects.length+" объявлений(ия)"}}},changeQuantity:function(){var e=this.ui.quantity.val(),t={quantity:e};if(this.model.get("info").service){var n=this.model.get("info").service.price,e=this.ui.quantity.val(),t={quantity:e,sum:n*e};t.sum=n*e,e>1?this.ui.price.text(n*e+" руб."):this.ui.price.text(n+" руб.")}this.model.set("result",t)},onRender:function(){this.bindUIElements(),this.changeQuantity()},check:function(){return!1}})}),define("views/components/services/kupon",["marionette","backbone","templates"],function(e,t,n){return e.ItemView.extend({template:n.components.services.kupon,ui:{group:".js-group",price:".js-price"},events:{"change @ui.group":"changeGroup"},changeGroup:function(e){var t=parseInt($(e.currentTarget).val()),n=_.findWhere(this.model.get("info").groups,{id:t}),r={quantity:1,sum:n.service.price,id:t};_.extend(this.model.get("info"),n),this.model.set("result",r)},onRender:function(){this.bindUIElements(),this.ui.group.first().trigger("change")}})}),define("views/components/services/newspaper",["marionette","backbone","templates"],function(e,t,n){return e.ItemView.extend({template:n.components.services.newspaper,ui:{quantity:".js-quantity",city:".js-city",type:".js-type",price:".js-price",form:".js-form",description:".js-service-description"},events:{"change @ui.quantity":"changeQuantity","change @ui.city":"changeCityCheck","change @ui.type":"changeType","click @ui.description":"showDescription"},initialize:function(e){this.bindUIElements();if(!this.model.get("is_edit")&&this.model.get("city_id")){var t=this.getNewspaperCities();this.changeCity(t[this.model.get("city_id")][1])}},showDescription:function(){var e=this,t=$(this._parent.options.parentEl());t.hide(),app.windows.vent.trigger("showWindow","message",{title:"Описание типов объявлений в газете",text:n.components.descriptions.newspaper,success:function(){t.show()}})},getNewspaperCities:function(){return{1948:["Ярмарка-Нижневартовск","nizhnevartovsk"],1919:["Ярмарка-Тюмень","tyumen"],1979:["Ярмарка-Сургут","surgut"]}},templateHelpers:function(){var e=this;return{getNewspaperCities:function(){return e.getNewspaperCities()},getStaticPath:function(){return app.settings.staticPath},getTypes:function(){return e.model.get("info").type_info.types},getPrice:function(t,n,r){var i=e.model.get("info");if(i.service)return e.getPrice(t,n,r)+" руб.";if(i.services)return"(?)"},getCount:function(){var t=e.model.get("info");if(t.object)return 1;if(t.objects)return t.objects.length},getTitle:function(){var t=e.model.get("info");if(t.object)return"Размещение в газете объявления '"+t.object.title+"'";if(t.objects)return"Размещение в газете "+t.objects.length+" объявлений(ия)"}}},getPrice:function(e,t,n){n=n||2;var r=this.model.get("info").type_info.prices;return t&&e?r[t][e]*n:"(?)"},changeCityCheck:function(e){var t=$(e.currentTarget).val();this.changeCity(t)},changeCity:function(e){this.city=e,this.saveResult()},changeType:function(){this.ui.type.not(":checked").closest("tr").removeClass("success"),this.ui.type.filter(":checked").closest("tr").addClass("success"),this.saveResult()},changeQuantity:function(e){if(!this.city)return;var t=$(e.currentTarget).val(),n=$(e.currentTarget).data("type");this.model.get("info").service&&$(".js-price_"+n).text(this.getPrice(n,this.city,t)+" руб."),this.saveResult()},updatePrices:function(){var e=this;this.model.get("info").service&&_.each(this.model.get("info").type_info.types,function(t,n){var r=e.$el.find(".js-quantity_"+n).val();e.$el.find(".js-price_"+n).text(e.getPrice(n,e.city,r)+" руб.")})},saveResult:function(){if(!this.ui.form.length)return;var e={},t=[];_.each(this.ui.type.filter(":checked"),function(n){var r=$(n).val();t.push(r),e["quantity_"+r]=parseInt($(n).closest("tr").find(".js-quantity").val())}),e.types=t,e.city=this.city,this.model.set("result",e),this.updatePrices()},onRender:function(){this.model.get("is_edit")?(this.changeType(),this.changeCity(this.ui.city.filter(":checked").val())):this.ui.type.filter("[value='free']").prop("checked",!0).trigger("change")},resultValid:function(){var e=this.model.get("result");return e.types&&e.types.length>0&&this.city}})}),define("modules/services",["marionette","backbone","templates","views/components/services/up","views/components/services/premium","views/components/services/lider","views/components/services/kupon","views/components/services/newspaper"],function(e,t,n,r,i,s,o,u){var a=t.Model.extend({}),f=t.Model.extend({});return e.Module.extend({initialize:function(){},updateCart:function(){var e=new a;e.urlRoot="/rest_service/cart_count",e.save({},{success:function(e){var t=e.toJSON();$(".js-cart-counter").text(t.count),t.sum&&$(".js-cart-summ").text(t.sum+" руб.")}})},up:function(e,t){var n=new f;n.urlRoot="/rest_service/check_freeup",t.error=t.error||function(){},t.success=t.success||function(){},n.save({id:e,ids:t.ids},{success:function(e){var n=e.toJSON();app.windows.vent.trigger("showWindow","service",{title:"Услуга поднятия объявления",serviceView:new r({model:new f({info:n,is_edit:t.is_edit,edit_params:t.edit_params})}),code:n.code,success:t.success,error:t.error,is_edit:t.is_edit})}})},premium:function(e,t){var n=new f;n.urlRoot="/rest_service/check_premium",t.error=t.error||function(){},t.success=t.success||function(){},n.save({id:e,ids:t.ids},{success:function(e){var n=e.toJSON();app.windows.vent.trigger("showWindow","service",{title:"Услуга - премиум объявление",serviceView:new i({model:new f({info:n,is_edit:t.is_edit,edit_params:t.edit_params})}),code:n.code,success:t.success,error:t.error,is_edit:t.is_edit})}})},lider:function(e,t){var n=new f;n.urlRoot="/rest_service/check_lider",t.error=t.error||function(){},t.success=t.success||function(){},n.save({id:e,ids:t.ids},{success:function(e){var n=e.toJSON();app.windows.vent.trigger("showWindow","service",{title:"Услуга - объявление 'Лидер'",serviceView:new s({model:new f({info:n,is_edit:t.is_edit,edit_params:t.edit_params})}),code:n.code,success:t.success,error:t.error,is_edit:t.is_edit})}})},newspaper:function(e,t){var n=new f;n.urlRoot="/rest_service/check_newspaper",t.error=t.error||function(){},t.success=t.success||function(){},n.save({id:e,ids:t.ids},{success:function(e){var n=e.toJSON();app.windows.vent.trigger("showWindow","service",{title:"Услуга - Объявление в газету",serviceView:new u({model:new f({info:n,is_edit:t.is_edit,edit_params:t.edit_params,city_id:t.city_id})}),code:n.code,success:t.success,error:t.error,is_edit:t.is_edit})}})},buyObject:function(e,t){var n=new f;n.urlRoot="/rest_service/check_buy_object",t.error=t.error||function(){},t.success=t.success||function(){},n.save({id:e},{success:function(e){var n=e.toJSON();app.windows.vent.trigger("showWindow","service",{title:n.object.title,serviceView:new o({model:new f({info:n,is_edit:t.is_edit,edit_params:t.edit_params})}),code:n.code,success:t.success,error:t.error,is_edit:t.is_edit})}})},kupon:function(e,t){var n=new f;n.urlRoot="/rest_service/check_kupon",t.error=t.error||function(){},t.success=t.success||function(){},n.save({id:e},{success:function(e){var n=e.toJSON();t.success(),app.windows.vent.trigger("showWindow","service",{title:n.object.title,serviceView:new o({model:new f({info:n,is_edit:t.is_edit,edit_params:t.edit_params})}),code:n.code,success:t.success,error:t.error,is_edit:t.is_edit})},error:function(){t.error()}})}})}),define("modules/common",["marionette","backbone"],function(e,t){return e.Module.extend({initialize:function(){this.mainSearchInputInit()},mainSearchInputInit:function(){$(".js-search-input").parent().on("mouseover",function(){$(this).addClass("focus")}),$(".js-search-input").parent().on("mouseleave",function(){$(this).removeClass("focus")})}})}),define("app",["marionette","routers/index","controllers/index","modules/windows","modules/menu","modules/favourite","modules/ocontrol","modules/search","modules/services","modules/common"],function(e,t,n,r,i,s,o,u,a,f){var l=new e.Application,c=performance.now();return console.log("start app"),l.addInitializer(function(){console.log("app initialized"),l.backLayer=$("#popup-layer"),l.module("common",f),l.module("windows",r),l.module("menu",i),l.module("favourite",s),l.module("ocontrol",o),l.module("services",a),l.module("search",u),l.indexRouter=new t({controller:n});var e=performance.now();console.log("dom ready "+(e-c))}),l.on("start",function(){Backbone.history&&Backbone.history.start()}),window.app=l}),define("jquery",[],function(){return jQuery}),require.config({paths:{underscore:"lib/underscore",backbone:"lib/backbone",marionette:"lib/backbone.marionette",paginator:"lib/backbone.paginator",localStorage:"lib/backbone.localStorage",async:"lib/async",propertyParser:"lib/propertyParser",menuAim:"lib/jquery.menu-aim",jcookie:"lib/jquery.cookie",iframeTransport:"lib/vendor/jquery.iframe-transport",fileupload:"lib/vendor/jquery.fileupload",nicEdit:"lib/vendor/nicEdit",maskedInput:"lib/vendor/jquery.maskedinput",ymap:"http://api-maps.yandex.ru/2.1/?load=package.full&lang=ru-RU",gisMap:"http://maps.api.2gis.ru/2.0/loader.js?lazy=true"},shim:{localStorage:["backbone"],underscore:{exports:"_"},backbone:{exports:"Backbone",deps:["underscore"]},marionette:{exports:"Backbone.Marionette",deps:["backbone"]},paginator:{deps:["backbone"],exports:"Backbone.Paginator"},fileupload:{deps:["iframeTransport"]}},deps:["underscore"]}),require(["app","jquery","marionette","backbone","underscore"],function(e,t,n,r,i){e.settings={page:_globalSettings.page,data:_globalSettings.data,category_id:_globalSettings.category_id,city_id:_globalSettings.city_id,objects_for_map:_globalSettings.objects_for_map,host:_globalSettings.host,mainHost:"yarmarka.dev",debug:_globalSettings.debug},e.settings.debug?e.settings.staticPath="/static/develop/":e.settings.staticPath="/static/develop/production/";try{e.settings.query_params=_globalSettings.query_params?JSON.parse(_globalSettings.query_params):{}}catch(s){e.settings.query_params={}}r.emulateHTTP=!0,n.Behaviors.behaviorsLookup=function(){return window.Behaviors},n.TemplateCache.prototype.loadTemplate=function(e){var t=e;if(!t||t.length===0){var n='Could not find template: "'+e+'"',r=new Error(n);throw r.name="NoTemplateError",r}return t},e.start()}),define("main",function(){});